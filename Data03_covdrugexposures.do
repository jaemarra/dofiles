//  program:    Data03_drugexposures.do
//  task:		Generate variables indicating drug exposures in CPRD Dataset, using individual Therapy files
//  project: 	Incretins--Comparative mortality and CV outcomes (CPRD)
//  author:     MA \ May2014 Modified JM \ Jan2015


clear all
capture log close
set more off

log using Data03test.smcl, replace
timer on 1

forval i=0/49 {
	use Therapy_`i', clear	 
////// #1 make labels case-consistent
// create new variable "productname_1" as the lowercase version of "productname"
generate productname_1=lower(productname)
label variable productname_1 "productname in lower case"
// create new variable "drugsubstance_1" as the lowercase version of "drugsubstance"
generate drugsubstance_1=lower(drugsubstance)
label variable drugsubstance_1 "drugsubstance in lower case"

////// #6 Potential medication confounders drug exposure. Code so 0=no exposure and 1=exposure. Based on the categories of BNF codes as indicated by JMG. 
// restrict to exposure in year prior to both cohort entry and index date (see end of this section for loops for this)

// H2 receptor antagonists
local htwocodes="(66455020|61359020|61364020|03575007|68649020|01669007|61358020|68648020|66460020|68517020|61360020|66461020|74257020|66456020|79228020|61363020|68862020|51817020|75506020|51815020|68519020|73160020|79932020|68170020|66462020|75432020|60978020|60977020|68518020|51816020|51821020|68050020|68046020|68522020|68524020|51820020|71560020|71559020|68047020|72661020|69449020|68051020|68861020|68171020|65900020|60121020|53704020|75422020|86987020|79930020|86985020|85726020|53705020|68523020|76349020|78599020|57024020|52025020|82841020|79020020|58948020|58947020|90931020|57025020|89383020|!1319103|!6198102|78625020|79978020|78622020|57608020|79270020|74838020|64096020|64095020|57607020|86205020|86207020|74837020|81020020|89387020|!6198103|83203020|57023020|56487020|83556020|72664020|89385020|75503020|79977020|79658020|64097020|82984020|75433020|69446020|56611020|79269020|76432020|82554020|74839020|90929020|56488020|84350020|57260020|!7006104|90699020|56486020|53088020|57258020|89389020|57259020|66457020|57387020|82985020|57834020|61365020|83272020|49283020|52954020|49298020|53755020|49288020|64359020|56620020|64342020|64532020|57838020|58996020|64432020|58930020|65616020|56621020|60302020|61834020|49287020|57367020|56612020|51822020|53756020|58931020|54675020|53754020|54674020|49297020|49299020|54676020|49289020|79271020|64535020|57842020|60104020|59506020|65560020|60258020|60873020|29119020|29120020|10754020|33943020|57368020|33875020|10755020|00289020|74656020|00307020|34023020|33649020|70128020|34025020|33645020|33643020|45134020|83617020|36540020|33941020|72528020|33635020|33927020|33925020|74692020|38455020|33879020|14234020|33939020|38454020|71138020)"
gen h2recep = 0 
replace h2recep = 1 if regexm(gemscriptcode, "`htwocodes'") 
label variable h2recep "H2 receptor antagonist exposure: 0=no exp, 1=exp"

// Proton pump inhibitors
local ppicodes="(69782020|75585020|75584020|69784020|69779020|75579020|69777020|69783020|83800020|75580020|83791020|82878020|83792020|69778020|76536020|76537020|84691020|76535020|81176020|77426020|75586020|82880020|84692020|77604020|83799020|82258020|76820020|82927020|84206020|81527020|84273020|77427020|51247020|82926020|90763020|81177020|76817020|83697020|75581020|86832020|81175020|90583020|64076020|86834020|82879020|87632020|!8504193|!8504192|85931020|87962020|!8505536|!8504196|85929020|87634020|86739020|85932020|64285020|64288020|85928020|!8504197|64282020|74333020|64268020|64255020|64271020|87730020|64296020|73281020|81078020|64107020|64367020|64078020|64104020|64114020|64117020|64110020|64329020|65073020|64370020|64206020|64332020|88223020|93589020|67659020|67656020|91784020|91782020|64082020|64233020|72253020|72250020|72211020|72214020|97642020|97648020|97646020|97644020|97548020|97546020|73435020|64236020|82806020|76905020|72496020|70521020|72504020|65513020|64335020|64299020|72412020|98761020|73261020|98759020|98248020|72859020|75970020|72575020|99218020|99220020|73430020|98763020|98765020|72703020|72510020|72268020|64442020|35827020|00450020|33410020|33426020|35972020|35435020|00401020|00361020|13644020|35433020|00483020|00452020|33398020|39489020|33414020|39529020|00389020|33404020|35186020|00475020|72486020|36428020|00402020|99535020|00444020|00408020|77975020|72491020|00355020|33408020|00366020|39490020|33390020|36718020|36282020|00358020|33422020|00397020|00370020|37503020|13647020|00360020|64448020|77980020|00406020|67653020|33416020)"
gen ppi = 0 
replace ppi = 1 if regexm(gemscriptcode, "`ppicodes'")
label variable ppi "Proton pump inhibitor exposure: 0=no exp, 1=exp"

// Corticosteroids (GI)
local cortgicodes="(69246020|66163020|59141020|65229020|59234020|57212020|52313020|67899020|70684020|70870020|53685020|71488020|59233020|58316020|62939020|59146020|69583020|48313020|68210020|48314020|79401020|84968020|83499020|73579020|64256020|57831020|51284020|48829020|59145020|49579020|73585020|06675007|74386020|73578020|64257020|73580020|59140020|54899020|51285020|59142020|51216020|56476020|49670020|56264020|48309020|69244020|79402020|50937020|67266020|69255020|61531020|53718020|51875020|48777020|51300020|61754020|81070020|48324020|50813020|48830020|52314020|51881020|51220020|53711020|56477020|84970020|70691020|50814020|62940020|52570020|64750020|53690020|03730007|79400020|84967020|74422020|60719020|57832020|48184020|53748020|54707020|48087020|81155020|49867020|68592020|69640020|52775020|68211020|65885020|65884020|65228020|58788020|63411020|53694020|73436020|55319020|52569020|50231020|63384020|58637020|53686020|64573020|69624020|54705020|74421020|02254007|79953020|68209020|02973007|83727020|65340020|61414020|86874020|48653020|54528020|66161020|04515007|04498007|05471007|02415007|53047020|79417020|68589020|74423020|48181020|49217020|63438020|54384020|49374020|66162020|61413020|51493020|63419020|68588020|04507007|59147020|53016020|51492020|66610020|54531020|57935020|69623020|50232020|56475020|69245020|64080020|03590007|53712020|49667020|79444020|64079020|86871020|49203020|86883020|58725020|58687020|49666020|51299020|51562020|57934020|63491020|05208007|66187020|86873020|64090020|49204020|54009020|73584020|57512020|63381020|03986007|74196020|58697020|48110020|57434020|03729007|57602020|81072020|72190020|48111020|53012020|54534020|53710020|54871020|61632020|49210020|74580020|03319007|58710020|69622020|56285020|86884020|50233020|54706020|63492020|00031007|53691020|04516007|63385020|85880020|63447020|71944020|67851020|69249020|65880020|82721020|63485020|65189020|65881020|66179020|72603020|62189020|74239020|64751020|83302020|53820020|64586020|77000020|79503020|57082020|57083020|75097020|63441020|76999020|53819020|79502020|55068020|83997020|83358020|58008020|86469020|52417020|79418020|81548020|86962020|69984020|73349020|87864020|56618020|71502020|70077020|74388020|76616020|79213020|66180020|86176020|69637020|67706020|83622020|87862020|81547020|67902020|92071020|03255007|04870007|69251020|03588007|04505007|52571020|63459020|69364020|69254020|58429020|00044007|69820020|04512007|61025020|70873020|69573020|48310020|64591020|66172020|49205020|48019020|63375020|64995020|53011020|64258020|04504007|57249020|49211020|63463020|63388020|69367020|63369020|06582007|63372020|57603020|48315020|04866007|63456020|63482020|03279007|01773007|69758020|49212020|06254007|03726007|04513007|02260007|69250020|81751020|63437020|74240020|82868020|57511020|85796020|64992020|56885020|81507020|63392020|85879020|82719020|63434020|71490020|80543020|86879020|74387020|56886020|86870020|86420020|74583020|86175020|63473020|84348020|05753007|49534020|59631020|56284020|63415020|05567007|06407007|64574020|01124007|70685020|64589020|64572020|56838020|49862020|05812007|03728007|51213020|65341020|00134007|72100020|56606020|66183020|66178020|81505020|63389020|84099020|70078020|67874020|86638020|77001020|63430020|61791020|69586020|86878020|64987020|79548020|03318007|04871007|04874007|02876007|04683007|04872007|62112020|04868007|04681007|04877007|64583020|48299020|63366020|63448020|48224020|48223020|64988020|83245020|62188020|65344020|80128020|58009020|91163020|57435020|64582020|04869007|05688007|04506007|82720020|52887020|65190020|76613020|56636020|64579020|88500020|91157020|51221020|04499007|81511020|63416020|67875020|85881020|85797020|57513020|83998020|73583020|80129020|80127020|78037020|70584020|92107020|89459020|05694007|71945020|51212020|83816020|91155020|02416007|64590020|05470007|63427020|81506020|80604020|87972020|91167020|91165020|91161020|79928020|79364020|91153020|68202020|69759020|86419020|69787020|00103007|63431020|76301020|63460020|89688020|90421020|79487020|03668007|58554020|62111020|04511007|00030007|06250007|79549020|56650020|86296020|84101020|54535020|69821020|72923020|03317007|05831007|03838007|81509020|67876020|68203020|86508020|66184020|76542020|82890020|54091020|64578020|88502020|04875007|81510020|04166007|64092020|61726020|70072020|54468020|00982007|02413007|64091020|85795020|79501020|!5804101|64083020|76885020|82204020|02414007|58192020|92063020|00104007|56502020|89346020|76734020|63421020|!5795202|!6087101|!3237119|!2891103|03727007|84020020|!5803102|77517020|76884020|91159020|05808007|02974007|50409020|58819020|04878007|56344020|!3251101|!1266101|82866020|48880020|!1382301|!3239101|!2163501|!2737102|!2737101|63466020|64989020|54996020|!3240101|!3251102|05693007|63479020|04880007|05810007|74187020|64087020|05213007|04876007|63476020|06074007|!5803101|04509007|56343020|51209020|06073007|06218007|!1255201|87974020|57954020|!7674101|06107007|!2891102|!2891101|54066020|04508007|!5795107|06113007|84019020|!1535101|!7481101|73348020|!4581123|60177020|72920020|51208020|56347020|56520020|67076020|05161007|!1360101|05815007|06287007|90423020|92109020|02055007|64086020|!3250501|61524020|75403020|!0134901|!3237103|59093020|!2691102|!5795110|!5795111|54004020|61525020|!1360102|!5264101|!6648101|50410020|51722020|90690020|02259007|59873020|84018020|54005020|58817020|50400020|69788020|04873007|!4862101|05692007|67080020|61523020|63470020|90425020|04510007|66166020|54231020|58818020|84232020|64644020|51389020|56752020|78146020|06106007|50401020|51719020|60820020|59872020|54469020|66018020|92101020|60178020|48945020|51386020|51723020|63536020|62621020|56243020|71489020|63412020|54511020|70053020|52868020|59874020|51385020|54467020|54227020|50399020|63531020|50408020|48944020|52850020|57098020|56118020|62620020|65523020|67073020|54228020|48946020|65526020|65723020|52869020|63539020|61619020|52867020|49796020|49797020|50404020|60176020|51718020|92111020|93053020|93043020|93055020|93049020|93059020|92059020|92067020|92307020|92303020|93057020|93047020|93063020|91927020|92103020|93045020|93051020|92711020|93039020|93525020|92719020|92727020|93041020|92105020|92729020|89274020|93527020|88958020|94027020|94023020|94307020|94305020|94029020|04300007|92309020|79527020|94347020|94691020|92567020|91895020|61294020|51379020|91897020|92115020|65207020|88960020|96231020|96155020|95879020|53922020|51384020|96157020|96233020|87345020|59247020|66013020|63923020|52872020|69256020|55527020|52864020|64355020|93317020|63449020|98420020|98422020|92305020|61533020|52884020|51727020|94031020|51724020|99545020|76212020|63918020|77631020|88506020|78430020|00804021|96951020|51393020|56748020|99655020|00806021|76200020|00611020|38603020|08877020|10734020|06598020|06597020|06599020|06590020|00053020|09012020|13077020|38602020|40235020|35237020|13778020|02876020|13400020|13075020|10737020|06592020|10725020|21518020|13070020|11231020|06591020|14019020|09009020|09496020|44430020|00054020|13779020|10727020|09060020|10720020|13076020|10736020|00046020|10726020|08870020|20239020|06607020|00048020|39336020|40205020|32190020|36273020|36388020|21498020|39412020|32204020|08871020|59063020|13412020|10732020|00605020|21506020|14017020|33911020|06634020|09497020|38352020|10735020|00047020|11438020|13074020|08874020|46191020|33915020|14794020|10721020|10729020|33907020|35238020|46189020|13252020|34075020|08876020|06621020|75406020|52858020|69262020|36277020|47605020|39413020|21504020|47981020|77688020|08883020|02818020|02827020|10722020|02858020|47496020|11448020|08869020|02831020|11449020|21491020)"
gen cortico_gi = 0 
replace cortico_gi = 1 if regexm(gemscriptcode, "`cortgicodes'")
label variable cortico_gi "Corticosteroid (GI) exposure:0=no exp, 1=exp"

// thiazide and related diuretics 
local thiazcodes="(58976020|58977020|50481020|63248020|67597020|61267020|51047020|54815020|50636020|61684020|50651020|67326020|50654020|51857020|52841020|67598020|69291020|50633020|73233020|53090020|63540020|61687020|51462020|49873020|84103020|68134020|50482020|63249020|69296020|61268020|69292020|05297007|49872020|69293020|49062020|64663020|63211020|51994020|68844020|63541020|51068020|73883020|73241020|80484020|48121020|51463020|83957020|86950020|80260020|90559020|05580007|65442020|58678020|48202020|66717020|63267020|50252020|51854020|64409020|66716020|48201020|50380020|52834020|73918020|05317007|03217007|53094020|61214020|49876020|67204020|72035020|73882020|83981020|06749007|68129020|69268020|67627020|83982020|68130020|63279020|50657020|67082020|53154020|67219020|90731020|53087020|49322020|58231020|63763020|73921020|84712020|79035020|63257020|69269020|48303020|68972020|51993020|69032020|61276020|64368020|49321020|05300007|82106020|72036020|51466020|05298007|90629020|05299007|64533020|81472020|70712020|90631020|52358020|61275020|67631020|71715020|63252020|64530020|05975007|67090020|69280020|48386020|48387020|63762020|!4529101|!4828101|91533020|67620020|63254020|67621020|48847020|88006020|!1564101|81470020|72539020|75589020|75590020|88422020|80150020|!0606103|87996020|89781020|!0607101|!0607102|68145020|75350020|69274020|51989020|79843020|68015020|57165020|78942020|75814020|59731020|!7954101|80149020|82104020|06704007|48838020|!0607701|90637020|57793020|78343020|53155020|68841020|68980020|63282020|90635020|52359020|64126020|69277020|75349020|57164020|54691020|56910020|48839020|53521020|80831020|50816020|56755020|82105020|63225020|48846020|68979020|86952020|55246020|55247020|55391020|55390020|60352020|60492020|66500020|62827020|54653020|53522020|92367020|90735020|67220020|60353020|94709020|94277020|94427020|90733020|89804020|95950020|48118020|57796020|68065020|68581020|54690020|54654020|95960020|95348020|05458007|54888020|63983020|97115020|98337020|57007020|98339020|97012020|63283020|99566020|75757020|99769020|99773020|99771020|56911020|99775020|66033020|61938020|59993020|99501020|60381020|94685020|10244020|12783020|12786020|12802020|12797020|12792020|10333020|12788020|14621020|12808020|10247020|00689020|14581020|14620020|14588020|14582020|10354020|10458020|33486020|14591020|12807020|14589020|14625020|92909020|10462020|14694020|14609020|13551020|14617020|34961020|14627020|14618020|14624020|14610020|61691020|14585020|13550020|14615020|14699020|35107020|45436020|92033020|14697020|14616020|00683020|33496020|30321020|14700020|94928020|14626020|98525020|13553020|13552020|00682020|99777020|14564020|14584020|33494020|91770020|14586020|14597020|47939020|14702020|00685020|14612020|00690020|19362020|39275020|14594020|92809020|10461020)"
gen thiazdiur = 0 
replace thiazdiur = 1 if regexm(gemscriptcode, "`thiazcodes'")
label variable thiazdiur "thiazide and related diuretic exposure: 0=no exp, 1=exp"

// loop diuretics 
local loopcodes="(59420020|59419020|73909020|73910020|53107020|62135020|64264020|53108020|62142020|52368020|73968020|73971020|82785020|67963020|48499020|49564020|62148020|59424020|76008020|73911020|02507007|50110020|62143020|52375020|66726020|67230020|57115020|64266020|62144020|75245020|75244020|83764020|59421020|64272020|50105020|50100020|50116020|06676007|53005020|49059020|50115020|64265020|06672007|75560020|62138020|83268020|69287020|83765020|75555020|62154020|52643020|52640020|67213020|75554020|75559020|52766020|52763020|68240020|60884020|65855020|53109020|82796020|73977020|59523020|83766020|52363020|69286020|74377020|62139020|75561020|75373020|69288020|49199020|53101020|55562020|63601020|53340020|67231020|64269020|05786007|48216020|49105020|86513020|!4023101|75556020|!4023103|!2707101|!2710103|!2706901|!2707105|52999020|50933020|!2707801|49716020|!2710102|59808020|55921020|58432020|!4023107|62151020|49707020|!2711702|49715020|65493020|59809020|62291020|02242007|49706020|49717020|54000020|76021020|85983020|53871020|55922020|56655020|72279020|56648020|89311020|60151020|62708020|60338020|60274020|53872020|56459020|53338020|53877020|59627020|55923020|62808020|93499020|93839020|59167020|03663007|95531020|59590020|96714020|75618020|53867020|75613020|67325020|76949020|53339020|63792020|56479020|53873020|73018020|72847020|56458020|59626020|55328020|67150020|71525020|67666020|92509020|49711020|30828020|35233020|40472020|55325020|89326020|00697020|00696020|00727020|71009020|00693020|00703020|00724020|73015020)"
gen loopdiur = 0 
replace loopdiur = 1 if regexm(gemscriptcode, "`loopcodes'")
label variable loopdiur "loop diuretic exposure: 0=no exp, 1=exp"

// Potassium-sparing diuretics and aldosterone antagonists
local aldoscodes="(73909020|73910020|53107020|50481020|59043020|59044020|66713020|70711020|70710020|58943020|58026020|57454020|53108020|62142020|49166020|57453020|69291020|59045020|67201020|73233020|57447020|73968020|73971020|06600007|67963020|49564020|62148020|03116007|50482020|69296020|69292020|73911020|02507007|06658007|69293020|49169020|58739020|62143020|54433020|66726020|57115020|57448020|68844020|62144020|57075020|73241020|75280020|49174020|50105020|56162020|67210020|57449020|66717020|58741020|63267020|66716020|63273020|67204020|83268020|69287020|58944020|75248020|88410020|53134020|67213020|73915020|75250020|53154020|67219020|75249020|90717020|50402020|53109020|75281020|88414020|73977020|58740020|03137007|63257020|73914020|69286020|69032020|88412020|53136020|53135020|75373020|72435020|69288020|63766020|70712020|04394007|55626020|!0208101|!0207101|!0208102|63252020|63264020|69280020|68513020|86513020|63254020|68514020|72539020|72514020|!2707801|!6724104|57612020|68145020|75350020|69274020|55921020|68827020|79843020|68015020|62291020|53155020|68841020|59102020|63282020|88416020|05894007|05180007|64126020|05182007|05181007|05996007|69277020|05176007|54000020|75349020|49311020|50619020|82357020|53609020|55922020|53610020|60338020|60274020|48461020|56459020|50617020|48451020|55621020|55013020|55923020|56393020|55251020|50611020|67220020|95531020|96714020|69121020|63792020|53503020|55623020|48466020|53611020|55250020|56479020|!7251101|97965020|56458020|50618020|60182020|58945020|55567020|63283020|55570020|49316020|48455020|00519021|00517021|92509020|59101020|74717020|37067020|20841020|20835020|20819020|00755020|35254020|35256020|35258020|35252020|20821020|31962020|34806020|05187007|34804020|34670020|35250020|34619020|34605020)"
gen potsparediur_aldos = 0 
replace potsparediur_aldos = 1 if regexm(gemscriptcode, "`aldoscodes'")
label variable potsparediur_aldos "Potassium-sparing diuretic and aldosterone antagonist exposure: 0=no exp, 1=exp"

// Potassium-sparing diuretics with other diuretics
local ksparecodes="(73909020|73910020|53107020|50481020|70711020|70710020|58026020|57454020|53108020|62142020|49166020|57453020|69291020|73233020|73968020|73971020|67963020|49564020|62148020|50482020|69292020|73911020|69293020|62143020|66726020|57115020|62144020|57075020|73241020|50105020|66717020|63267020|66716020|63273020|67204020|83268020|69287020|67213020|73915020|53154020|67219020|53109020|73977020|63257020|73914020|69286020|69032020|75373020|72435020|69288020|63766020|70712020|63252020|63264020|86513020|63254020|72539020|68145020|75350020|55921020|79843020|68015020|!2051101|62291020|53155020|63282020|64126020|54000020|75349020|49311020|55922020|60338020|60274020|56459020|55013020|55923020|67220020|95531020|96714020|63792020|53503020|56479020|97965020|56458020|63283020|49316020|92509020|74717020|31962020)"
gen potsparediur_other = 0 
replace potsparediur_other = 1 if regexm(gemscriptcode, "`ksparecodes'")
label variable potsparediur_other "Potassium-sparing diuretic with other diuretic exposure: 0=no exp, 1=exp"

// Antiarrhythmic drugs
local arrcodes="(63962020|03301007|50318020|60110020|52313020|59375020|68183020|05508007|68338020|59559020|69632020|64626020|63961020|83603020|50316020|64714020|60109020|66681020|61902020|56267020|80059020|58175020|58174020|61901020|65177020|55703020|56251020|58150020|66682020|69682020|50317020|86904020|63971020|02254007|58166020|63987020|58170020|62704020|59771020|65174020|72792020|72793020|63979020|58228020|69181020|58147020|48410020|63957020|58144020|64050020|58153020|51641020|62705020|68336020|58840020|74580020|02339007|02340007|58165020|67851020|66206020|69182020|70867020|67269020|58156020|74239020|69678020|58227020|63966020|84710020|54829020|81901020|74864020|68337020|54830020|92071020|63969020|60111020|61905020|51452020|63963020|51453020|55702020|63970020|06350007|54498020|54581020|58375020|51259020|54113020|04784007|70559020|82530020|56680020|59772020|64649020|48752020|51260020|64348020|75255020|69679020|66683020|74240020|58173020|81867020|80301020|71520020|64352020|81903020|81902020|74583020|54252020|82528020|64713020|53675020|58376020|52978020|64169020|74852020|51642020|77157020|75254020|79186020|70062020|64351020|05066007|48751020|05782007|54821020|82017020|54190020|79911020|54052020|54051020|58827020|66686020|69469020|54046020|50047020|54831020|52979020|63981020|84594020|79194020|54013020|49013020|59650020|63974020|58167020|64049020|88909020|64660020|88907020|77062020|59643020|74868020|60854020|86748020|69683020|63975020|71563020|06095007|04778007|04783007|70635020|59558020|86618020|04786007|06999007|63958020|64634020|02336007|80049020|54016020|58979020|88113020|55769020|80346020|02337007|71361020|70273020|70063020|66689020|04777007|03668007|69631020|81982020|69635020|63980020|86296020|81675020|74871020|51277020|71982020|74865020|59560020|79850020|88440020|66224020|74657020|48764020|58159020|69109020|83243020|86620020|92063020|67110020|52275020|54053020|02338007|!8503887|86906020|71572020|!4089201|!4078001|05780007|64051020|54823020|69537020|54822020|84518020|78861020|58841020|!4078405|55768020|05783007|56814020|85926020|82278020|63976020|!4083102|51261020|53571020|04785007|84062020|61232020|54826020|04779007|66701020|75223020|75225020|52778020|63272020|54019020|53572020|82280020|54119020|80781020|05876007|!4080107|!4082104|79920020|81857020|58611020|71983020|61195020|55701020|52427020|06613007|69321020|53578020|50062020|83573020|!1756301|78642020|80779020|86751020|48753020|77973020|66311020|05779007|05494007|60858020|54045020|66690020|06306007|57658020|59466020|81859020|51964020|81858020|51296020|80625020|50788020|53573020|60859020|55774020|70556020|66706020|59557020|03665007|52276020|58610020|63927020|64353020|50757020|80307020|63730020|52777020|04443007|62710020|71986020|86374020|!4080126|81676020|61163020|56857020|48473020|80308020|55773020|79921020|55775020|59468020|04782007|89968020|62666020|48474020|67542020|81022020|89855020|75218020|63548020|90951020|91509020|54107020|83509020|70555020|86744020|57662020|55471020|50069020|63653020|60186020|56537020|62667020|65314020|59307020|61147020|60016020|61894020|88438020|54658020|50059020|48990020|92453020|93497020|92059020|92067020|97695020|92749020|92915020|91253020|90953020|97689020|69464020|93471020|90949020|93469020|94607020|59346020|93692020|73560020|94645020|94651020|86238020|55581020|94581020|95917020|79926020|80305020|58956020|95501020|75895020|96650020|96654020|96652020|61972020|75892020|92917020|95921020|59347020|05507007|78850020|97161020|97251020|97249020|97469020|88482020|56023020|56022020|49581020|61212020|62060020|52274020|80051020|59821020|78853020|98192020|02897007|93252020|62264020|61895020|61164020|62059020|65838020|68754020|75069020|62706020|98194020|81905020|56381020|65991020|62263020|56572020|61213020|63552020|64398020|71362020|10431020|10418020|10410020|04113020|13362020|14628020|13481020|10420020|10425020|09405020|35456020|13364020|09407020|13483020|06590020|15829020|38483020|19907020|19909020|10440020|08994020|43943020|19906020|14629020|18929020|06592020|15828020|45119020|06591020|18757020|09682020|44353020|10432020|10419020|10411020|10435020|10415020|20827020|19904020|10443020|13367020|36280020|30154020|00846020|04115020|06173020|29982020|00893020|35610020|10413020|04109020|92021020|74729020|36907020|00850020|41299020|18925020|18923020|10417020|44158020|56571020|18933020|10424020|10437020|09421020|84516020|13363020|45118020|36606020|92489020|60185020|00903020|76705020|10409020|32333020|29983020|54047020|13486020|15827020)"
gen antiarrhythmic = 0 
replace antiarrhythmic = 1 if regexm(gemscriptcode, "`arrcodes'")
label variable antiarrhythmic "antiarrhythmic exposure: 0=no exp, 1=exp"

// Beta-blockers 
local bbcodes="(60153020|60152020|67920020|60300020|59375020|59368020|51941020|68438020|67597020|83178020|68440020|59369020|64666020|80458020|64667020|66307020|66681020|80607020|72238020|91125020|59370020|53253020|54495020|54494020|54815020|51857020|68439020|68333020|59361020|65274020|66308020|66682020|63899020|68629020|67598020|54886020|51942020|74975020|74979020|54493020|54818020|64896020|51860020|72526020|72236020|74974020|63900020|59362020|49929020|03534007|03913007|75253020|59374020|48397020|53660020|59360020|69296020|68353020|66694020|59365020|64050020|51641020|06228007|51584020|68965020|83758020|51994020|68847020|52291020|54433020|67077020|68332020|68375020|54256020|67078020|68844020|65802020|83552020|82375020|48767020|59376020|83180020|73883020|79340020|86492020|54829020|68354020|67919020|54830020|72237020|68976020|83179020|89118020|51862020|54884020|80460020|56162020|90711020|59926020|74978020|54409020|69193020|68838020|52703020|66693020|64670020|48396020|59925020|50252020|59924020|51499020|68837020|54885020|54498020|54259020|52702020|52834020|68652020|73918020|54881020|05317007|03217007|52545020|64895020|63928020|69746020|54880020|52285020|84766020|83986020|75255020|54879020|66683020|82378020|73882020|75104020|82376020|72696020|54252020|50246020|48722020|54539020|54889020|68369020|67627020|51642020|75105020|82379020|75254020|67160020|48400020|69745020|04397007|52701020|51646020|54821020|05741007|67082020|67081020|66686020|04319007|51861020|54538020|54831020|50247020|63763020|73921020|83183020|65806020|83182020|72243020|59935020|83760020|90821020|90823020|54543020|52381020|64049020|65803020|55786020|81484020|89120020|66704020|68850020|72691020|68972020|57243020|72692020|81482020|91055020|58485020|02319007|68966020|61276020|79593020|82960020|86794020|75020020|72698020|75023020|83190020|66689020|57624020|03667007|83191020|53671020|72241020|!8504177|83989020|72693020|04394007|61275020|67631020|57790020|62996020|55394020|53707020|63135020|67720020|72242020|!7164101|!7164102|83184020|83192020|51987020|52292020|50243020|68975020|66147020|91061020|72042020|72697020|86680020|!0681101|67090020|86681020|69280020|84253020|84254020|64051020|54823020|54822020|63762020|74896020|86502020|86500020|!4529101|84849020|04485007|58484020|!8504114|67620020|67621020|64899020|71607020|66314020|!6704106|!6000601|62681020|90893020|68813020|68814020|54826020|80150020|!0681102|53655020|04879007|66701020|!0394102|52999020|!0394103|!3121601|79243020|88272020|84837020|61503020|57667020|69274020|!5661101|05678007|05680007|68815020|85670020|56515020|57165020|78284020|03229007|62151020|80149020|04486007|!7046101|79594020|56705020|05679007|06704007|92243020|49156020|87165020|66311020|50423020|69482020|66690020|64900020|57658020|59466020|54244020|68841020|03289007|71407020|85953020|87099020|90895020|59496020|53709020|86682020|68980020|88268020|63850020|63927020|04484007|71512020|69479020|63851020|69277020|57093020|72687020|49923020|63161020|57164020|56093020|56910020|63160020|59468020|55395020|53521020|62676020|56706020|59465020|04480007|90619020|86847020|77372020|57210020|78135020|60550020|60233020|51023020|51022020|52914020|69739020|78494020|56541020|49177020|79217020|85990020|50437020|60232020|51024020|68979020|57662020|62689020|56836020|90617020|55246020|55247020|56768020|50072020|50073020|56678020|49917020|49922020|56194020|51424020|51777020|50424020|56542020|51438020|57193020|53708020|63653020|50435020|56767020|57037020|52913020|60352020|60231020|67708020|60551020|56537020|52915020|54125020|51440020|65314020|59307020|61147020|56094020|67705020|67913020|51439020|50422020|56679020|53351020|58941020|62677020|54653020|57038020|56034020|53352020|52909020|66703020|53461020|53522020|65979020|59464020|54245020|62688020|59302020|91235020|90891020|91971020|78143020|91253020|58483020|64558020|91237020|59303020|63159020|50847020|73449020|60353020|73574020|90779020|55581020|95260020|75624020|68806020|58956020|96562020|89270020|84559020|54126020|49924020|56193020|57211020|97076020|97074020|97367020|50436020|54654020|62682020|63783020|60515020|!4530101|!1385102|79595020|61054020|57194020|75323020|60502020|61192020|64019020|65838020|62726020|98730020|57013020|!3431105|77127020|56835020|66745020|91796020|64022020|71703020|51778020|71577020)"
gen betablock = 0 
replace betablock = 1 if regexm(gemscriptcode, "`bbcodes'")
label variable betablock "beta-blocker exposure: 0=no exp, 1=exp"

// ACE Inhibitors
local aceicodes="(68572020|68575020|68571020|72676020|70737020|72573020|72674020|60791020|03900007|68570020|60790020|72572020|74178020|80174020|72675020|87055020|87049020|51047020|60377020|60378020|48566020|60792020|68133020|60379020|60796020|03203007|51462020|52609020|68134020|48565020|02652007|68562020|48567020|69849020|69081020|74174020|69082020|69850020|51068020|72670020|72568020|72671020|72569020|74179020|79311020|85253020|87057020|87053020|87051020|51463020|87061020|87059020|81266020|50822020|69848020|50823020|83957020|68564020|68563020|69843020|69080020|71439020|71440020|58451020|55119020|68567020|55120020|55121020|02913007|72669020|55352020|75607020|72035020|87063020|87606020|68554020|68129020|69268020|86080020|84482020|84483020|81446020|68130020|90539020|81445020|90557020|88326020|68559020|49386020|54164020|49387020|81267020|81182020|54165020|74175020|77942020|84712020|68555020|69844020|69845020|83699020|74293020|58452020|75604020|74296020|80674020|69269020|49385020|82305020|55291020|55290020|50589020|68556020|60797020|71438020|81181020|85824020|80675020|78452020|88718020|87231020|72036020|81183020|85883020|59646020|52608020|52610020|64822020|64814020|61344020|64818020|85865020|60798020|85903020|84462020|90115020|50588020|78451020|87820020|84490020|!1100404|83449020|77941020|!8505496|73042020|!1100402|84464020|50587020|77943020|06272007|85703020|!1100403|!1092601|85701020|84491020|86081020|!2215902|61260020|85815020|89909020|88107020|80671020|80672020|85702020|68139020|87608020|86079020|88105020|05959007|84463020|64809020|!8505226|68137020|86077020|61347020|68138020|84492020|80831020|60326020|84386020|81268020|65140020|67125020|88109020|75030020|60335020|73493020|69419020|67697020|56633020|69974020|67144020|65098020|67189020|67206020|67186020|55722020|67140020|69439020|67203020|67183020|61301020|65081020|67129020|67170020|67301020|67175020|67305020|56638020|56639020|69436020|67518020|67515020|69441020|67455020|67209020|65102020|67770020|67179020|63374020|56635020|67512020|61253020|61362020|65220020|67460020|68264020|56686020|56640020|67309020|61298020|61397020|91818020|91890020|73496020|60325020|93652020|75031020|94154020|94156020|59733020|67694020|94657020|94709020|94699020|94697020|94705020|94701020|94277020|94707020|94703020|75036020|95107020|74776020|95370020|89046020|95877020|95875020|95901020|95527020|95903020|87452020|95113020|96425020|89044020|67322020|60324020|65183020|65176020|65173020|65180020|56802020|56801020|61246020|59737020|61357020|87446020|89050020|73041020|61262020|61261020|61266020|61247020|91957020|61356020|65196020|65206020|65202020|65199020|92446020|56634020|61391020|65134020|56644020|76373020|98847020|75029020|63368020|91312020|68971020|65236020|73490020|65239020|65231020|68982020|99318020|71542020|75040020|89048020|00417021|00477021|56643020|59293020|61297020|65137020|65143020|00475021|71545020|68974020|68978020|76554020|73269020|99501020|75652020|76375020|01588020|01545020|19817020|34964020|74621020|20723020|92909020|30786020|19819020|34961020|66292020|01583020|01572020|38770020|01418020|01459020|01582020|20854020|01564020|01585020|19239020|40203020|40612020|01463020|01484020|10700020|01576020|01427020|69229020|61780020|01467020|75924020|20380020|69238020|70068020|10867020|91738020|19241020|01575020|09855020|75033020|01470020|01579020|76559020|35397020|01486020|67297020|67847020|01448020|01482020|01472020|47145020|65227020|61781020|47144020|39749020|47933020|01578020|10683020|47939020|01556020|70076020|01491020|20371020|01586020|01554020|01546020|01458020|01541020|01552020|01375020|01481020|75649020|01565020|01592020|84385020|01590020|65217020|47143020|74497020|47942020|47146020|30788020|01503020|01446020|67312020|76377020)"
gen acei = 0 
replace acei = 1 if regexm(gemscriptcode, "`aceicodes'")
label variable acei "ACE inhibitor exposure: 0=no exp, 1=exp"

// Angiotensin II receptor antagonist
local arbcodes="(76333020|81323020|81324020|83501020|79160020|88424020|85705020|85706020|76332020|85707020|83502020|79053020|76329020|82246020|83503020|79054020|81321020|81325020|79055020|86113020|76328020|74672020|78179020|74674020|78212020|78176020|79786020|83507020|87998020|84000020|88788020|85709020|85710020|84004020|83981020|89779020|83505020|83506020|85711020|80124020|80125020|83982020|87994020|84002020|74673020|84001020|81474020|88002020|79035020|81237020|88542020|80730020|78194020|88420020|58831020|84005020|84006020|81475020|81476020|49280020|90629020|81233020|90631020|78191020|57407020|89783020|88006020|88422020|88544020|87996020|89781020|88008020|90637020|90635020|88790020|!8502589|92773020|92953020|92951020|92767020|92367020|92957020|92769020|92763020|92765020|90735020|92365020|92771020|94158020|94443020|94425020|94429020|94427020|91976020|95334020|95336020|90733020|94445020|96351020|96963020|96929020|96923020|96965020|96925020|96927020|97243020|96933020|96931020|97245020|98337020|98339020|91979020|98993020|99779020|99769020|99773020|99771020|77302020|99775020|99783020|99785020|99789020|78259020|77320020|01641020|10510020|41315020|01640020|01771020|01643020|41456020|41317020|77734020|01764020|41680020|10152020|41322020|10518020|42156020|36312020|35425020|10088020|35998020|01748020|99791020|41320020|41310020|38960020|01669020|77299020|41435020|77737020|41324020|78678020|01661020|77731020|77349020|45155020|01673020|39798020|01660020|99777020|43882020|01644020|78684020|01658020|77510020|41454020|10517020|01677020|47162020|10512020|46326020|41316020)"
gen angiotensin2recepant = 0 
replace angiotensin2recepant = 1 if regexm(gemscriptcode, "`arbcodes'")
label variable angiotensin2recepant "Angiotensin II receptor antagonist exposure: 0=no exp, 1=exp"

// Renin Inhibitors
local renincodes="(93926020|93930020|93932020|93928020)"
gen renini = 0 
replace renini = 1 if regexm(gemscriptcode, "`renincodes'")
label variable renini "Renin inhibitor exposure: 0=no exp, 1=exp"

// Drugs affecting renin angiotensin system (RAS) (includes 3 above groups)
gen ras = 0 
replace ras = 1 if acei==1|angiotensin2recepant==1|renini==1
label variable ras "ras exposure: 0=no exp, 1=exp"

// nitrates 
local nitcodes="(63755020|74306020|68455020|68180020|74308020|63754020|55698020|62986020|56366020|50713020|62987020|49981020|63716020|06877007|50712020|06893007|63756020|63012020|55697020|68456020|53308020|53311020|56901020|63007020|63722020|68833020|63030020|62997020|58528020|56367020|63723020|49760020|74307020|74429020|68834020|63008020|62988020|63009020|63731020|83384020|63726020|63034020|78034020|77253020|62992020|63727020|80694020|86999020|65150020|84126020|80276020|90899020|84744020|58551020|51753020|51637020|56902020|69370020|51757020|55699020|54812020|68099020|68454020|63002020|51752020|51632020|51628020|65008020|51754020|63714020|73942020|68460020|59189020|73081020|80693020|68459020|65148020|63715020|84084020|63728020|65149020|59159020|86636020|84747020|80194020|63744020|86634020|85819020|58392020|58398020|49980020|49982020|64846020|64847020|77719020|84745020|66750020|76672020|66749020|51638020|52548020|52164020|58404020|70333020|85976020|56518020|73735020|54157020|65554020|80846020|78055020|66498020|82299020|85974020|78056020|58395020|73736020|56900020|58529020|58530020|49770020|80864020|78415020|73030020|87011020|65550020|63740020|73646020|78922020|56546020|55541020|80848020|55540020|84096020|63743020|51633020|!1488801|!4922601|!3564101|80865020|63013020|87528020|51624020|58389020|85621020|66998020|58401020|80852020|80853020|84742020|!2960301|!3420501|82425020|85681020|77256020|82301020|59155020|06583007|72441020|!3572101|65551020|78123020|84827020|77991020|50216020|!2188501|90545020|!3588301|78416020|86772020|50215020|85689020|56052020|88825020|75723020|78110020|78111020|79947020|78109020|75722020|85838020|84097020|79946020|52165020|84825020|51625020|!3588303|!8504046|66881020|88498020|91586020|79525020|63751020|84748020|70590020|78057020|61644020|79943020|53357020|84984020|65865020|!8504047|60866020|63747020|77791020|59812020|60394020|49759020|55374020|54036020|59428020|49893020|53264020|49899020|61875020|91051020|49884020|78957020|91588020|63759020|69626020|95513020|95515020|95509020|95583020|95873020|95871020|62320020|95511020|55343020|91814020|97527020|66021020|54035020|55375020|49898020|56051020|91614020|63719020|49761020|63014020|49894020|52251020|98416020|78242020|97247020|09555021|08987021|08955021|76504020|10457021|49885020|62795020|63391020|10455021|09550021|08994021|10459021|09556021|55379020|66733020|49765020|60948020|92799020|08942021|65752020|09551021|37821020|37816020|01860020|37809020|91590020|37822020|01836020|97513020|01838020|02122020|02114020|91612020|02118020|01863020|44105020|91057020|99995020|37818020|10463021|37811020)"
gen nitrates = 0 
replace nitrates = 1 if regexm(gemscriptcode, "`nitcodes'")
label variable nitrates "nitrates exposure: 0=no exp, 1=exp"

// calcium channel blockers 
local ccbcodes="(72826020|72827020|72563020|65053020|68508020|65052020|52181020|52179020|57066020|62588020|84301020|52180020|86603020|52564020|84862020|87704020|73827020|64146020|88863020|75164020|60296020|65453020|65395020|65396020|84427020|65057020|60297020|65403020|54944020|80873020|84203020|68602020|68472020|68629020|57176020|65397020|53062020|71948020|64630020|57177020|51541020|52574020|64147020|52575020|68603020|52565020|76293020|84421020|73828020|72565020|75266020|73759020|57067020|49391020|62586020|65031020|58377020|57178020|72560020|51542020|74745020|54862020|58870020|56683020|75264020|75265020|79719020|79074020|72822020|80874020|84204020|68474020|64631020|80337020|74597020|76295020|68847020|72177020|72564020|70430020|75522020|72558020|73758020|75521020|79075020|79521020|74744020|79993020|71013020|74598020|76294020|83624020|62587020|75621020|72176020|52063020|74596020|61582020|85619020|79553020|82933020|72823020|57068020|87706020|87867020|68477020|88865020|65383020|84428020|57458020|58764020|51782020|06750007|03142007|65032020|75515020|69560020|69563020|58375020|75162020|68652020|61573020|56680020|48758020|68479020|00184007|68473020|03901007|03072007|75163020|80875020|65384020|72559020|52064020|79520020|65382020|50475020|54678020|65404020|54677020|74741020|75520020|79935020|79994020|82544020|86770020|84877020|87083020|88897020|81943020|68599020|69592020|58376020|49392020|03117007|79519020|70433020|84876020|74190020|81446020|77698020|87826020|75258020|90541020|58763020|81445020|74740020|86724020|79934020|53065020|68478020|04634007|76104020|81213020|56931020|83066020|54863020|84423020|86668020|87834020|87836020|88895020|53813020|87832020|90705020|78368020|87828020|70830020|71014020|83276020|84570020|75622020|83230020|71435020|90707020|87544020|77697020|82546020|68850020|75963020|87873020|86669020|61583020|84494020|05075007|85589020|87830020|86867020|91263020|78409020|48759020|54020020|53821020|83067020|87887020|53816020|85824020|75491020|84579020|86339020|84734020|84733020|84211020|78452020|84732020|87065020|87067020|80135020|88811020|88252020|84422020|83479020|85883020|86144020|60315020|49568020|81472020|!8504107|04427007|82004020|82002020|86924020|87875020|68687020|65421020|68163020|68693020|05949007|83487020|82932020|56208020|48764020|04635007|79164020|77223020|84468020|51963020|85865020|75490020|57957020|87085020|85903020|86868020|93766020|84957020|!5226101|70715020|86888020|74770020|61572020|06184007|86146020|78451020|87081020|85846020|74828020|!1483101|49566020|60454020|54633020|50256020|70717020|85847020|85943020|!5226102|79356020|70808020|83200020|84495020|68606020|84383020|56814020|84958020|!7642107|81470020|05613007|69392020|86128020|83478020|83480020|53571020|87883020|83201020|87956020|87958020|87891020|91119020|!4904103|!0062301|!4904104|!0061102|!4904102|53572020|90751020|86937020|83225020|86340020|86145020|49118020|53578020|79357020|69393020|69394020|77217020|77216020|65422020|76787020|75964020|81081020|68346020|80908020|91013020|87897020|68574020|60317020|01235007|65430020|70927020|87895020|88981020|65095020|!0062101|88892020|87879020|85815020|05351007|60425020|88258020|50788020|53573020|84959020|88830020|55199020|88260020|91113020|89660020|80745020|90599020|68509020|90601020|85740020|86711020|!1893701|87103020|68690020|78440020|59719020|56849020|76784020|83489020|83488020|86211020|81761020|87901020|56932020|66633020|50800020|80910020|88254020|49567020|55198020|49558020|60639020|67634020|75962020|60682020|67688020|68176020|90565020|66476020|56374020|58953020|50950020|88800020|72989020|59157020|67637020|61468020|68510020|61467020|59923020|49104020|60316020|53802020|49116020|68132020|56848020|54160020|59158020|58954020|53803020|50799020|54545020|87542020|92773020|92953020|92951020|92767020|92957020|92769020|92763020|92765020|92751020|91231020|88983020|92771020|54551020|68410020|93762020|81080020|88802020|81082020|90709020|93764020|94184020|91229020|92999020|88979020|94403020|59378020|73256020|93025020|95521020|95541020|95575020|95537020|95539020|95561020|95559020|95519020|95563020|96330020|95553020|54550020|93987020|95543020|95545020|93501020|94186020|70039020|67735020|96929020|65054020|96923020|72940020|54552020|92015020|96925020|92166020|65423020|96927020|53043020|96933020|96931020|95547020|87899020|56375020|53801020|56209020|60641020|50949020|85923020|68111020|93971020|97882020|68577020|65086020|69923020|54546020|97381020|89315020|75517020|61274020|75838020|49117020|66473020|57071020|60026020|98789020|92017020|98791020|97884020|75222020|97277020|66904020|86212020|56381020|99159020|68495020|64571020|71935020|99053020|91939020|99249020|65091020|63423020|91269020|99779020|54159020|99769020|99773020|00415021|99771020|09562021|65991020|99251020|56930020|60640020|00413021|63403020|85924020|75703020|59413020|73272020|77345020|77105020|99775020|98903020|76823020|99783020|97279020|60424020|99785020|93983020|93331020|95577020|99789020|97275020|87913020|90567020|91943020|68173020|01893020|01882020|01886020|01881020|39292020|11003020|37887020|01884020|01966020|01871020|20875020|38506020|01947020|11007020|00865020|44014020|01957020|01952020|04070020|39293020|41782020|01902020|01077020|99791020|01953020|20553020|01950020|01972020|87907020|68406020|20557020|02008020|04085020|01996020|75178020|68498020|01878020|83043020|18978020|19777020|99312020|87905020|99777020|01943020|93768020|02041020|92170020|59219020|02023020|37888020|02018020|01909020|01958020|47166020|77347020|77966020|47167020|14783021|01954020|01906020|01970020|78002020|96332020)"
gen calchan = 0 
replace calchan = 1 if regexm(gemscriptcode, "`ccbcodes'")
label variable calchan "calcium channel blocker exposure: 0=no exp, 1=exp"

// oral anticoagulant
local coagocodes="(65437020|65438020|89966020|65439020|60995020|51558020|84736020|54866020|54867020|04258007|54868020|54849020|54847020|65650020|65649020|65648020|54848020|51559020|60996020|77096020|!7816102|51984020|52500020|52501020|51985020|55826020|51986020|55895020|50811020|50810020|50812020|52502020|55824020|63426020|55825020|62805020|62803020|62804020|59540020|62856020|55896020|55897020|57163020|93666020|94827020|94825020|95923020|94831020|94833020|95937020|94837020|68098020|65390020|94835020|56201020|56200020|56202020|91752020|99253020|00251021|00253021|62256020|00760021|00756021|00345021|00762021|57161020|96752020|00758021|37790020|39229020|41649020|02298020|02299020|38963020|00347021|02302020|02297020|46752020|39231020|37791020|57162020|20945020|02314020|39232020|63429020|39230020|77754020)"
gen anticoag_oral = 0 
replace anticoag_oral = 1 if regexm(gemscriptcode, "`coagocodes'")
label variable anticoag_oral "Oral anticoagulant exposure: 0=no exp, 1=exp"

// antiplatelet 
local platecodes="(52994020|72648020|52995020|00118007|03413007|54359020|69988020|54360020|73336020|00106007|73356020|52557020|73331020|70336020|49285020|83784020|84320020|75037020|86989020|56280020|51077020|62696020|62694020|83768020|50796020|50795020|00110007|62695020|70337020|58313020|51078020|70474020|50797020|05319007|05334007|55579020|73333020|64637020|84256020|05923007|00119007|03047007|85728020|84976020|84142020|84144020|70312020|85724020|77773020|05925007|05331007|05323007|68709020|63232020|73479020|73352020|03430007|00248007|00262007|03121007|05327007|02694007|74303020|70462020|00094007|03889007|05857007|69426020|02372007|05924007|00123007|05320007|05329007|48725020|65984020|80899020|52996020|63233020|68708020|85731020|68710020|52556020|64412020|00117007|73345020|81582020|05330007|03415007|73332020|48249020|69049020|03414007|80846020|51418020|06268007|04138007|75038020|73478020|05322007|05979007|00121007|82636020|72306020|73337020|62701020|06270007|64638020|56792020|69134020|!8504183|!8504188|74302020|63231020|80848020|78272020|70309020|84994020|82090020|82243020|!0373101|!0379102|03888007|!0373103|!0379101|77403020|00109007|73522020|55429020|79640020|80852020|80853020|65981020|75686020|03768007|63357020|05587007|70461020|75436020|00120007|73531020|03049007|59214020|68537020|05325007|06311007|00105007|00101007|48698020|05328007|!0373301|79130020|66025020|83262020|81581020|70471020|83115020|00196007|00100007|61334020|00112007|56223020|89845020|70665020|63356020|79131020|82494020|72645020|00095007|00114007|00115007|00107007|00111007|79858020|82244020|05321007|00247007|00261007|05332007|82882020|70466020|64485020|!0032801|81579020|00218007|70467020|81796020|03045007|79642020|00122007|63543020|74843020|74842020|82098020|70664020|54011020|56282020|06728007|65980020|86558020|54361020|57868020|58872020|53701020|62304020|48769020|82242020|48770020|72355020|73591020|62496020|05326007|62271020|81954020|66537020|48774020|56283020|62403020|63290020|84545020|72356020|48775020|54012020|48771020|57295020|58873020|51009020|56222020|51223020|59131020|59128020|59503020|66393020|91810020|81624020|92507020|75811020|69425020|70379020|94934020|94936020|96734020|96708020|96706020|51004020|00097007|51008020|96710020|97373020|96712020|59216020|48776020|53703020|95905020|00113007|74305020|77086020|48762020|59945020|56938020|96736020|69677020|57869020|06730007|66396020|99283020|48763020|56069020|55399020|99683020|00396021|53767020|65447020|99285020|78627020|59946020|62226020|77564020|61768020|02354020|02342020|08029020|02346020|04200020|14652020|08038020|02341020|02353020|60705020|59817020|02360020|08034020|78796020|02347020|02384020|29961020|08031020|76832020|63567020|66390020|02380020|04199020|04190020|08036020|69594020|14651020|02352020|08030020|02343020|76842020|74953020|02344020|77882020|63295020|78846020|08040020|02365020|47552020|76752020|47189020|02349020|47188020|77043020|02350020|02364020)"
gen antiplat = 0 
replace antiplat = 1 if regexm(gemscriptcode, "`platecodes'")
label variable antiplat "antiplatelet exposure: 0=no exp, 1=exp"

// statins 
local statcodes="(72488020|83943020|72487020|72489020|83944020|75344020|73782020|85632020|73783020|83945020|87029020|90773020|73784020|73787020|73789020|75345020|72482020|83955020|83953020|73788020|84284020|77174020|81727020|79882020|72484020|80350020|72483020|76621020|83954020|89242020|89881020|75340020|75341020|84282020|84283020|76618020|87027020|76259020|89246020|89260020|89262020|75346020|89258020|87025020|89250020|76624020|89255020|89248020|81729020|89883020|76531020|89244020|76460020|!6579801|!6579802|88103020|65854020|69857020|65848020|66042020|65879020|66045020|65924020|65883020|65927020|65672020|65920020|65851020|66039020|65677020|65668020|65949020|65905020|68205020|65952020|65962020|65910020|65829020|65939020|68275020|66208020|66656020|96566020|72886020|96704020|65874020|68201020|69804020|66993020|68272020|77364020|66659020|88014020|65967020|66205020|65935020|66066020|71629020|66069020|00573021|00569021|00575021|00571021|66058020|66323020|68735020|66063020|65957020|69800020|65932020|68278020|37402020|41848020|37429020|35411020|02512020|41846020|02518020|02496020|41345020|71634020|41330020|41912020|42161020|02514020|02501020|02524020|02523020|38510020|42167020|41343020|02515020|02542020|41328020|38509020|41338020|38511020|41905020|02479020|41913020|02511020|41349020|38515020|02489020|41331020|38514020|41906020|69807020|41347020|41344020|02510020|43826020|41327020|41288020|41329020|65902020|20743020|02548020|02505020|43806020|02506020|38512020|02502020|02519020|02495020|10669020|00042020|66326020|75882020|41292020|02490020|41326020|42148020|66652020|02521020|02517020|20745020|70097020|02485020|42166020|78017020|70094020|02494020|77492020|71626020|02486020|35160020|35413020|41336020|35417020|41907020|02508020|41337020|02557020|38787020|47853020|38784020|47203020|38786020|41891020|02618020|02488020|02504020|47180020|47204020|68731020|41325020|02564020|68450020|47205020|47030020|70090020|02553020|36882020|41342020|02544020|02491020|10666020)"
gen statin = 0 
replace statin = 1 if regexm(gemscriptcode, "`statcodes'")
label variable statin "statin exposure: 0=no exp, 1=exp"

// fibrates
local fibcodes="(64207020|83784020|84320020|64208020|83768020|56378020|70567020|70564020|61456020|56377020|54229020|58844020|70563020|57107020|70568020|62908020|58845020|86192020|86195020|52058020|86191020|86196020|62909020|56989020|86190020|76495020|68384020|86194020|56792020|84417020|!8504188|64747020|!2884501|!0702101|83750020|61271020|61400020|81036020|88794020|71743020|61270020|56740020|94934020|94936020|96391020|96389020|97373020|63947020|77086020|61483020|99683020|00396021|77455020|68507020|77458020|02384020|02404020|02566020|02380020|76842020|77882020|76752020|77043020|68534020|76919020)"
gen fibrates = 0 
replace fibrates = 1 if regexm(gemscriptcode, "`fibcodes'")
label variable fibrates "fibrates exposure: 0=no exp, 1=exp"

// ezetimibe
local ezcodes="(76979020|76976020|89242020|89246020|89260020|89262020|89258020|89250020|89255020|89248020|89244020)"
gen ezetimibe = 0 
replace ezetimibe = 1 if regexm(gemscriptcode, "`ezcodes'")
label variable ezetimibe "ezetimibe exposure: 0=no exp, 1=exp"

// bile acid sequestrants
local bilecodes="(61299020|68873020|51328020|72763020|68877020|81028020|68876020|72766020|87334020|69074020|64593020|57384020|63524020|94247020|94249020)"
gen bileacidseq = 0 
replace bileacidseq = 1 if regexm(gemscriptcode, "`bilecodes'")
label variable bileacidseq "Bile acid sequestrants exposure: 0=no exp, 1=exp"

// lipid-regulating drugs (includes above 4 groups)
gen lipidreg = 0 
replace lipidreg = 1 if statin==1|fibrates==1|ezetimibe==1|bileacidseq==1
label variable lipidreg "Lipid-regulating drug exposure: 0=no exp, 1=exp"

// Bronchodilators
local bronchcodes="(59553020|59554020|52213020|58950020|58949020|67954020|02640007|04558007|62323020|51730020|03059007|48012020|48447020|03509007|66548020|61290020|56601020|48016020|72218020|74013020|52229020|48252020|74018020|67439020|75509020|58268020|55544020|79544020|85668020|52234020|53724020|74015020|73050020|69231020|54334020|52204020|59380020|52877020|51577020|66995020|66994020|59379020|67866020|52215020|48448020|74019020|68159020|79689020|84965020|52203020|86061020|52885020|51576020|71767020|69230020|70362020|70969020|54448020|51729020|59429020|66334020|69341020|63608020|63615020|63616020|56866020|75830020|52100020|49782020|49660020|66335020|70966020|54333020|54710020|74122020|66882020|66884020|67862020|69348020|75004020|69893020|67863020|86841020|70630020|69499020|48393020|53748020|59430020|67011020|66985020|66991020|51595020|55061020|68214020|58951020|68215020|52219020|52235020|68237020|68236020|54914020|85749020|85747020|68390020|69502020|69498020|66996020|03157007|75512020|74020020|50334020|06913007|03774007|02639007|60224020|55402020|52390020|53196020|49217020|03581007|79415020|49125020|51578020|58865020|61724020|61289020|67867020|52218020|75007020|69672020|06699007|69894020|72270020|52855020|53504020|73380020|69627020|48658020|52876020|74014020|79627020|58545020|66984020|57375020|81503020|48442020|64090020|48443020|63381020|77232020|77201020|57434020|51325020|03195007|03010007|75331020|61825020|06673007|49636020|54534020|69671020|52880020|65157020|70617020|52202020|48453020|63612020|58271020|69875020|52214020|67438020|53664020|54702020|48656020|48657020|66980020|57925020|51596020|56865020|69503020|48452020|84485020|75329020|62123020|62935020|73074020|56581020|61821020|70357020|58859020|71109020|56597020|75320020|86900020|79114020|81157020|69006020|52865020|80482020|66887020|68021020|74432020|52653020|52102020|56071020|79690020|85658020|82957020|56067020|79575020|80484020|69628020|84225020|86898020|67064020|59566020|79551020|79609020|52101020|85657020|62345020|84108020|63609020|56593020|67059020|87665020|75330020|87003020|81548020|70622020|82071020|80167020|69895020|68540020|87397020|87824020|87822020|87663020|80413020|86897020|56618020|86896020|88593020|76616020|88632020|88591020|79213020|86176020|88595020|85656020|89366020|81547020|88294020|82961020|85743020|88597020|74357020|87655020|87395020|83918020|90175020|90173020|76355020|54449020|76457020|03492007|70149020|49540020|53511020|70150020|61284020|63040020|65158020|54701020|66883020|55724020|51919020|51918020|66989020|66986020|55441020|57970020|66327020|69876020|57965020|61303020|50785020|51425020|70528020|66891020|48449020|67868020|55380020|62277020|53831020|59196020|71059020|48107020|72219020|65845020|72092020|55442020|72266020|57941020|64829020|03493007|05594007|48103020|48538020|66899020|66535020|06245007|04277007|00182007|66888020|05036007|06395007|55440020|55545020|55446020|52851020|55450020|53500020|03510007|70047020|03778007|66990020|06692007|51108020|70352020|69673020|70136020|66336020|66472020|50627020|63392020|70961020|85793020|72269020|70205020|59543020|85742020|71118020|74212020|70137020|72282020|80897020|79369020|58210020|57931020|77220020|48988020|87661020|54335020|80877020|93744020|86175020|76994020|80648020|05365007|52421020|64071020|52860020|48676020|72096020|06131007|55546020|01828007|66979020|69801020|48671020|71319020|05035007|59203020|61623020|50861020|53336020|66976020|01827007|49862020|66892020|48743020|58823020|52870020|03111007|80411020|55723020|79629020|66183020|66328020|67874020|71110020|85662020|64982020|70741020|71256020|71257020|69586020|87005020|72265020|70631020|64987020|87628020|87325020|84246020|53612020|70141020|69802020|74358020|48985020|66999020|58341020|55348020|03143007|48785020|48793020|02644007|54911020|48475020|55349020|05034007|53826020|03167007|64988020|69697020|62344020|57328020|61826020|80090020|80973020|71255020|82959020|80128020|83865020|85661020|87673020|88296020|62343020|70619020|85660020|56582020|73103020|50667020|57435020|48392020|62444020|48011020|74354020|58774020|86246020|71093020|70129020|86269020|76613020|84245020|82963020|89764020|87659020|62936020|71113020|03011007|73106020|81501020|74353020|67875020|62119020|62118020|76455020|80129020|79433020|80127020|70632020|84248020|66342020|59202020|03898007|05367007|48477020|67002020|66477020|70174020|87001020|64830020|85270020|75904020|66981020|84564020|03511007|55725020|03780007|53667020|02643007|69342020|71114020|70199020|87651020|87657020|87653020|83949020|90801020|76923020|81569020|51100020|72193020|79878020|88298020|68202020|65330020|76349020|79877020|87669020|87671020|89379020|89373020|59197020|55347020|52222020|51988020|62122020|70223020|86957020|87667020|85765020|55525020|71393020|66896020|53918020|05997007|88622020|88630020|90799020|54535020|61302020|80152020|06588007|72097020|55528020|86188020|67876020|68203020|78071020|66184020|52875020|48789020|02642007|69343020|61304020|64092020|05364007|64091020|63037020|70130020|!7637114|!7637115|!7637105|!2242901|!7637110|!7471302|!0411102|!2242301|54414020|!0411101|48203020|66339020|73710020|86393020|55363020|65324020|62951020|00170007|61052020|51734020|00171007|77878020|!9131025|!2239101|!0411301|!6452118|70142020|!3550103|69346020|82037020|87675020|03775007|48742020|54277020|06394007|78819020|70962020|57247020|70123020|64983020|48471020|53582020|57680020|55711020|91243020|55688020|!2242303|03891007|54910020|84223020|!2239103|!2239102|!2239504|!0578301|85582020|70196020|85766020|71909020|70231020|64989020|83203020|84022020|!6452108|!2240302|!6452101|51655020|91085020|02645007|65846020|57254020|66478020|58791020|71115020|71094020|48788020|80165020|79058020|88628020|61458020|!7637106|88636020|53830020|03815007|56682020|67095020|51915020|03777007|85800020|05366007|48517020|48507020|48508020|48480020|48479020|00168007|72093020|58824020|77988020|52224020|58825020|59132020|85799020|85805020|70126020|!3550102|00181007|!6451901|!7110111|88147020|71060020|!8504810|56676020|79059020|73086020|83893020|68543020|90805020|90803020|85806020|89766020|64984020|48482020|53832020|65849020|64837020|00169007|55362020|83679020|88620020|!7637103|63620020|!2242302|!8505148|02641007|76168020|!2241901|48467020|67005020|58029020|48456020|55364020|!5637101|59710020|83542020|62124020|74430020|77093020|73418020|62950020|62749020|70316020|75926020|56613020|63621020|!7637111|05369007|66345020|70349020|62750020|03419007|58342020|87612020|75901020|82024020|51459020|06323007|54287020|75925020|75899020|52223020|03776007|75900020|55767020|87610020|87630020|90648020|56074020|69347020|60164020|85638020|81239020|84038020|00064007|73421020|58220020|61514020|88340020|53422020|53424020|69142020|79713020|68160020|80844020|70900020|56813020|70175020|55019020|02986007|85729020|70320020|85269020|83891020|67813020|!8505539|!7471301|70173020|58101020|51445020|89885020|83917020|87604020|50543020|48210020|05031007|73196020|63930020|50544020|49606020|63698020|65225020|48534020|84460020|86005020|73087020|50790020|68803020|01829007|72863020|59528020|63418020|48496020|48214020|88991020|68483020|63926020|79991020|49972020|60625020|48481020|79029020|63650020|59499020|53423020|48486020|48485020|68156020|51597020|59498020|54511020|48518020|48492020|49841020|55686020|55687020|48498020|61776020|50518020|49842020|48484020|48528020|50533020|62351020|53726020|48509020|50525020|48516020|48497020|49846020|49838020|55434020|48490020|50534020|92697020|92699020|92695020|92693020|98381020|92979020|92829020|92977020|92683020|92971020|91913020|92823020|61143020|92685020|05822007|92985020|92679020|92677020|73090020|73091020|70234020|66482020|94071020|94073020|94243020|94307020|94305020|61144020|59149020|63617020|94439020|94821020|92567020|94863020|56098020|72615020|94867020|71457020|49607020|94245020|94865020|94869020|94542020|56099020|63484020|66240020|94544020|03072021|48254020|03068021|96077020|95819020|65159020|86455020|94956020|03143021|96367020|96622020|03147021|96488020|96484020|60390020|48491020|97103020|96111020|96482020|96091020|69361020|73590020|96099020|55369020|55020020|55302020|50526020|49845020|66781020|48502020|06788021|50322020|87105020|90678020|06790021|97706020|64252020|06789021|70948020|54415020|97872020|96107020|53940020|48513020|69872020|68262020|48469020|98212020|98214020|56229020|98210020|48283020|71320020|97117020|98345020|98341020|98422020|98208020|98206020|98481020|98290020|98562020|98564020|99023020|99015020|99009020|99011020|50537020|10427021|99013020|10426021|79255020|99124020|99019020|91780020|48533020|72916020|96480020|98485020|60627020|99558020|77674020|00018021|00503021|00505021|99426020|68269020|00441021|99101020|00186021|51267020|69882020|00695021|00402021|92481020|71888020|36408020|36165020|02650020|02648020|41350020|02813020|29119020|02739020|02651020|02645020|02641020|02737020|27988020|00053020|44134020|44135020|02639020|02642020|02643020|20146020|02653020|27986020|21906020|39298020|36912020|02795020|20020020|21883020|21582020|29120020|21579020|02638020|02659020|39799020|02756020|21583020|44177020|14019020|21904020|39925020|20144020|02742020|00054020|02657020|10754020|02732020|02734020|44176020|02760020|35835020|00046020|02766020|40432020|00048020|21902020|02764020|02817020|02744020|21580020|35860020|19597020|02688020|02644020|02640020|40434020|10755020|03674020|03122020|02678020|69151020|09173020|02755020|14017020|02745020|02658020|00047020|67162020|46187020|36520020|46231020|46188020|20026020|20138020|20136020|63694020|41990020|29799020|17582020|03679020|83932020|45460020|03675020|70945020|02763020|20022020|20018020|20016020|14632021|20002020|46991020|19689020|29397020|02704020|02721020|03734020|36865020|38455020|14633021|38454020|03673020|02796020|02654020|40428020|17172021|02655020|02702020|10892020|02718020|21903020|37495020|16929021)"
gen bronchodil = 0 
replace bronchodil = 1 if regexm(gemscriptcode, "`bronchcodes'")
label variable bronchodil "Bronchodilator exposure:0=no exp, 1=exp"

// Corticosteroids, inhaled
local cortinhcodes="(69246020|66163020|65229020|59234020|57212020|63962020|59375020|53685020|71488020|59233020|79544020|85668020|56622020|66681020|64502020|48313020|64503020|68210020|48314020|79401020|84968020|83499020|73579020|64256020|79577020|56267020|52706020|73585020|74386020|73578020|64257020|73580020|74677020|74679020|84714020|56476020|56264020|57151020|48309020|69244020|79402020|67266020|69255020|53718020|62322020|51300020|81070020|48324020|75190020|74455020|75187020|74986020|53711020|56477020|84970020|66682020|61707020|52570020|74987020|53690020|79400020|84967020|74422020|53748020|75700020|57150020|57356020|84708020|54707020|81155020|79478020|57355020|68211020|65885020|65884020|65228020|53694020|73436020|52569020|05675007|53686020|69624020|54705020|74421020|68209020|83727020|79605020|58166020|86874020|51502020|79578020|58170020|74423020|56753020|57208020|66162020|74990020|69118020|61708020|57935020|69623020|75179020|56475020|69245020|64080020|48413020|53712020|79444020|64079020|86871020|04473007|86883020|74985020|51299020|57934020|04471007|86873020|64090020|73584020|77232020|56623020|48110020|03115007|64050020|61709020|81072020|55046020|48111020|53710020|03114007|74454020|54871020|51641020|75701020|75669020|50024020|67172020|74459020|74992020|74678020|62327020|06378007|69622020|58165020|86884020|67171020|54706020|53691020|85880020|67851020|74991020|69249020|62321020|65880020|82721020|51503020|75192020|65881020|75668020|86900020|79114020|69006020|76452020|78909020|60097020|53820020|64586020|77000020|79503020|83217020|57312020|85658020|75191020|78908020|78907020|63966020|76999020|76451020|54829020|86898020|75181020|53819020|85657020|76450020|79502020|66266020|57702020|83358020|82630020|81548020|73349020|87764020|87864020|86897020|87766020|86896020|76616020|54830020|79213020|86176020|88722020|85656020|87862020|81547020|90127020|90125020|88708020|06379007|74458020|63963020|74460020|69251020|64163020|52571020|75184020|79604020|69254020|48310020|04472007|54498020|64258020|03958007|58375020|74453020|56680020|48315020|69758020|75180020|75255020|69250020|66683020|66263020|85796020|81507020|85879020|82719020|86879020|57978020|86870020|88716020|86175020|84120020|54252020|84348020|62329020|58376020|81505020|84099020|67874020|62328020|51642020|85662020|86638020|57281020|77001020|71256020|71257020|75254020|86878020|75644020|64583020|54821020|54052020|54051020|71255020|80128020|85661020|66686020|69469020|54046020|85660020|91163020|64582020|64511020|54831020|55044020|52332020|82720020|57986020|71641020|64579020|88500020|91157020|89948020|91526020|54013020|58167020|81511020|64049020|67875020|85881020|85797020|73583020|80129020|80127020|89887020|92107020|83816020|91155020|52333020|81506020|79088020|80792020|69119020|87972020|79479020|91167020|91165020|91161020|79928020|57311020|85228020|89946020|79364020|90129020|89940020|91308020|91322020|91153020|68202020|69759020|85168020|90161020|69787020|57282020|80362020|89688020|90421020|90131020|66689020|!8503876|!8503881|!8503882|!8503875|79487020|!8503879|84101020|72923020|71982020|81509020|67876020|68203020|86508020|76542020|79850020|82890020|64578020|88502020|89962020|81510020|64092020|61726020|48764020|64091020|85795020|84313020|79501020|64083020|82204020|56502020|89346020|83660020|52275020|!0577198|!0577199|!5938605|84020020|54053020|77517020|62982020|91159020|88720020|50409020|58819020|56344020|85166020|53305020|64512020|64051020|54823020|54822020|!0578301|89236020|56814020|64087020|56343020|!5938702|87974020|53571020|54826020|57954020|91511020|66701020|!0577601|84019020|52778020|73348020|53572020|60177020|72920020|84379020|76954020|83893020|83409020|71983020|56347020|56520020|67076020|91515020|53578020|56573020|57987020|!5938601|90423020|91528020|91518020|92109020|64086020|66311020|!5938606|89936020|61524020|54045020|66690020|59093020|!2659617|57658020|91259020|59466020|61525020|50410020|59873020|84018020|50788020|53573020|58817020|50400020|69788020|05303007|52276020|63927020|52777020|67080020|61523020|67173020|80844020|71986020|90425020|89938020|90137020|83891020|05302007|54231020|58818020|59468020|61648020|60981020|77168020|50401020|51719020|91520020|60820020|59872020|92101020|60178020|91524020|57662020|63536020|61132020|59874020|63653020|54227020|50399020|63531020|50408020|57098020|56537020|65314020|59307020|65523020|61147020|67073020|54228020|65526020|65723020|63539020|61619020|53490020|53489020|60176020|60982020|51718020|92111020|93053020|93043020|93055020|93049020|93059020|93279020|93057020|93047020|93063020|92103020|93299020|93297020|91522020|93045020|93051020|92434020|93289020|92285020|92279020|92711020|92281020|93039020|93525020|92719020|93291020|92727020|93273020|93041020|92105020|93293020|91253020|92729020|92601020|93275020|91532020|93287020|93265020|92815020|93257020|92277020|93281020|!8503874|93263020|93285020|69464020|89274020|93295020|93817020|93527020|93914020|93912020|93821020|93391020|91530020|93819020|88958020|94307020|93259020|94305020|92436020|56624020|94347020|55581020|88960020|96231020|96155020|95879020|58956020|75895020|94815020|96413020|70960020|96157020|61972020|75892020|96233020|59247020|97060020|97064020|97058020|97068020|97070020|97072020|97054020|97062020|97066020|97056020|92817020|74124020|63923020|69256020|55527020|64355020|97774020|97776020|97772020|98218020|98216020|98222020|98224020|65838020|68754020|99086020|56381020|99414020|99456020|99418020|99600020|99422020|99705020|99701020|99695020|99699020|63918020|99709020|99707020|99164020|99168020|65991020|00116021|99162020|00118021|00804021|00186021|00114021|99655020|00806021|38603020|11073020|08877020|07447020|44175020|37296020|10734020|02739020|06598020|06597020|07440020|07455020|06599020|02737020|00053020|09076020|38602020|40235020|38762020|02876020|02943020|44174020|40579020|07441020|44173020|13400020|10737020|09079020|10725020|08914020|02756020|44177020|14019020|08913020|02742020|00054020|99088020|02732020|08921020|07335020|02734020|44172020|10727020|09080020|44176020|09060020|02760020|10720020|10736020|20827020|00046020|02766020|10726020|06607020|00048020|39336020|02938020|02764020|02744020|37295020|39412020|07336020|07444020|13412020|44422020|10732020|02951020|72099020|07439020|39875020|92021020|02755020|14017020|02745020|33911020|06634020|07337020|08922020|10735020|00047020|09089020|41299020|08874020|33915020|44423020|10721020|10729020|33907020|36581020|44424020|46810020|46809020|34075020|46808020|08876020|06568020|47951020|47952020|06621020|02763020|74394020|39413020|47981020|08883020|02818020|02827020|02932020|02895020|02898020|02904020|10722020|02858020|02912020|47496020|14717021|08908020|99711020|47527020|74399020|08919020|02909020|02930020|02897020|02831020)"
gen cortico_inh = 0 
replace cortico_inh = 1 if regexm(gemscriptcode, "`cortinhcodes'")
label variable cortico_inh "Inhaled corticosteroid exposure:0=no exp, 1=exp"

// Leukotriene receptor anatagonists
local leucodes="(86075020|86095020|86074020|86644020|86070020|86073020|87648020|86630020|86071020|87656020|!8503861|!8503862|84379020|76954020|83893020|83409020|80844020|83891020|77168020|92815020|92817020|00186021|03061020|36581020|14448021|14602021|10861020)"
gen leukotri = 0 
replace leukotri = 1 if regexm(gemscriptcode, "`leucodes'")
label variable leukotri "Leukotriene receptor antagonist exposure:0=no exp, 1=exp"

// Antihistamines
local ahistcodes="(70930020|69707020|66905020|53733020|52011020|53228020|48016020|51157020|58268020|57397020|48231020|79198020|63331020|58892020|60148020|51103020|66906020|61021020|52141020|51158020|66293020|69711020|69712020|84724020|53331020|48993020|61233020|52013020|49782020|68661020|63332020|61228020|69708020|51105020|52730020|04535007|02869007|48230020|48284020|72203020|74607020|62591020|68390020|84287020|69259020|63333020|52140020|61022020|84286020|51159020|62612020|68662020|84289020|74601020|63896020|49391020|70931020|52965020|48232020|61020020|67339020|60149020|61715020|63895020|53328020|66290020|69224020|03845007|61388020|51104020|64424020|52326020|64315020|57485020|53229020|58262020|71664020|49820020|86384020|64248020|58271020|69875020|50406020|68756020|69019020|78825020|84996020|79389020|74605020|71764020|66289020|51064020|86337020|85209020|82074020|61230020|82079020|55609020|81030020|77872020|81696020|86403020|51097020|53511020|65653020|50873020|67015020|51969020|57941020|67289020|61389020|51838020|51951020|65252020|62658020|58785020|53762020|06692007|86388020|52327020|86366020|80897020|57931020|70551020|87762020|86933020|84864020|80877020|86261020|71315020|57794020|48007020|60173020|61716020|52325020|63894020|49392020|71660020|72066020|77994020|70216020|78009020|51785020|80887020|48008020|51839020|51065020|66286020|67286020|51264020|03167007|73706020|48011020|73707020|71093020|81093020|81803020|03584007|79768020|59741020|52613020|67016020|67285020|82000020|75887020|64056020|78012020|81569020|65641020|79202020|87037020|65638020|67014020|51968020|86935020|79200020|50169020|62674020|61675020|68755020|83633020|64323020|73534020|65611020|74606020|03264007|69221020|84271020|83636020|!5675103|87456020|71757020|77896020|71760020|71763020|86265020|04491007|75410020|72069020|73537020|51087020|75425020|51970020|83229020|83635020|70231020|80178020|90611020|68537020|74602020|83231020|71094020|70351020|81701020|70266020|59137020|70244020|!7031103|04198007|71659020|81700020|71309020|81450020|86692020|61674020|04595007|65601020|89008020|06400007|70300020|82100020|82483020|77897020|76168020|84937020|82628020|62602020|62749020|!5514102|62750020|55412020|70280020|83345020|55885020|83233020|70235020|79232020|63789020|63842020|64529020|82006020|83632020|55408020|65282020|75426020|84843020|71663020|62812020|77982020|65563020|89130020|61394020|63472020|77729020|62424020|82130020|86360020|56879020|75334020|76162020|80446020|79298020|59757020|72863020|71668020|91075020|62672020|83601020|81698020|64712020|65273020|79285020|89186020|61229020|66625020|65279020|65276020|63813020|65295020|65317020|67680020|90815020|89762020|93495020|93493020|91410020|93485020|92911020|72799020|70234020|66357020|80716020|81441020|93841020|93585020|71809020|74229020|71135020|79204020|79299020|61671020|93423020|90139020|96149020|96459020|66448020|65360020|92635020|97107020|87870020|97094020|97105020|97092020|97109020|97119020|76061020|97129020|64089020|68471020|64252020|74078020|98007020|69872020|84048020|84234020|92569020|75505020|87192020|94128020|92987020|60659020|74082020|98602020|98611020|75500020|98604020|99124020|66007020|64551020|63893020|64198020|98268020|96804020|69396020|99805020|61677020|97660020|69882020|41246020|03038020|02988020|02985020|02807020|44130020|94102020|03041020|41247020|03051020|03054020|41204020|44131020|03047020|75257020|02973020|92653020|39299020|02978020|66849020|99807020|03024020|02804020|00064020)"
gen antihist = 0 
replace antihist = 1 if regexm(gemscriptcode, "`ahistcodes'")
label variable antihist "Antihistamine exposure:0=no exp, 1=exp"

// Hypnotics and Anxiolytics
local anxcodes="(68342020|58928020|58980020|58981020|72416020|56015020|56013020|58828020|80077020|48016020|67809020|56014020|63495020|61205020|49285020|58268020|61174020|64057020|48231020|72417020|68341020|63331020|48406020|51103020|66877020|52141020|66293020|65135020|58993020|72641020|68824020|53331020|48993020|61233020|58982020|49782020|51220020|60737020|63332020|51105020|52730020|68343020|70625020|02887007|55980020|57567020|73274020|75869020|51978020|48230020|48284020|72203020|75692020|49185020|49186020|68390020|58994020|60736020|58756020|58986020|58692020|74215020|68298020|52129020|66878020|67227020|52140020|65063020|55754020|61178020|51433020|74601020|64406020|50741020|70610020|67803020|48232020|48849020|61431020|67806020|75696020|66997020|60742020|50719020|67339020|62418020|50718020|58687020|72408020|48281020|64061020|64062020|53328020|49790020|66290020|58776020|68294020|75078020|51104020|69128020|50428020|64405020|65066020|64060020|75697020|70096020|61509020|69328020|74115020|55393020|62417020|62713020|58757020|62052020|48848020|59078020|55660020|55659020|67520020|65255020|59841020|62426020|83069020|71664020|77123020|64248020|52130020|58271020|57880020|69875020|50182020|60738020|49709020|59840020|02708007|65702020|55663020|65606020|56589020|50406020|69538020|57571020|76105020|76108020|73785020|73780020|69332020|67149020|76479020|77134020|69019020|85821020|66179020|70614020|78825020|68821020|57443020|65966020|71940020|86244020|56586020|86241020|67154020|67146020|81289020|65948020|65970020|74120020|75256020|74123020|74875020|68295020|82852020|75693020|71764020|49794020|79881020|72285020|66289020|84064020|76102020|82893020|85209020|55982020|83533020|72629020|62427020|86240020|66266020|71939020|86356020|82630020|73101020|70093020|84679020|79643020|73242020|61513020|74862020|77953020|77947020|87752020|87764020|71941020|87766020|86403020|66360020|62425020|74869020|80126020|87815020|90430020|70627020|78215020|70626020|72953020|81287020|90340020|90338020|96597020|84657020|70611020|89513020|91390020|48407020|51097020|48240020|53511020|62053020|70449020|66879020|67226020|03625007|50375020|62440020|50487020|55981020|73280020|65319020|65067020|03804007|52074020|51854020|62422020|57941020|62421020|57881020|64995020|48601020|64409020|49555020|67533020|60743020|72638020|67926020|54645020|59842020|61398020|62441020|73176020|02707007|50188020|68299020|75305020|50189020|62416020|79693020|73653020|73659020|67003020|66050020|06692007|67823020|73884020|65931020|73538020|69584020|73776020|75306020|66263020|76465020|86243020|57575020|67486020|50177020|84226020|84229020|84233020|80897020|65068020|57931020|84809020|82832020|78103020|87088020|84231020|77956020|78101020|80130020|70551020|69596020|92211020|81275020|79451020|80364020|80877020|71315020|89359020|92193020|90715020|67019020|52131020|05776007|72955020|55655020|52112020|53868020|61197020|02283007|50734020|64340020|50733020|56351020|61716020|71660020|02706007|48244020|72066020|56606020|66178020|49671020|64412020|80898020|67487020|70216020|78009020|84224020|84222020|82698020|88996020|81771020|82759020|80079020|82154020|91018020|73129020|89501020|92284020|91020020|94734020|94660020|88933020|87750020|51785020|50176020|58689020|54644020|61186020|51065020|75134020|48189020|66286020|75133020|51507020|02535007|50769020|48188020|73178020|50187020|58652020|58653020|51506020|56352020|48224020|48223020|58688020|83245020|75307020|55658020|78385020|79960020|70619020|89956020|91384020|54650020|67929020|51592020|51588020|48011020|48956020|79455020|57514020|73098020|73247020|71093020|81269020|83934020|89509020|81093020|78388020|81803020|90428020|89403020|89468020|87343020|94304020|51221020|91009020|03584007|73656020|67528020|51587020|51589020|02320007|61964020|79964020|66428020|84677020|82772020|78037020|89499020|79768020|70584020|53740020|94658020|59741020|72667020|58226020|83568020|81263020|86495020|88999020|81769020|78572020|89363020|78566020|50709020|59765020|67525020|67524020|82000020|85822020|82156020|81776020|78569020|79088020|91014020|82770020|81778020|53992020|70100020|77950020|73239020|94834020|52117020|79529020|85168020|82774020|91016020|89474020|81293020|87084020|67519020|50193020|61675020|81291020|82202020|89391020|94640020|68755020|48245020|87078020|88274020|89808020|83633020|87336020|94624020|50737020|68725020|49187020|65611020|96464020|66184020|88262020|50744020|02534007|64598020|67045020|55608020|69221020|67042020|92094020|88994020|88986020|52122020|02709007|53193020|88270020|83636020|87456020|64231020|83580020|71757020|52642020|84652020|52121020|73169020|71760020|89503020|94654020|96180020|52136020|63421020|!7832102|!1249701|!1249702|!7832101|73180020|71763020|56041020|49507020|04491007|68724020|75410020|89507020|89505020|72069020|52944020|50770020|67536020|64339020|85166020|66332020|51087020|82200020|!1249703|69587020|83229020|83635020|70231020|64230020|80178020|68537020|05777007|74602020|83231020|81701020|73177020|64054020|61209020|52898020|70266020|72951020|63860020|76152020|51614020|59209020|70244020|62057020|03925007|71659020|81700020|!1845109|86501020|88276020|64415020|96460020|71309020|60744020|92391020|86692020|65258020|61674020|48605020|70300020|82100020|96458020|89401020|61181020|94646020|66427020|94656020|96462020|62749020|56161020|86499020|54651020|62750020|59025020|60752020|70280020|67530020|!1249102|49515020|63861020|52135020|59073020|83233020|53751020|59277020|50485020|59210020|79232020|52633020|82006020|83632020|63881020|61793020|59236020|58693020|69283020|60754020|52125020|59785020|71663020|50701020|62812020|64738020|54008020|55539020|74982020|64733020|64644020|82130020|50756020|50194020|75334020|76162020|49505020|73171020|52075020|53786020|96699020|54986020|54983020|51936020|53466020|50490020|62963020|59237020|72863020|59082020|50645020|82705020|71668020|85562020|81698020|50702020|59784020|50471020|49520020|58806020|66946020|79285020|54007020|55423020|53465020|50499020|58694020|51447020|65787020|60610020|50859020|53333020|64045020|61795020|60751020|60685020|63765020|53646020|49130020|63490020|60763020|53334020|59161020|60533020|56921020|49955020|49124020|62837020|59162020|60509020|53467020|64048020|49521020|60532020|63139020|49516020|53356020|53379020|60686020|50494020|63033020|51544020|59593020|64213020|64053020|49506020|59594020|50468020|63436020|49456020|49457020|65546020|53474020|50484020|49121020|89480020|99874020|91951020|89762020|99962020|99964020|92084020|99966020|99977020|99989020|99968020|99987020|99981020|91382020|50500020|93495020|98213020|98211020|98215020|99868020|92285020|92279020|92281020|96701020|72958020|99973020|90395020|99882020|93493020|91410020|96703020|50646020|50935020|98209020|92277020|00161021|99870020|71875020|90393020|99862020|70234020|66357020|48237020|61571020|49133020|49359020|93817020|99864020|93821020|01017021|99983020|99956020|99969020|93391020|01492021|93819020|99971020|65074020|71809020|01482021|99975020|01483021|01018021|94513020|94516020|79204020|91897020|91380020|94922020|94924020|61671020|68864020|50687020|50688020|02078021|02470021|02846021|02122021|02845021|02844021|02898021|02847021|02899021|90139020|02896021|02927021|02928021|02848021|02894021|03253021|02472021|02126021|02471021|51443020|04528021|04526021|96909020|59278020|04949021|53750020|87870020|97094020|97092020|05145021|05144021|97191020|05149021|97193020|82618020|54170020|66962020|49134020|55860020|53380020|50489020|55034020|65835020|57821020|49150020|53651020|55214020|55043020|56873020|56874020|61412020|57820020|55035020|55213020|53335020|53475020|49522020|50696020|53471020|64484020|65832020|50860020|50695020|06742021|06740021|52446020|!4917102|92023020|53476020|06741021|64252020|63882020|06739021|06744021|06746021|06745021|07261021|69872020|71710020|07401021|07387021|07431021|07434021|51444020|98343020|98420020|07457021|98345020|98422020|08749021|07459021|77191020|72952020|07425021|07413021|51814020|68857020|49647020|60510020|92987020|54267020|49646020|64487020|09452021|09451021|01781021|07398021|09547021|09546021|07419021|07416021|60757020|98777020|09592021|09594021|10425021|54258020|07395021|09058021|99124020|10231021|09593021|63587020|61794020|91937020|92027020|50936020|65974020|57123020|61689020|61199020|68615020|68875020|62715020|99347020|10739021|99021020|99452020|74808020|99458020|61200020|00493021|00495021|00499021|00497021|00479021|61690020|00445021|93557020|63141020|56303020|49151020|60189020|57124020|63140020|00501021|97868020|97660020|07399021|69882020|78426020|61196020|95159020|36534020|20436020|38077020|37296020|39882020|39881020|37413020|12129021|37744020|43907020|43908020|07836020|43918020|32763020|11959020|37743020|11951020|12243020|12247020|41761020|11952020|07821020|35105020|13319020|28331020|03295020|29008020|18676020|12741020|12705020|66824020|07748020|12088021|12091021|07746020|11958020|12245020|12244020|12248020|13318020|02988020|13326020|12745020|30195020|28334020|35488020|44097020|07811020|12090021|44351020|41627020|11960020|13293020|37958020|39883020|07775020|13297020|13304020|07741020|29013020|13306020|13289020|12092021|28333020|28332020|44101020|12708020|12701020|13337020|11953020|11950020|13328020|07834020|13285020|07820020|13296020|13295020|37282020|13300020|13325020|29014020|21699020|20867020|18064020|94102020|37154020|44049020|12246020|19339020|07761020|29009020|29015020|13303020|07753020|29012020|05159020|07826020|15055020|44083020|29051020|07790020|37295020|36291020|36293020|38438020|39801020|36712020|10827020|07750020|07773020|35157020|07770020|43864020|21700020|37137020|32767020|18279020|07769020|07765020|37153020|07755020|37959020|41628020|37961020|44107020|32761020|13334020|07758020|36179020|07786020|07794020|13292020|07788020|21691020|07778020|36292020|07752020|29011020|07772020|21678020|07813020|29010020|21690020|36643020|07787020|07751020|13288020|13340020|10229020|20871020|13302020|28339020|35156020|07771020|43921020|07835020|21685020|37381020|07824020|10380020|20717020|93179020|13299020|06360020|10227020|63597020|36175020|47020020|47021020|44179020|35389020|07757020|36641020|37162020|21679020|52445020|47018020|21689020|13331020|13301020|29016020|14561021|03226020|74527020|39299020|71281020|19337020|13333020|07819020|13232020|75741020|37333020|21688020|36714020|07822020|20432020|15503021|37283020|07800020|43866020|21681020|07763020|47019020|14501021|07823020|46781020|06355020|13307020|06357020|47904020|74813020|13327020|46105020|36177020|07797020|18062020|07805020|73607020|15052020|13339020|47229020)"
gen hyp_anx = 0 
replace hyp_anx = 1 if regexm(gemscriptcode, "`anxcodes'")
label variable hyp_anx "Hypnotic/Anxiolytic exposure:0=no exp, 1=exp"

// Drugs used in psychoses and related disorders
local psycodes="(66237020|52434020|52438020|52716020|53721020|03585007|02867007|59368020|49490020|63104020|61493020|52433020|63108020|68249020|51690020|52435020|68531020|68729020|62026020|65588020|77749020|77912020|67093020|59369020|64015020|66307020|80221020|49428020|51252020|59370020|53253020|54495020|54494020|75978020|67027020|52046020|67028020|52717020|58614020|67235020|83405020|61531020|67029020|51677020|51676020|48713020|53727020|53728020|61754020|66242020|64020020|66308020|52047020|64750020|61719020|62032020|51683020|75976020|66020020|52775020|66241020|58509020|73249020|66836020|53030020|61237020|48900020|53031020|65589020|62025020|68096020|61414020|54493020|63118020|61236020|65797020|64105020|63110020|63105020|49065020|81014020|61413020|51682020|67236020|63419020|49491020|49489020|67037020|56445020|72792020|72793020|61496020|57357020|72987020|49929020|67032020|03097007|75253020|49667020|59374020|72991020|58725020|52958020|52968020|72988020|63113020|58525020|83403020|49666020|68532020|50224020|51013020|02048007|51251020|68728020|67036020|74196020|63103020|58697020|68072020|56446020|62878020|53027020|61511020|50445020|66238020|67239020|49503020|61244020|49502020|67148020|48817020|52695020|72226020|51255020|65503020|69516020|61243020|52694020|58517020|69608020|49437020|85992020|65189020|86000020|64327020|55179020|85204020|85207020|85993020|63115020|62037020|53729020|48140020|62189020|73799020|85203020|64751020|59376020|51691020|72187020|80109020|56175020|50459020|74587020|67202020|83404020|68280020|62029020|48897020|72839020|65798020|85972020|57489020|80222020|79182020|86824020|77843020|85994020|73038020|74586020|80591020|81016020|66245020|64326020|86001020|63136020|50497020|57490020|79476020|81015020|66278020|81945020|89812020|58506020|80139020|80847020|87944020|87946020|77838020|80207020|55972020|59434020|85215020|65593020|79165020|74929020|67902020|87045020|93801020|70972020|80206020|80208020|83574020|88875020|87840020|56187020|51687020|56450020|56468020|51692020|63459020|50677020|65579020|49429020|58429020|69820020|50678020|65580020|64016020|51686020|03657007|51357020|02865007|72580020|72581020|61025020|70873020|72227020|02431007|56183020|72597020|51663020|72606020|72588020|67240020|63369020|65799020|52248020|62033020|56444020|04392007|63456020|64017020|73439020|66837020|49952020|56176020|51678020|03249007|62048020|61238020|66838020|74928020|49439020|48714020|73798020|55210020|66246020|49408020|49438020|61507020|70973020|73253020|82780020|85206020|80218020|61242020|78059020|85202020|86420020|02325007|01793007|51878020|67038020|73791020|63114020|66880020|05892007|49534020|62049020|01796007|63123020|52921020|04799007|66277020|73193020|62066020|50164020|64031020|65842020|65341020|61408020|74930020|75301020|80220020|74135020|78930020|76831020|82239020|65726020|64030020|61791020|73875020|67241020|82789020|84646020|73800020|88877020|81543020|89950020|03692007|67405020|53053020|05178007|52957020|65584020|61512020|53586020|02978007|58510020|63109020|48541020|52842020|73440020|48299020|69227020|03385007|03085007|63448020|57138020|82827020|50583020|61506020|62188020|84894020|73254020|65344020|58502020|75302020|88473020|75977020|95596020|51649020|56177020|48712020|72300020|03241007|02868007|56182020|56181020|61508020|64029020|56506020|80202020|01850007|57877020|83399020|78913020|80204020|52648020|65190020|72577020|57938020|88475020|93072020|88666020|91368020|91364020|72836020|66282020|78912020|82616020|77550020|55786020|85216020|62034020|87952020|85212020|89976020|64023020|91582020|56832020|58518020|62879020|72183020|58513020|64026020|66279020|56456020|69517020|65581020|63427020|75277020|03734007|74592020|03134007|63124020|65531020|80203020|79814020|77501020|74593020|88885020|90165020|73475020|06967007|76250020|84895020|65592020|79499020|86496020|86494020|65788020|87948020|91143020|85999020|78753020|81545020|82828020|82831020|79593020|65587020|62042020|02870007|61249020|75300020|75276020|50780020|63460020|66283020|58017020|52249020|72576020|85213020|85211020|83397020|84896020|88668020|88202020|89970020|89972020|82057020|89974020|69821020|51681020|59150020|66968020|81008020|74591020|!8504040|67234020|74588020|56481020|73474020|03897007|95702020|91584020|!7266001|04040007|!1754106|82829020|67480020|58203020|02122007|76734020|72042020|66897020|67249020|67248020|50679020|58514020|88169020|64330020|87047020|64108020|83398020|57186020|91596020|!4599103|!7263106|63466020|91404020|72297020|02121007|58500020|67245020|74187020|!8504117|73441020|77514020|82837020|86351020|97057020|!4599301|87556020|67244020|58501020|80696020|52922020|90145020|05835007|87950020|58505020|69003020|!1755101|!3814301|50781020|56048020|57187020|79243020|84837020|02326007|!1377104|61250020|50472020|56833020|82835020|56515020|80154020|!5885103|!4599102|!4599101|79594020|58519020|65318020|!2619101|!6746109|50423020|51832020|87842020|91592020|63137020|50782020|61251020|01794007|56188020|87099020|92053020|!6746102|87954020|87980020|!5515103|55209020|61264020|05888007|04913007|88167020|86374020|63470020|82836020|91141020|60250020|55202020|55217020|58894020|63161020|49432020|90147020|90151020|79348020|49477020|!1281110|63160020|84860020|55772020|59028020|57101020|91139020|54878020|96046020|55530020|60605020|53896020|56337020|63548020|66010020|52959020|85990020|50437020|92208020|90167020|53576020|50424020|55016020|55346020|55437020|54234020|49483020|50435020|49485020|49431020|49478020|66356020|55204020|66353020|55203020|50422020|65481020|53351020|59205020|53352020|53898020|54411020|68224020|48990020|92202020|92206020|92717020|92214020|91987020|96038020|99860020|92212020|92210020|92218020|92216020|91989020|92200020|92723020|93261020|92721020|91981020|92204020|54412020|50970020|91408020|64558020|92725020|90149020|93741020|92055020|91985020|63159020|93471020|88468020|99848020|00155021|93747020|93743020|93469020|91145020|92349020|72587020|93739020|79527020|55881020|59346020|52087020|91147020|61294020|91149020|55706020|95203020|94971020|65207020|95205020|02570021|02720021|95533020|94793020|94787020|94791020|94789020|95787020|95789020|95791020|02695021|95777020|68806020|95793020|95191020|95195020|95193020|96722020|96911020|96913020|04577021|55747020|55705020|59347020|97145020|97149020|97203020|97323020|96724020|97205020|97147020|95189020|05943021|05750021|05026021|49433020|66784020|97151020|53534020|55438020|50436020|53536020|55228020|55746020|56102020|68222020|68217020|61212020|51751020|61027020|62954020|58296020|53575020|79595020|94599020|97153020|63449020|07259021|07258021|59312020|55600020|98250020|55351020|91764020|95197020|95356020|69868020|60498020|60376020|62264020|49488020|54580020|56529020|64019020|60099020|72184020|98278020|98873020|65188020|98875020|99170020|56914020|99364020|55710020|64022020|97155020|71577020|66470020|96602020|99757020|99745020|54413020|99275020|99755020|87558020|11246021|99841020|11245021|99847020|99271020|98329020|99853020|99855020|99851020|99845020|99843020|00207021|98700020|00353021|74786020|94973020|00265021|00209021|88506020|00447021|62263020|00411021|51749020|58896020|69302020|61213020|60101020|00443021|00717021|00711021|00715021|00731021|00729021|00709021|00723021|00511021|00725021|99849020|00341021|88804020|00713021|00337021|63552020|88806020|00719021|54418020|98282020|00727021|00733021|60366020|74927020|00538021|76335020|76338020|60100020|92469020|84528020|49479020|11522020|11516020|15087020|14434021|37168020|13098020|11514020|11517020|13930020|14198021|44093020|37167020|44059020|43935020|00183020|14203021|14200021|36861020|11776020|13830020|29292020|37166020|37165020|14216021|43950020|13094020|43895020|43939020|12559020|04128020|13096020|20065020|14191020|13192020|32715020|32716020|13216020|13217020|13099020|28901020|13088020|28900020|12226020|32902020|12222020|14005021|38919020|12221020|37377020|33610020|10469020|12223020|15092020|44092020|28668020|32714020|44068020|13087020|00182020|12224020|17980020|43913020|12068020|36863020|32900020|36455020|36454020|38420020|43896020|12066020|12067020|12071020|44050020|53776020|04131020|04397020|12225020|21826020|34919020|03818020|49484020|13097020|14222021|44087020|12069020|12941020|17982020|12220020|14219021|36328020|43897020|11782020|36905020|13111020|04403020|03668020|41464020|37475020|13768020|18133020|04129020|35010020|04123020|14220021|04405020|18313020|12557020|15091020|05085020|36862020|04400020|03580020|32064020|12217020|35008020|13838020|28667020|15089020|34920020|19534020|00942020|10228020|34696020|00925020|03365020|04396020|04411020|04399020|41200020|11784020|12564020|19536020|74729020|36907020|11775020|11777020|39935020|28670020|13831020|44094020|29291020|03664020|13882021|42176020|38834020|13834020|04408020|93367020|20067020|42196020|42194020|32904020|29290020|00589021|32615020|44041020|77532020|12070020|28669020|28671020|77006020|34198020|74841020|15090020|15088020|04122020|59774020|40629020|46233020|99279020|13837020|03298020|03297020|04126020|00927020|98333020|04401020|18177020|40525020|71580020|41887020|92819020|38414020|18970020|29287020|44043020|77003020|03430020|78190020|34938020|19530020|75415020|63164020|95125020|60367020|51759020|69262020|20600020|29288020|38418020|37399020|11781020|13836020|38416020|00955020|38833020|28401020|36326020|38854020|37333020|37171020|03505020|47267020|92847020|13168020|15410021|37169020|04406020|38868020|35342020|15510021|15509021|41448020|12072020|47096020|04402020|55709020|40630020|00957020|16413021|10470020|38397020|89752020|16593021|16594021|16591021|75903020|35326020|16595021|16592021|00928020|53535020|40631020|13165020|14217021|13166020|47335020|75441020|03326020|34143020|13064020|03413020|13172020|13173020|13174020|13176020|11075020|35377020|78313020|42149020|13115020|19573020|89748020)"
gen psychoses = 0 
replace psychoses = 1 if regexm(gemscriptcode, "`psycodes'")
label variable psychoses "Drugs used in psychoses and related disorders exposure:0=no exp, 1=exp"

// Antidepressants
local deprcodes="(69654020|58950020|72932020|79462020|62834020|58949020|62833020|64034020|55445020|69507020|54686020|69506020|85108020|79463020|60222020|74050020|77306020|72934020|68729020|62026020|78768020|48376020|86222020|67093020|74051020|85247020|87526020|88034020|77312020|88038020|72937020|00175007|55456020|52046020|54687020|59429020|72933020|52047020|85163020|72938020|74046020|79420020|67152020|62032020|59430020|52022020|58951020|56698020|67281020|55432020|58637020|53030020|48900020|53031020|62025020|68096020|62070020|55457020|84955020|79422020|55409020|60224020|55418020|55417020|01787007|69655020|55402020|54688020|85109020|62069020|72031020|62073020|57463020|55410020|64729020|65153020|61463020|02832007|67282020|50620020|00062007|67151020|51013020|79505020|68728020|62851020|72939020|55387020|03312007|61464020|05932007|75331020|67145020|62850020|79421020|65154020|81125020|61465020|49503020|49502020|67148020|54110020|79510020|67153020|69656020|65157020|54109020|64035020|79506020|67280020|65635020|64730020|74047020|55404020|71189020|67310020|79509020|05853007|62318020|71555020|60223020|75329020|73107020|48165020|85251020|79464020|54108020|69508020|62852020|72032020|83737020|50868020|62029020|85164020|48897020|71995020|62835020|53823020|64731020|48378020|75330020|55602020|87524020|87476020|67156020|87478020|86969020|88052020|88042020|88879020|87480020|88881020|65593020|88847020|88036020|88044020|88040020|88046020|62857020|88845020|88177020|88175020|88054020|88050020|90497020|88058020|05058007|48430020|55386020|04844007|49756020|55355020|65158020|55388020|61954020|55441020|57970020|66327020|68989020|04843007|57965020|55396020|55403020|05547007|55380020|62277020|63537020|48431020|54779020|03108007|49757020|55442020|57473020|48432020|55356020|61473020|62033020|55392020|61469020|54904020|55440020|55446020|67314020|55450020|55416020|48377020|71994020|79511020|68397020|49408020|86971020|88060020|55464020|04845007|51010020|54727020|66328020|50775020|54655020|05055007|52298020|62074020|55466020|55465020|50776020|05750007|63638020|50957020|68785020|65411020|55348020|50774020|50286020|55349020|67157020|88849020|89954020|00205007|00173007|54780020|57938020|71169020|55469020|50198020|68990020|80679020|88181020|62034020|88851020|89976020|91582020|84961020|87482020|71168020|56699020|81420020|85180020|87990020|65592020|88056020|88048020|88179020|55347020|66738020|71185020|89970020|89972020|89974020|50297020|61955020|68725020|55424020|54728020|62912020|61084020|56943020|91584020|63016020|!1754106|60229020|55363020|90871020|54978020|62045020|!0227402|68724020|84817020|71170020|57111020|57110020|84448020|55688020|05057007|!8504176|!2497701|49588020|05056007|00174007|48517020|48507020|48508020|48176020|48480020|48479020|59132020|63628020|71173020|69003020|!1755101|!1371102|!7275101|!2005101|!4157301|!7275103|84171020|63632020|65128020|90873020|55362020|61470020|05059007|!5918103|55364020|63624020|!6856102|!5918101|63625020|!0226401|05854007|62911020|88348020|82055020|62363020|60464020|64692020|61477020|84816020|!8504070|62913020|!8502180|63629020|53818020|53817020|49589020|71725020|48534020|68786020|88346020|67890020|68803020|65578020|49680020|59528020|48496020|66765020|69832020|61616020|48481020|71225020|80777020|66399020|61096020|59084020|54620020|48486020|48485020|48518020|48492020|61455020|64717020|49841020|54621020|55686020|50947020|55687020|48498020|61409020|61167020|63703020|49842020|65381020|48484020|66149020|66454020|66464020|62274020|66451020|61319020|65131020|62276020|48528020|65254020|65125020|48523020|60465020|56517020|61097020|65376020|67650020|66459020|48509020|62179020|68380020|60055020|65257020|48516020|56942020|48497020|49846020|66152020|66273020|65464020|50946020|67893020|49838020|48490020|57022020|68045020|66685020|92043020|93187020|92457020|92459020|74503020|65386020|93984020|93918020|94315020|95021020|94317020|95533020|74425020|65159020|96445020|96447020|96465020|96467020|96449020|96451020|96838020|96834020|96836020|96357020|68213020|67575020|96355020|97030020|48491020|96841020|97028020|97005020|97003020|96536020|97169020|96439020|96353020|96329020|96331020|69754020|96441020|96239020|97171020|96473020|96241020|55369020|68042020|57825020|57826020|62361020|59282020|57824020|65266020|49845020|62362020|62275020|48502020|59180020|63795020|70948020|61420020|71733020|97872020|72034020|48513020|98001020|96534020|71373020|68383020|66129020|97461020|82870020|96614020|74033020|74708020|74668020|74026020|69827020|76512020|71074020|74967020|74977020|74684020|74705020|74702020|74689020|75309020|96616020|60735020|65262020|55646020|54669020|96475020|97351020|63443020|62693020|99210020|99208020|72095020|66688020|61387020|71736020|48522020|48533020|62975020|66680020|68049020|61439020|50948020|61452020|54670020|98863020|55642020|99679020|99681020|75620020|98861020|70353020|00503021|00505021|66160020|48524020|67898020|61425020|50103020|68484020|68128020|71376020|66244020|92481020|78577020|97656020|77778020|03837020|10912020|41252020|04004020|03965020|20738020|41254020|03976020|20756020|03818020|19725020|09892020|35355020|41880020|03970020|03942020|10967020|35357020|03717020|41881020|03966020|04007020|38526020|04003020|03977020|10932020|03997020|98348020|71214020|03674020|19451020|03701020|21206020|35359020|03985020|17493020|13228020|09905020|74665020|17476020|76425020|04011020|03784020|41253020|33816020|38595020|46233020|09876020|47014020|47015020|04053020|33812020|30393020|03679020|72071020|45165020|38528020|34736020|34738020|03675020|71728020|95179020|77222020|72091020|70945020|76126020|03921020|20967020|92819020|03751020|35980020|03990020|04060020|32936020|04037020|47301020|76076020|03734020|76115020|60806020|03673020|89752020|34744020|03831020|98350020|89748020)"
gen antidepress = 0 
replace antidepress = 1 if regexm(gemscriptcode, "`deprcodes'")
label variable antidepress "Antidepressant exposure:0=no exp, 1=exp"

// Antiobesity
local obescodes="(83720020|54504020|54505020|73270020|73267020|61809020|83722020|58704020|51869020|65203020|61441020|61440020|49142020|48193020|65204020|49143020|64545020|64549020|49960020|53321020|65691020|64300020|65690020|71452020|48736020|54755020|!8504301|!8504302|64546020|75890020|96935020|96937020|88843020|88817020|78077020|00681021|00683021|78079020|94952020|39788020|39285020)"
gen antiobes = 0
replace antiobes = 1 if regexm(gemscriptcode, "`obescodes'")
label variable antiobes "Antiobesity drug exposure:0=no exp, 1=exp"

// Opioid analgesics (CNS)
local opioidcodes="(62553020|60971020|62538020|60972020|75786020|80055020|49528020|04100007|03652007|59899020|52434020|03621007|75791020|62539020|02818007|52438020|69166020|04104007|51091020|69988020|64276020|71386020|78857020|52433020|64275020|69168020|70481020|55572020|58898020|50521020|52435020|56810020|61829020|76085020|60973020|55573020|68486020|68282020|70482020|56280020|87622020|79973020|78856020|76080020|76086020|73729020|80053020|80054020|52832020|90765020|50001020|84587020|68357020|84213020|59906020|53130020|54315020|64851020|55873020|62548020|55578020|57802020|73727020|06150007|65564020|55754020|69167020|64854020|50340020|06691007|59900020|49325020|65994020|65993020|72887020|50522020|51090020|55579020|06690007|75362020|03895007|70858020|64277020|73728020|70490020|68499020|69566020|03095007|75788020|68283020|51848020|79957020|72309020|52618020|66034020|84215020|74003020|62391020|79974020|79961020|56382020|74008020|50530020|04615007|70344020|60995020|75448020|50523020|02985007|50988020|58599020|68504020|76090020|68360020|50406020|59907020|62540020|79975020|62545020|82219020|82220020|76081020|59881020|84396020|84397020|79959020|55631020|79962020|51558020|64471020|74940020|71764020|74941020|76946020|83126020|70343020|77099020|80383020|76934020|76092020|83127020|76082020|55627020|77100020|59883020|59882020|64805020|85209020|77203020|77204020|56809020|73652020|58643020|68485020|79350020|80250020|76478020|50528020|79867020|84669020|52972020|79958020|84671020|85776020|79982020|70312020|74004020|62550020|72523020|76087020|73519020|83857020|64465020|59889020|59888020|52971020|80388020|87618020|79351020|76930020|86403020|79352020|56798020|73071020|80382020|83959020|61569020|59712020|78619020|76929020|89000020|78380020|88867020|87756020|88869020|70367020|89905020|73078020|73664020|79868020|89596020|89598020|80384020|89594020|73057020|76935020|88871020|80387020|65567020|51847020|52617020|66452020|59813020|63232020|48372020|61567020|89600020|06703007|50127020|00262007|56384020|03921007|70494020|05493007|64806020|03267007|02694007|70489020|51849020|50529020|70493020|03006007|59714020|02228007|70855020|61568020|54214020|57693020|53469020|79963020|02227007|52951020|62558020|02713007|02810007|03877007|73131020|55628020|02229007|64807020|02715007|03833007|70488020|03160007|68381020|70283020|00054007|54783020|58646020|48725020|70495020|02714007|65984020|74009020|55875020|64810020|06692007|62559020|62560020|62549020|84390020|84406020|84400020|84399020|81634020|81635020|81690020|81636020|85601020|85602020|63233020|65992020|65989020|65988020|81627020|53131020|56797020|81855020|64812020|84407020|75454020|74939020|72888020|78591020|54212020|55874020|66016020|80386020|84590020|76936020|83859020|57278020|79869020|73056020|76939020|62544020|85775020|71315020|89018020|79795020|89794020|89602020|89796020|81691020|52621020|02728007|49523020|04147007|03151007|72724020|65561020|57692020|64797020|53336020|74005020|71718020|53468020|03150007|71496020|03159007|76095020|52948020|66001020|82968020|68940020|55131020|75792020|77473020|68361020|76931020|59563020|75787020|79983020|77460020|78590020|79157020|79880020|81626020|81971020|87129020|82221020|82223020|84190020|64421020|86865020|64811020|76091020|51785020|66031020|74663020|89907020|03161007|62683020|72612020|02265007|48985020|59713020|03904007|03158007|75453020|59815020|75449020|03162007|77459020|68362020|56811020|69049020|85774020|81733020|85781020|85782020|78858020|90607020|90609020|89604020|02727007|73133020|03146007|03946007|03414007|83122020|83119020|77456020|70129020|81632020|79896020|83128020|85785020|64466020|68487020|56799020|73500020|65617020|82134020|84588020|77683020|66014020|65987020|88873020|81048020|88732020|89792020|51559020|06650007|49344020|77205020|73146020|02583007|68939020|52685020|60996020|02267007|03364007|82636020|81628020|84389020|52700020|84391020|74010020|53858020|80858020|70220020|85786020|85783020|54213020|87620020|88885020|89744020|91452020|83285020|75363020|66055020|83284020|84870020|53495020|89644020|79777020|64912020|90767020|03654007|66043020|02712007|65620020|02221007|69171020|66056020|61675020|86857020|79122020|06689007|62393020|06649007|73655020|75364020|64470020|50341020|63231020|81692020|76947020|78000020|79897020|81734020|84466020|70309020|73665020|66005020|65611020|88734020|03656007|03655007|67085020|67086020|03145007|75378020|55619020|80790020|76268020|03806007|03808007|83123020|69221020|64909020|66015020|85591020|54364020|73019020|03807007|76304020|51511020|54268020|70130020|03888007|04040007|68941020|87456020|84403020|84393020|76472020|90409020|06957007|53853020|71757020|77403020|74936020|06905007|71760020|87131020|73512020|03810007|02726007|59814020|56944020|71763020|06402007|50342020|89742020|82938020|84442020|84401020|84404020|03672007|83287020|64472020|66002020|70852020|79776020|51087020|76475020|85605020|72609020|79879020|83283020|!4629102|78227020|78230020|52761020|89642020|70292020|03049007|57477020|03283007|05141007|81630020|82622020|54168020|06401007|75450020|74224020|03057007|81972020|56388020|53857020|90769020|70266020|74227020|76473020|02268007|03920007|03649007|02711007|02720007|67430020|03671007|02266007|66040020|50964020|85603020|74856020|49474020|54666020|70244020|!7043103|03832007|82059020|82060020|84443020|!7043101|65271020|80409020|02269007|83124020|61832020|00100007|03834007|87427020|71951020|02710007|84394020|67429020|02223007|03653007|71656020|73053020|03811007|02811007|69218020|80288020|71309020|82413020|79331020|61836020|81735020|52659020|61674020|82982020|64815020|86018020|03056007|81311020|77680020|56387020|02724007|02224007|02722007|49529020|49081020|81739020|58809020|71721020|83991020|82624020|82626020|70300020|77920020|03363007|!1884501|77794020|02219007|81737020|89680020|82523020|03650007|73649020|03805007|03871007|06904007|73661020|!5251301|89678020|02983007|81631020|53764020|49337020|89646020|55651020|85176020|02721007|80838020|06948007|67433020|89020020|00261007|70364020|89682020|68945020|49353020|82882020|62401020|06896007|03290007|72947020|54447020|75455020|91664020|76471020|63572020|66052020|02891007|51616020|49335020|73145020|81738020|03809007|02725007|50027020|00218007|56511020|52762020|54090020|73621020|68501020|84105020|75017020|62554020|64802020|69749020|53208020|02723007|59024020|72948020|60731020|62877020|75261020|63953020|74861020|73132020|51145020|73149020|03651007|89640020|77919020|77918020|66037020|64216020|02391007|49432020|06728007|56464020|90811020|90813020|02220007|90413020|49477020|77909020|81313020|90771020|66028020|50251020|55772020|73147020|59495020|86746020|02222007|67435020|92089020|50965020|89684020|06958007|06895007|!1417101|86609020|53112020|!8505564|06687007|74855020|56462020|50250020|51786020|49451020|49347020|91654020|92077020|73509020|70228020|64467020|03002007|60651020|60674020|49328020|49539020|49336020|65467020|89813020|92073020|50026020|79285020|71396020|49365020|53798020|65707020|79799020|49427020|61763020|49471020|50966020|61856020|62214020|56031020|59021020|65703020|66696020|65711020|49483020|54018020|49485020|63582020|57153020|67010020|49549020|49431020|63736020|49497020|59020020|49320020|49331020|60506020|62885020|49478020|49368020|59770020|49542020|57229020|59895020|56463020|49536020|54661020|50378020|59364020|49452020|49453020|65481020|61634020|63355020|67663020|66914020|49324020|49340020|55837020|55234020|92091020|92087020|90415020|92297020|92295020|92075020|91999020|92117020|92085020|92192020|93712020|92172020|91656020|92196020|92194020|92283020|92291020|50970020|88985020|92119020|92083020|89662020|92585020|81684020|63577020|92198020|92081020|92593020|90897020|92174020|92587020|91660020|66011020|71799020|56226020|90623020|93848020|81680020|93850020|93710020|71989020|93940020|90668020|90670020|94112020|60085020|02134007|71809020|88530020|91658020|72617020|94499020|94493020|87860020|90615020|92641020|94749020|94495020|92583020|94501020|94639020|94469020|94823020|94503020|81312020|68500020|60096020|53205020|84928020|88989020|92079020|61671020|92293020|94507020|92589020|94751020|94497020|58864020|54628020|92176020|66344020|94509020|83120020|95821020|93716020|95817020|95897020|94643020|94505020|94637020|74574020|92135020|93938020|90563020|96297020|96516020|96520020|96522020|96518020|96251020|96309020|55276020|96299020|96255020|96369020|96379020|96253020|96311020|94355020|96319020|96514020|96886020|96381020|96315020|96371020|94253020|94257020|94255020|96303020|96383020|61081020|61111020|76002020|76007020|51618020|96510020|96508020|69578020|49361020|67434020|96385020|91997020|96317020|96053020|96373020|97288020|97292020|76720020|76604020|97157020|68881020|97159020|97290020|93714020|96512020|88987020|96301020|96387020|97294020|97501020|94641020|67031020|76276020|66420020|76494020|57801020|96313020|96305020|49433020|51243020|53534020|51608020|53536020|60266020|48780020|56575020|50133020|59950020|54093020|57334020|51519020|70238020|96760020|92289020|97806020|52616020|75096020|74305020|97487020|97932020|96059020|96307020|96375020|96758020|96730020|96726020|91720020|69172020|68530020|57205020|70243020|57333020|97509020|96728020|77140020|71802020|70233020|94182020|96660020|97131020|70680020|49350020|49488020|60117020|55415020|60099020|97511020|96063020|96073020|92178020|93942020|92123020|98449020|98853020|90621020|97525020|96756020|97808020|71985020|97505020|62832020|62237020|94388020|98963020|96732020|96754020|97507020|95525020|99594020|99596020|99592020|99586020|99823020|99801020|99588020|99562020|97503020|99590020|99813020|99827020|99819020|99821020|99829020|99817020|99815020|99831020|99560020|76711020|98965020|99803020|00243021|96377020|00229021|00233021|91666020|00078021|74959020|94311020|00235021|00237021|99833020|00469021|00231021|00471021|59611020|53767020|77582020|60101020|00547021|50844020|98453020|96620020|00453021|99825020|72774020|99835020|00245021|90411020|54713020|49498020|50028020|96061020|98961020|73826020|92639020|96069020|76335020|96067020|76338020|79715020|60100020|92469020|70246020|72883020|75444020|78547020|72877020|49479020|76863020|73996020|04421020|04312020|36812020|04424020|04428020|09330020|09738020|41378020|36806020|36808020|04433020|36804020|03080020|04512020|04502020|10627020|04567020|10745020|04549020|09739020|04551020|04380020|53776020|04397020|73083020|04444020|49484020|21754020|10748020|04563020|04522020|21756020|04527020|04340020|09327020|04403020|14677020|04559020|10749020|04405020|04552020|04325020|04576020|04400020|04332020|09349020|42244020|42184020|42186020|09363020|04490020|04555020|39814020|04562020|29961020|04396020|04411020|04399020|14679020|04529020|38912020|04304020|31908020|04564020|42185020|76866020|31027020|04326020|04427020|04408020|78855020|04578020|04328020|72186020|94114020|09741020|09366020|77532020|94727020|04524020|94386020|04439020|51526020|94146020|42187020|41379020|46333020|13270020|71753020|47328020|85226020|04587020|04436020|04401020|40105020|99511020|04339020|04305020|02314020|36810020|09345020|66692020|50132020|50249020|51617020|04296020|75279020|04334020|04412020|94725020|14678020|04311020|31888020|15644021|04310020|04541020|60696020|14519021|04406020|13497020|15595021|43838020|09325020|46903020|04351020|04402020|04480020|15665021|15666021|04335020|14517021|16704021|53535020|39500020|16702021|47335020|73089020|51513020|19573020)"
gen opioid1 = 0
replace opioid1 = 1 if regexm(gemscriptcode, "`opioidcodes'")
label variable opioid1 "Opioid analgesic (CNS) exposure:0=no exp, 1=exp"

// Antiepileptics
local epilcodes="(66163020|58980020|58981020|59234020|65732020|55605020|66215020|59758020|71488020|59233020|69070020|60388020|59760020|68252020|64057020|88034020|80221020|61489020|88038020|74386020|58993020|66214020|59759020|65736020|54769020|59037020|58982020|69212020|55585020|61487020|59036020|68253020|55594020|61488020|03520007|49185020|66061020|66059020|75707020|69797020|49186020|54570020|58994020|65733020|58986020|72634020|52129020|55593020|71955020|69792020|72792020|72793020|65738020|74925020|60918020|03839007|61431020|61432020|62418020|59573020|64759020|69071020|52336020|72635020|69791020|74924020|74923020|69211020|62417020|54768020|05544007|79266020|59078020|54571020|53429020|62426020|69793020|52130020|57880020|50594020|02050007|85907020|65737020|69796020|59040020|69210020|71956020|66211020|02708007|68254020|54576020|72800020|66060020|52159020|59035020|78886020|53820020|80748020|74587020|75708020|75677020|60919020|83533020|85972020|62427020|57489020|53869020|64758020|80222020|75709020|53819020|52337020|54569020|74586020|64760020|76726020|84158020|84160020|84159020|68258020|57490020|79267020|78887020|80749020|78885020|81319020|88052020|80756020|80747020|88042020|76811020|62425020|80207020|88458020|88036020|88044020|88040020|88046020|74929020|78882020|53158020|66209020|66210020|70972020|80206020|80208020|88054020|88050020|87259020|91390020|91378020|88058020|05717007|48240020|05716007|54767020|52160020|02103007|51412020|03804007|05478007|62422020|62421020|57881020|05711007|49555020|04580007|02707007|75354020|75305020|62416020|50805020|79693020|03536007|60267020|74928020|75306020|75314020|70973020|80218020|81491020|68257020|88634020|78980020|88060020|76727020|57944020|55606020|90715020|87261020|67019020|52131020|05776007|04578007|05718007|53868020|51411020|02840007|71960020|02706007|48244020|74930020|80220020|75676020|72801020|88456020|89148020|04589007|75134020|75133020|49253020|53126020|84894020|75307020|72797020|59550020|75210020|77435020|85909020|89956020|91386020|91384020|06595007|72796020|80202020|48956020|83729020|83731020|80204020|78278020|49556020|02320007|85908020|73062020|65656020|65731020|64569020|50595020|55588020|75594020|02102007|75675020|76728020|89152020|02838007|04579007|74592020|80203020|74593020|88460020|90775020|68259020|84895020|81493020|83730020|88056020|88048020|74140020|52117020|59569020|79529020|71957020|55589020|85911020|90493020|75353020|57945020|75598020|75597020|81488020|89618020|48245020|06962007|83786020|71961020|83787020|84896020|89849020|02841007|73061020|49187020|84116020|74591020|!8504171|!8504172|!8504170|49230020|83733020|75211020|75212020|74588020|90597020|54201020|61726020|78981020|52122020|02709007|53193020|05474007|89150020|!2246103|59574020|69798020|52121020|52136020|04581007|88462020|83734020|89903020|49507020|50409020|75593020|54145020|!2237104|57056020|06279007|02115007|03613007|48078020|05720007|90875020|05714007|05777007|73060020|54200020|64568020|64567020|76152020|04588007|50254020|75355020|89156020|89158020|80585020|!1845109|90117020|65741020|65659020|04584007|54199020|48438020|53039020|54146020|55757020|54232020|90091020|82440020|77436020|49229020|83735020|61181020|53995020|!4554601|79828020|02597007|04249007|91392020|50456020|59290020|05721007|06539007|05715007|04590007|66975020|!5603703|89154020|04582007|!5603201|59768020|77629020|54680020|49515020|50410020|52135020|59073020|81489020|55508020|55509020|06231007|50400020|70804020|70810020|02839007|61793020|66876020|52125020|57055020|86374020|87806020|48995020|54231020|74982020|04161007|89492020|49505020|53786020|91692020|54147020|50401020|51719020|53466020|63548020|62963020|70981020|54682020|55173020|86465020|59082020|50645020|56309020|91878020|50255020|55507020|49520020|58806020|90905020|55423020|53465020|52411020|59986020|54482020|54483020|52412020|50263020|65787020|53333020|64045020|61795020|61899020|54227020|50399020|59953020|50408020|57098020|53334020|61749020|66972020|56921020|62837020|50278020|67084020|53467020|64048020|56315020|59990020|49521020|65523020|63139020|49516020|55654020|56310020|67092020|63033020|54228020|65526020|49506020|49456020|52413020|49457020|48996020|66983020|48990020|51718020|93459020|88784020|91382020|93457020|71421020|93467020|93461020|92442020|50646020|89494020|71875020|93463020|90877020|48237020|93465020|93471020|94162020|91394020|59954020|93952020|93958020|93950020|94513020|93469020|86467020|89490020|91963020|94516020|59346020|94315020|94526020|93954020|94587020|91380020|94317020|68864020|95360020|95362020|95757020|95813020|95815020|96128020|95745020|95749020|95191020|95364020|51443020|95747020|95753020|95195020|95193020|70807020|95366020|95759020|96618020|71155020|71163020|95358020|95743020|92741020|95737020|95741020|56314020|55618020|59347020|61900020|93960020|95755020|95189020|95751020|94777020|97315020|66962020|55527020|53335020|49522020|53471020|61212020|97584020|50258020|97038020|63440020|97588020|94583020|71710020|51444020|95197020|95356020|48997020|93533020|62264020|95245020|94601020|94585020|93956020|98739020|67099020|72055020|98871020|94589020|98809020|99035020|98813020|99170020|98937020|73096020|71487020|98811020|63587020|61794020|65974020|68615020|64728020|98621020|98807020|99059020|99349020|99570020|99438020|74808020|99733020|99731020|99572020|99885020|99887020|99877020|99875020|00207021|99879020|00305021|00303021|59989020|71158020|99899020|99881020|00419021|00309021|00311021|00421021|00301021|62263020|00445021|63141020|57343020|63140020|61213020|00515021|99889020|00307021|00507021|00553021|63552020|74481020|50275020|99891020|99883020|50260020|70875020|70915020|97313020|70798020|70817020|71050020|71403020|10912020|04714020|40422020|37194020|37196020|37195020|39486020|38943020|38820020|39693020|39821020|44357020|28378020|44398020|04698020|04813020|40180020|05152020|44399020|44397020|44396020|71034020|45070020|18217020|19425020|31285020|37122020|37199020|09788020|39824020|04972020|41880020|04887020|20979020|20867020|41280020|19407020|04891020|44114020|36324020|78712020|06607020|05159020|19080020|04705020|05085020|41881020|44360020|38438020|05141020|19427020|19409020|30413020|41216020|10932020|05151020|30439020|34696020|04733020|36901020|37936020|19079020|09860020|45072020|91742020|74729020|04815020|04819020|36907020|75089020|44113020|78154020|04751020|33911020|05131020|10229020|05149020|04715020|04827020|04822020|20871020|04756020|44359020|45177020|45175020|42196020|42194020|19972020|45171020|04730020|33915020|45071020|99893020|45074020|45076020|77006020|74431020|33907020|04704020|47008020|47006020|45066020|45068020|46732020|78241020|78238020|63597020|05145020|47020020|34510020|45073020|37703020|45077020|44358020|47021020|36498020|04823020|37553020|31133020|34075020|47010020|06621020|47018020|98623020|78466020|43847020|44356020|04890020|77003020|31253020|60261020|39271020|35980020|39721020|04817020|75741020|47011020|04913020|20432020|04694020|32593020|47019020|43845020|04767020|47496020|14741021|70795020|31688020|74813020|45075020|03246020|04967020|73607020|37705020|04971020|19483020|42149020|20687020|31326020|04718020|47229020)"
gen antiepilep = 0
replace antiepilep = 1 if regexm(gemscriptcode, "`epilcodes'")
label variable antiepilep "Antiepileptic exposure:0=no exp, 1=exp"

// Antiparkinsons, dopaminergic
local parkcodes="(75370020|51555020|57799020|83149020|78697020|74820020|54420020|64241020|55729020|69765020|59690020|66563020|54423020|69646020|67816020|63950020|59688020|66564020|63940020|73863020|59689020|55728020|64242020|00060007|69643020|75367020|73877020|55730020|64240020|66565020|73869020|73873020|60097020|84638020|84639020|73862020|74940020|74941020|77099020|77100020|73868020|83148020|73879020|60440020|78698020|59694020|78699020|84138020|84640020|57702020|83152020|84872020|73874020|89182020|84900020|73878020|59695020|82500020|87247020|51774020|63948020|63941020|63949020|63939020|63944020|00061007|66568020|73872020|85557020|51000020|73864020|74939020|83150020|87245020|87239020|03685007|03071007|73867020|77880020|84643020|85736020|87241020|64245020|63931020|83154020|84847020|50999020|51001020|52395020|52396020|84645020|90827020|90519020|90523020|87243020|83155020|88732020|66569020|82499020|69650020|63936020|69642020|67414020|63945020|82501020|78515020|69768020|90521020|90825020|90829020|84644020|69649020|83156020|83158020|87237020|63932020|88734020|48462020|90831020|85591020|81199020|90529020|90531020|90533020|50095020|!4315101|52394020|74936020|69644020|54735020|!4315102|!4313102|85564020|51005020|53305020|89184020|!4067101|!4067103|90527020|90525020|85558020|90535020|48464020|!4067102|59762020|66570020|63933020|49499020|02342007|03686007|88977020|!4314101|!4313501|82341020|48463020|69651020|67408020|80743020|60439020|80292020|80293020|!8502328|59764020|85565020|90537020|67409020|67413020|60701020|60438020|92077020|90575020|92073020|56135020|48912020|48906020|56136020|92075020|67410020|92083020|92081020|90587020|69771020|94421020|94423020|94799020|92079020|94795020|94797020|95011020|95009020|95013020|95223020|95221020|92843020|96868020|56148020|97024020|80742020|92841020|97026020|97022020|97020020|97195020|96870020|97437020|97199020|97612020|97620020|97616020|97614020|97618020|97197020|97628020|97624020|97622020|97626020|97439020|76134020|97630020|56787020|96864020|97973020|97975020|97963020|59763020|97967020|97971020|97969020|97201020|56149020|88071020|77225020|96361020|96363020|99105020|99112020|99107020|99114020|76052020|90577020|00067021|00790021|77856020|00386021|00390021|00388021|10060020|05305020|10055020|35086020|35092020|10063020|10079020|10137020|76357020|05311020|19569020|67498020|39216020|15197020|06958020|10053020|71228020|35085020|35087020|27936020|10073020|77067020|47379020)"
gen antipark_dop = 0
replace antipark_dop = 1 if regexm(gemscriptcode, "`parkcodes'")
label variable antipark_dop "Antiparkison's dopaminergic drug exposure:0=no exp, 1=exp"

// Penicillins
local pencodes="(47410020|38544020|05674020|47844020|05550020|05544020|39852020|05536020|05535020|55713020|59329020|80571020|59330020|59408020|68400020|68218020|59438020|59339020|03055007|59334020|49528020|68527020|48122020|02030007|03340007|51032020|68219020|56805020|50280020|71386020|03417007|65520020|48261020|68528020|54560020|68401020|67567020|59410020|68220020|60131020|68407020|51673020|73857020|73852020|54556020|71704020|59409020|68408020|60136020|73858020|74274020|74271020|73853020|48123020|59336020|62845020|59340020|59335020|61919020|06746007|58206020|59414020|60135020|02108007|67566020|03177007|67558020|00256007|63078020|73854020|03753007|60130020|60137020|59437020|56492020|53262020|56491020|54602020|53362020|57541020|51172020|62846020|04470007|70258020|65564020|52817020|48262020|70677020|56441020|05674007|85599020|05467007|58820020|03907007|56736020|56427020|59331020|04972007|70259020|56493020|02109007|85598020|63077020|51039020|67355020|80576020|80577020|80274020|58207020|73901020|77604020|60821020|73859020|90701020|65567020|54595020|65870020|00163007|05930007|67571020|61544020|63079020|05466007|52043020|67547020|06370007|61546020|53469020|56428020|52109020|65871020|50881020|50880020|54599020|67568020|56440020|68120020|61918020|73320020|60132020|73902020|52805020|85597020|61378020|89016020|89012020|90703020|52176020|67559020|61545020|49523020|55113020|65561020|52175020|51034020|52171020|67551020|67554020|53468020|54607020|67896020|61910020|86832020|86845020|73340020|73342020|51825020|65892020|51516020|05870007|48133020|05871007|52170020|73322020|67895020|60252020|70676020|04568007|65876020|51668020|57172020|90739020|90743020|52169020|54565020|54564020|67356020|73209020|73211020|73210020|73084020|51428020|67550020|49052020|51033020|48124020|51669020|61909020|86834020|72684020|80590020|59341020|61915020|66865020|65818020|57171020|79741020|67947020|54609020|67389020|64119020|54241020|65872020|68745020|74275020|60192020|67859020|58700020|63151020|67354020|56804020|73655020|89010020|49051020|48529020|73341020|67384020|54590020|58701020|05480007|60410020|67061020|54298020|63514020|48487020|74270020|62703020|!0253101|!0247105|60299020|!0249102|48417020|66864020|03521007|03608007|57173020|54246020|48114020|61920020|65888020|79740020|82695020|60248020|89014020|65644020|48488020|65645020|65819020|61380020|68743020|52264020|53114020|68744020|84227020|73328020|68748020|83484020|53115020|52587020|82655020|52265020|!0256002|57654020|85573020|82654020|85575020|85629020|!5681101|48803020|!4320101|!0256001|73321020|60860020|73220020|59324020|60191020|!0249103|!0251101|!0253104|05683007|74134020|64120020|84758020|52266020|48620020|49692020|90859020|59319020|!2620901|67062020|!8505353|60195020|58855020|70678020|48579020|71705020|90745020|58854020|61379020|06262007|48635020|85578020|85577020|!0247101|!5476106|67385020|89482020|!5484003|74723020|54608020|67563020|!5681503|!0249104|79742020|57649020|76828020|48607020|55597020|57542020|59188020|05873007|61811020|65875020|49529020|50882020|72551020|67063020|65891020|48592020|48710020|05124007|65539020|65544020|84228020|56429020|73903020|56432020|48115020|67560020|!0247107|56437020|!0415101|49055020|49694020|76830020|62823020|48578020|!0249101|!0249401|48674020|54606020|64721020|67572020|61550020|67555020|48577020|59856020|48599020|59858020|48646020|48597020|64722020|51430020|53747020|!0247301|62861020|61885020|59857020|64118020|48619020|67573020|48530020|67069020|61914020|63152020|80589020|59322020|60146020|02827007|72714020|57380020|57873020|55598020|63150020|48612020|67071020|54594020|64320020|61480020|48644020|60194020|56063020|59996020|61075020|60211020|05872007|85594020|85593020|65820020|89281020|56737020|52796020|63082020|52269020|74726020|66603020|60212020|!0248107|90811020|90813020|62524020|52818020|60345020|66846020|58803020|59748020|52045020|52582020|49050020|72760020|52579020|55295020|72759020|84760020|!8504950|!0248101|60196020|48673020|60861020|85595020|05120007|05122007|48628020|65485020|67412020|62825020|62598020|62824020|48663020|59321020|65540020|56816020|56142020|72555020|67941020|48655020|60210020|48609020|48608020|63338020|48664020|48682020|62493020|48613020|59705020|54604020|54698020|54605020|48618020|53864020|56979020|80573020|50218020|80570020|52801020|50214020|60958020|80574020|52795020|62338020|48709020|48665020|61891020|48588020|60957020|52800020|50226020|66771020|55500020|61479020|49693020|60477020|55504020|60349020|58868020|59400020|62337020|56907020|48669020|59017020|55501020|59692020|56980020|59997020|58867020|59401020|54699020|58869020|56449020|61824020|56448020|56818020|59998020|60479020|57804020|62859020|53863020|61884020|57872020|48594020|62339020|54700020|60478020|49683020|48645020|48670020|48593020|49682020|59693020|50210020|67931020|62860020|62577020|61823020|67527020|72673020|48598020|72593020|89979020|60364020|66011020|57653020|59861020|94075020|74517020|70566020|65519020|94077020|60096020|54487020|71902020|48583020|96882020|96884020|69621020|61911020|65436020|63451020|48678020|56821020|70410020|96826020|60003020|71016020|97239020|70968020|96878020|97552020|97550020|63359020|52895020|56825020|56817020|48711020|52892020|48675020|56434020|52174020|97806020|61348020|71565020|71899020|61077020|62526020|90741020|57381020|70965020|69776020|72596020|48582020|48660020|48604020|65521020|70562020|58843020|74514020|56981020|61076020|52792020|98606020|71019020|66715020|60956020|65553020|65524020|74676020|53133020|48623020|60147020|97808020|66600020|73906020|62578020|48638020|66712020|58802020|62866020|50209020|70826020|70407020|52791020|48717020|98608020|72605020|74671020|64494020|67532020|76922020|68611020|72602020|70957020|60475020|00969021|55764020|66843020|48614020|93224020|71105020|93226020|38543020|05615020|05612020|05616020|38542020|05682020|05516020|05522020|05515020|05596020|36858020|05613020|05523020|05577020|38548020|05597020|05591020|05645020|05521020|21346020|39850020|05664020|05595020|05590020|05614020|05589020|21350020|05546020|77728020|38545020|05531020|44023020|05588020|05605020|05541020|05671020|05527020|05578020|21345020|05563020|05609020|05603020|71112020|76925020|38547020|05659020|05598020|05540020|68867020|69630020|05548020|05623020|05665020|44024020|05576020|05565020|05660020|05656020|39849020|05530020|38978020|05582020|05528020|65527020|60747020|21349020|93228020|05669020|92438020|05600020|17286020|76507020|05679020|45481020|05560020|43853020|76662020|05585020|57547020|61851020|05561020|43854020|05599020|17287020|05583020|45482020|66522020|66526020|05558020|71108020|46899020|68865020|05670020|48624020|47402020|47412020|76509020|36859020|60048020|05571020|47416020|47405020|70690020|80587020|48692020|70687020|47765020|77120020|48625020|47767020|47766020|05538020|47417020|47413020|05607020|05580020|05552020|39851020|05587020|05518020|47410020|38544020|05674020|47844020|05550020|05544020|39852020|05536020|05535020|55713020)"
gen penicillin = 0
replace penicillin = 1 if regexm(gemscriptcode, "`pencodes'")
label variable penicillin "Penicillin exposure: 0=no exp, 1=exp"

// Cephalosporins, carbapenems and other beta-lactams
local cephcodes="(72804020|56409020|60546020|73974020|68126020|60534020|60511020|72805020|60563020|71932020|68012020|90917020|73774020|60612020|60512020|73775020|60611020|73778020|60622020|60616020|03853007|60623020|60617020|60518020|60618020|49033020|60586020|56414020|68115020|68411020|71526020|56415020|68011020|71931020|60513020|73779020|67970020|60564020|49032020|86311020|60565020|60520020|56419020|87536020|87534020|68637020|68641020|60547020|60592020|60608020|54080020|75939020|56745020|68116020|56420020|60606020|52186020|71527020|52187020|56416020|56407020|68412020|56408020|75934020|56421020|60519020|68635020|49034020|68117020|86310020|68636020|52188020|49215020|53527020|53513020|53515020|68642020|67969020|90921020|58621020|56744020|72786020|60628020|58622020|68640020|58623020|60575020|68010020|67971020|58563020|02364007|52845020|86312020|60591020|60570020|68955020|57402020|60584020|60204020|79325020|60571020|79324020|57558020|52372020|56424020|57557020|60208020|68954020|58626020|57523020|57524020|75941020|75940020|90915020|03166007|72789020|52371020|60203020|55890020|56525020|58890020|56524020|60285020|59172020|60293020|71933020|60607020|60593020|86364020|58564020|05515007|05791007|75935020|48694020|61472020|90909020|82348020|75936020|!3836103|!3836104|!1960101|82353020|90913020|!1194106|60284020|83196020|76279020|52193020|60585020|70616020|90923020|52192020|90911020|60548020|74546020|57562020|58495020|57401020|83639020|83641020|83640020|80376020|02049007|82352020|82350020|82349020|90925020|77586020|79321020|57556020|60202020|60215020|57403020|90927020|74543020|49226020|60214020|53514020|60295020|79495020|49227020|48693020|60530020|74540020|85980020|59795020|56604020|56603020|62325020|76280020|90919020|79323020|55889020|49216020|56869020|76281020|56605020|48695020|62309020|49220020|57522020|63920020|68959020|53528020|49221020|85981020|49209020|58891020|49219020|64706020|62326020|61257020|60237020|59796020|57225020|64709020|56523020|62317020|59173020|59171020|76318020|60283020|88300020|60294020|60228020|84530020|60613020|97413020|97411020|97415020|97419020|97409020|97417020|97467020|62990020|97421020|84532020|62316020|55192020|84998020|53529020|57528020|49228020|79320020|90933020|84531020|60227020|61256020|65420020|51107020|56870020|98559020|98503020|57850020|68950020|83198020|73941020|92245020|56608020|05716020|05742020|68935020|05743020|05754020|05739020|05746020|37435020|05698020|05734020|69217020|64927020|38981020|35896020|68512020|05771020|05705020)"
gen ceph_carb_betalac = 0
replace ceph_carb_betalac = 1 if regexm(gemscriptcode, "`cephcodes'")
label variable ceph_carb_betalac "Cephalosporins, carbapenems and other beta-lactams exposure: 0=no exp, 1=exp"

// Tetracyclines
local tetracodes="(59238020|66948020|65333020|57784020|76011020|52259020|61290020|59241020|53942020|64065020|68858020|67826020|71533020|62869020|50598020|53946020|62868020|51875020|51303020|52021020|51881020|54368020|64764020|54710020|48273020|48272020|50599020|48276020|56982020|58750020|48929020|65340020|02156007|53941020|03218007|61289020|62867020|66966020|64763020|04630007|52260020|67825020|57785020|54375020|03514007|51872020|51902020|67871020|54702020|54663020|71555020|67905020|76429020|78870020|67181020|50144020|51886020|62875020|61284020|54701020|61282020|51903020|59242020|02157007|03632007|62251020|62874020|51899020|65334020|62250020|06688007|86250020|59271020|53943020|51878020|52261020|06407007|65341020|48666020|05739007|61481020|54224020|59139020|65344020|86778020|76426020|80705020|55071020|89328020|71455020|66963020|54740020|54662020|84602020|48423020|02155007|52925020|59279020|06723007|51885020|71404020|74564020|83609020|86944020|75146020|54741020|75147020|03821007|61484020|06200007|56391020|64083020|51906020|02316007|56301020|66953020|!7089102|!7089103|67180020|48382020|66947020|51713020|76058020|85889020|74877020|51712020|79633020|50145020|63466020|75139020|75140020|76012020|64452020|53670020|49593020|76059020|04339007|62254020|!7655101|!7089112|66967020|66954020|65210020|59280020|76765020|62972020|!1287103|!5264101|69234020|06012007|74561020|63470020|54616020|48277020|69236020|06013007|69235020|59014020|54664020|54617020|87748020|62654020|66960020|57074020|50171020|68208020|54192020|49594020|56947020|54198020|59687020|63696020|59013020|50165020|54134020|04171007|90035020|61294020|54372020|57049020|53669020|68569020|97281020|97284020|53627020|55777020|59382020|50708020|90747020|50711020|55833020|90749020|54408020|54369020|75447020|57048020|55834020|56946020|77573020|05782020|29747020|44430020|05797020|78607020|41927020|05786020|05789020|99269020|05775020|08589020|47433020|45424020|51950020|05798020|21048020)"
gen tetracyc = 0
replace tetracyc = 1 if regexm(gemscriptcode, "`tetracodes'")
label variable tetracyc "Tetracycline exposure: 0=no exp, 1=exp"

// Aminoglycosides
local aminocodes="(03644007|53071020|62931020|64967020|59819020|62939020|54920020|50623020|72505020|49670020|71767020|52005020|52004020|54448020|50937020|49704020|62932020|49660020|54479020|54480020|62940020|48027020|75994020|54896020|70630020|53188020|62356020|64176020|48679020|49656020|58692020|54452020|49663020|63419020|69755020|70921020|49667020|03280007|62916020|59823020|58687020|49666020|48680020|52598020|03383007|74196020|04120007|49636020|54534020|62915020|48894020|70617020|71312020|62920020|58372020|02209007|06745007|62318020|69752020|48258020|62935020|56581020|72502020|67190020|58371020|56597020|65203020|62340020|56593020|59827020|70622020|53452020|64968020|78879020|56618020|67192020|71502020|64177020|74790020|62914020|54449020|49655020|59832020|61441020|04674007|61440020|64995020|67198020|73935020|70920020|04866007|03279007|06254007|65204020|64992020|72282020|60837020|86420020|05753007|04677007|04692007|62617020|48028020|04693007|04679007|04675007|64963020|04069007|05812007|61982020|66183020|64982020|75090020|78876020|69586020|70631020|64987020|58689020|49708020|05530007|04683007|04681007|04877007|54517020|72053020|63366020|48224020|48223020|64988020|58688020|83245020|70405020|60327020|70619020|56582020|58329020|54895020|67103020|74787020|62936020|62947020|70618020|78037020|70632020|78572020|78566020|62921020|63427020|67107020|78569020|64964020|62960020|62095020|65023020|86419020|83863020|49901020|67191020|73945020|73936020|73934020|61450020|62618020|64979020|54535020|91360020|86448020|66184020|49903020|50723020|02481007|77493020|65002020|49906020|!2902102|!2889102|!2902108|!1256101|02542007|!2889116|62349020|62951020|58539020|63421020|!2891103|67106020|61983020|62922020|04878007|67449020|00149007|00148007|64983020|62127020|!3239101|!2889115|!0685101|64989020|!3240101|74187020|76192020|06074007|67176020|04676007|06073007|03327007|!0688103|!2891102|!2891101|70770020|58020020|63846020|!7176104|64984020|!4860101|!2644501|60852020|67453020|48683020|62952020|80602020|06072007|!1318109|62950020|56613020|!3250501|50724020|04811007|!4857103|!0685102|67538020|91358020|04944007|67448020|56967020|63847020|!4857109|!1364101|62956020|75010020|!4862101|58693020|!2973101|03645007|76189020|65028020|88125020|03736007|61044020|51534020|51531020|51530020|58694020|54484020|53726020|92416020|92418020|92414020|60838020|60839020|51536020|65207020|51535020|96333020|52720020|96335020|97103020|05145021|05144021|97191020|94829020|97193020|61011020|92420020|97600020|64976020|97668020|97666020|48684020|98345020|98422020|93547020|96125020|78077020|50147020|00691021|00376021|00689021|78079020|67752020|00374021|12112020|12988020|09637020|13077020|12121020|13069020|09626020|12111020|13075020|37899020|09628020|13070020|13068020|12110020|12120020|09639020|13076020|09478020|08870020|14748020|13742020|08871020|20843020|93441020|14024020|13066020|13074020|45516020|45517020|93549020|73604020|69262020|09640020|08869020)"
gen aminoglyc = 0
replace aminoglyc = 1 if regexm(gemscriptcode, "`aminocodes'")
label variable aminoglyc "Aminoglycoside exposure: 0=no exp, 1=exp"

// Macrolides
local macrocodes="(59396020|59398020|75849020|49307020|53071020|02622007|56230020|68314020|69352020|59402020|59397020|60855020|49300020|49309020|69351020|59403020|69353020|68309020|69381020|76384020|49314020|53077020|49312020|06683007|69143020|53068020|03770007|02624007|02620007|60849020|60844020|02619007|05015007|59404020|60856020|60843020|60842020|73575020|69356020|49313020|49303020|05019007|57928020|69357020|06682007|58448020|69429020|53078020|49294020|68313020|53079020|60848020|73696020|69140020|81193020|69380020|79789020|69379020|69431020|76385020|86654020|77604020|86660020|84082020|69138020|51247020|69358020|76383020|03351007|75817020|02617007|53074020|83705020|86014020|69139020|80466020|60837020|55226020|87838020|89861020|05022007|86832020|51704020|05021007|68308020|49639020|49638020|75044020|74144020|80468020|81195020|69485020|69488020|69430020|86013020|86834020|68310020|02623007|49308020|49901020|89865020|02621007|49902020|49903020|49906020|!2276101|!2275101|!2268109|51703020|02618007|03769007|77087020|49295020|!2277501|!2277101|49909020|58444020|49640020|53836020|59509020|51705020|80615020|61119020|83701020|84697020|03350007|89863020|60852020|53839020|!2265501|54649020|59508020|83251020|58443020|02633007|75041020|89867020|56967020|56957020|61118020|74143020|83249020|63383020|77090020|84699020|59504020|55309020|69983020|89869020|89871020|03690007|!8504110|56174020|63380020|53834020|77508020|54613020|64160020|62662020|62661020|56173020|55311020|54612020|91991020|50360020|49622020|62660020|69276020|66554020|64325020|69360020|69279020|69312020|59393020|61120020|69944020|62571020|54611020|50361020|49624020|69363020|81331020|81330020|59510020|92414020|60838020|60839020|69317020|95825020|95829020|83250020|96634020|96632020|96642020|96636020|96640020|96638020|52720020|74038020|69458020|86347020|69939020|53835020|50367020|69732020|68765020|71484020|95687020|99227020|70696020|75482020|68768020|69947020|00126021|77089020|59394020|00128021|70451020|49628020|69455020|49629020|86346020|75954020|70460020|75951020|05851020|40561020|05905020|05865020|05870020|05844020|05848020|42210020|05847020|05862020|05886020|05871020|05881020|39857020|05897020|05850020|05930020|05882020|05890020|05834020|09140020|41868020|05884020|05856020|05831020|05835020|05852020|38554020|09138020|05910020|79034020|05888020|71681020|71684020|05900020|05849020|70580020|05904020|78523020|38555020|75372020|05906020|38553020|05840020|05921020|70699020|05887020|39856020|77628020|78517020|05883020|05894020|05899020|05863020|05918020|54648020|47444020|47451020|05836020|05853020|05839020|47449020|09137020|05889020)"
gen macrolide = 0
replace macrolide = 1 if regexm(gemscriptcode, "`macrocodes'")
label variable macrolide "Macrolide exposure: 0=no exp, 1=exp"

// Clindamycin
local clindacodes="(61401020|61402020|85265020|68448020|68447020|06414007|03099007|68444020|74831020|74834020|56257020|56256020|68443020|87127020|87125020|56261020|77004020|77958020|56258020|61403020|87796020|05162007|63990020|00135007|!1691301|61407020|63995020|63991020|63992020|66467020|92133020|65643020|92125020|92127020|92131020|63997020|92731020|09153020|07127020|07126020|30399020|09779020|09147020|07129020|46987020|17059021)"
gen clinda = 0
replace clinda = 1 if regexm(gemscriptcode, "`clindacodes'")
label variable clinda "Clindamycin exposure: 0=no exp, 1=exp"

// Some other antibiotics
local othabicodes="(59221020|60722020|69200020|05212007|67899020|65368020|52789020|60706020|60728020|73948020|62180020|49569020|72542020|72543020|49579020|49572020|66607020|48648020|60719020|55866020|52775020|48647020|69189020|03230007|03231007|66610020|05210007|05904007|03743007|05208007|69199020|73689020|52772020|65369020|61582020|80629020|61586020|56215020|06574007|48019020|72547020|61573020|05211007|49583020|60711020|05209007|05567007|59251020|52780020|61578020|61577020|61587020|72546020|60707020|78813020|66707020|02508007|61583020|78140020|78149020|05566007|65330020|65377020|65372020|65374020|60708020|60713020|76301020|83851020|49576020|02509007|51120020|!1242106|!1244803|65324020|04226007|76734020|73686020|74770020|61572020|67335020|!9131359|61082020|!1242105|!1244101|05213007|55208020|67133020|!1248701|!7018101|49257020|65378020|!4581107|!2716101|69190020|77327020|!1242103|!5260101|90453020|!2715102|!2718103|73722020|01913007|60724020|84568020|89338020|51125020|67336020|78138020|51116020|60732020|90937020|56600020|52785020|65373020|62169020|57787020|49267020|56596020|56595020|51119020|49256020|66089020|57783020|57141020|62556020|62557020|49255020|57140020|67271020|65591020|49250020|91552020|66710020|93642020|93890020|93823020|90483020|92220020|94785020|90481020|56227020|53043020|55207020|51124020|97678020|90939020|66426020|67279020|99053020|00193021|49262020|08579020|41409020|60723020|09208020|41451020|41407020|36343020|81556020|27946020|61047020|08582020|71132020|51121020|49252020|49266020|47585020|09203020)"
gen otherantibiot = 0
replace otherantibiot = 1 if regexm(gemscriptcode, "`othabicodes'")
label variable otherantibiot "Other antibiotic exposure: 0=no exp, 1=exp"

// Sulfonamides and trimethoprim
local sultricodes="(68194020|53625020|66810020|66400020|51537020|68199020|05621007|66804020|50506020|66391020|66800020|66394020|68193020|68190020|66791020|68198020|59048020|66386020|59050020|49486020|53629020|53628020|53620020|66388020|05150007|66794020|02823007|51538020|05155007|53982020|53976020|52018020|50012020|68197020|50505020|59049020|51168020|05157007|53989020|48292020|05880007|59053020|52017020|68320020|68153020|87474020|02831007|05149007|53979020|51169020|01792007|96346020|50509020|50504020|54553020|49964020|03959007|49963020|65936020|65937020|87458020|01854007|88766020|59870020|02830007|!6539104|87460020|88770020|51912020|02438007|87464020|65632020|52016020|74846020|71341020|59107020|67277020|51733020|!7274601|53985020|51803020|87468020|97130020|51804020|50768020|66803020|87462020|88776020|01966007|58474020|59056020|95866020|60354020|96336020|53385020|66797020|67276020|79695020|59112020|66807020|59372020|87470020|54436020|88768020|58480020|58477020|88772020|50767020|53383020|95864020|96340020|87472020|88774020|54432020|65037020|65535020|57158020|50760020|65532020|53384020|67423020|51148020|50759020|91099020|97108020|98344020|93670020|01058021|01067021|01059021|01068021|91101020|59373020|01061021|01977021|01978021|71652020|05317021|05303021|05312021|05306021|05315021|05300021|05295021|05298021|54431020|49394020|05304021|05308021|49395020|55240020|55241020|58936020|49390020|49383020|54473020|52426020|50764020|57157020|98967020|59122020|98969020|67419020|87466020|05296021|53988020|06003020|39858020|06004020|06006020|34818020|05995020|34812020|06008020|06009020|06010020|06007020|71647020|78611020|76750020|05998020|95241020|05994020|72838020|34814020|06001020|06002020|47456020|15677021|34816020)"
gen sulfo_trimeth = 0
replace sulfo_trimeth = 1 if regexm(gemscriptcode, "`sultricodes'")
label variable sulfo_trimeth "Sulfonamides and trimethoprim exposure: 0=no exp, 1=exp"

// Antituberculosis drugs
local tuberccodes="(01861007|66513020|01862007|00018007|66766020|66517020|51398020|66516020|56029020|51400020|53317020|53318020|66348020|60890020|60889020|75067020|56025020|56024020|63678020|03349007|60896020|60900020|03306007|66524020|51404020|66520020|66512020|00017007|66523020|53282020|51382020|70639020|03305007|00072007|02388007|03695007|51381020|02613007|02774007|63664020|66354020|00069007|06694007|75064020|00075007|51380020|00070007|00071007|00068007|50562020|06593007|03694007|52824020|52823020|50561020|50573020|51399020|60894020|02614007|03579007|03696007|63663020|02380007|03698007|63660020|60895020|54672020|89354020|00073007|02615007|50575020|00015007|03699007|70638020|00074007|71268020|50574020|50563020|53314020|00067007|03697007|70704020|57349020|57348020|54568020|56240020|89484020|89873020|95863020|95865020|51410020|51414020|66511020|60621020|93151020|56072020|20177020|20169020|32519020|00016007|06044020)"
gen antituberc = 0
replace antituberc = 1 if regexm(gemscriptcode, "`tuberccodes'")
label variable antituberc "Antituberculosis drug exposure: 0=no exp, 1=exp"

// Antileprotic drugs
local leprcodes="(66163020|59234020|57784020|53942020|71488020|59233020|74386020|53946020|51398020|64764020|53941020|64763020|56019020|57785020|50283020|53820020|53819020|88426020|56020020|53943020|66374020|03823007|89328020|02764007|06601007|61453020|86944020|75146020|75147020|61726020|50409020|74877020|79633020|50082020|03824007|51399020|62215020|02765007|50410020|50400020|54231020|50401020|51719020|52139020|68208020|54568020|54227020|50399020|50408020|57098020|65523020|54228020|65526020|54134020|51718020|90035020|57049020|55527020|66511020|57048020|28093020|06607020|33911020|33915020|99269020|33907020|34075020|06621020|68843020|47496020)"
gen antileprotic = 0
replace antileprotic = 1 if regexm(gemscriptcode, "`leprcodes'")
label variable antileprotic "Antileprotic drug exposure: 0=no exp, 1=exp"

// Metronidazole and tinidazole 
local metrotincodes="(64704020|02249007|59810020|60013020|49475020|64677020|64676020|49480020|67093020|82884020|68451020|02246007|06748007|57948020|49481020|52630020|60011020|68551020|64689020|76346020|86498020|76345020|72584020|64680020|85949020|64681020|51247020|64701020|04977007|03288007|85905020|49408020|80005020|77309020|60012020|02247007|02251007|78822020|78024020|80701020|64685020|89409020|89407020|02252007|69886020|75153020|64700020|75150020|06125007|50098020|02250007|64688020|80703020|56452020|64684020|64696020|77128020|54041020|!4533106|89405020|!4533105|71411020|05496007|50362020|74543020|50090020|61738020|54748020|75337020|50099020|50080020|67094020|50081020|60562020|50094020|50093020|60561020|88300020|69337020|95869020|69340020|73420020|50086020|50089020|68020020|50097020|77716020|59449020|73423020|09231020|09235020|09223020|09236020|06058020|33526020|06052020|09228020|09233020|09232020|09229020|39860020|06059020|06053020|06057020|39861020|06061020|47613020|06076020|09230020|06070020|45483020|06065020|33524020)"
gen metro_tinidazole = 0
replace metro_tinidazole = 1 if regexm(gemscriptcode, "`metrotincodes'")
label variable metro_tinidazole "Metronidazole and tinidazole exposure: 0=no exp, 1=exp"

// Quinolones 
local quinocodes="(74369020|67978020|64916020|74373020|75497020|72727020|72728020|67980020|67985020|67983020|74372020|73742020|72721020|48289020|64915020|51054020|74374020|72720020|86259020|75494020|86272020|86258020|83837020|50640020|50639020|73739020|54154020|74367020|64920020|74368020|67979020|64917020|86292020|48688020|87484020|61373020|69715020|89913020|67984020|69718020|66551020|86271020|66552020|66383020|66698020|89915020|65785020|72001020|87490020|86315020|86302020|83847020|79753020|65608020|84346020|!1326501|84114020|56733020|63935020|63938020|63943020|87488020|63780020|56774020|61180020|87492020|79812020|87486020|63349020|90625020|63777020|63804020|63836020|63352020|63833020|64515020|63827020|63343020|63346020|63849020|63807020|64679020|63824020|65394020|66423020|63839020|66380020|90627020|87494020|94653020|94817020|63845020|94819020|93071020|64223020|64226020|65192020|93569020|63810020|65399020|63853020|71769020|63659020|64518020|64683020|99235020|94655020|98160020|78499020|86314020|71120020|06103020|38561020|37873020|06128020|06117020|05989020|06108020|06096020|06129020|38090020|06116020|06106020|06113020|28823020|67197020|06125020|06115020|38323020|69073020|38564020|06120020|38560020|21062020|06098020|06124020|28825020|78100020|38562020|06151020|06161020|06127020|28824020|38984020|67194020|06118020|21061020)"
gen quinolone = 0
replace quinolone = 1 if regexm(gemscriptcode, "`quinocodes'")
label variable quinolone "Quinolone exposure: 0=no exp, 1=exp"

// Urinary Tract Infections 
local uticodes="(65084020|49610020|50506020|65087020|65082020|50272020|49608020|50271020|65088020|49609020|65083020|49817020|64478020|65089020|03277007|57292020|52018020|68197020|52404020|51516020|75292020|65623020|54553020|49964020|49963020|65093020|02505007|75296020|74846020|48176020|67277020|!4920201|51803020|65891020|75297020|51804020|75293020|67276020|64475020|65629020|54436020|50760020|50759020|66935020|67645020|56044020|56045020|54431020|54473020|50764020|06088020|33240020|06081020|67640020|71811020|68800020|09967020|06083020|45102020|33181020|33260020|40562020|47464020)"
gen uti_drugs = 0
replace uti_drugs = 1 if regexm(gemscriptcode, "`uticodes'")
label variable uti_drugs "UTI drug exposure: 0=no exp, 1=exp"

// Antibacterials (includes above 13 groups)
gen antibacterial = 0
replace antibacterial = 1 if penicillin==1|ceph_carb_betalac==1|tetracyc==1|aminoglyc==1|macrolide==1|clinda==1|otherantibiot==1|sulfo_trimeth==1|antituberc==1|antileprotic==1|metro_tinidazole==1|quinolone==1|uti_drugs==1
label variable antibacterial "Antibacterial drug exposure: 0=no exp, 1=exp"

// Antifungal drugs
local afungcodes="(66163020|59234020|63066020|51117020|61493020|68917020|67576020|71488020|59233020|70949020|69725020|74165020|88424020|68922020|69721020|74386020|80059020|74162020|63879020|50598020|51114020|53235020|65177020|68923020|49595020|56251020|62285020|67577020|50599020|80314020|63065020|68918020|63878020|75419020|64739020|61750020|71849020|56153020|85627020|53247020|72517020|53050020|66162020|63874020|65174020|61496020|68579020|66966020|63064020|49726020|50729020|50826020|51562020|49596020|49586020|63875020|68924020|68919020|53880020|81558020|67578020|50728020|74171020|80057020|53820020|64111020|64559020|64560020|53819020|87087020|83176020|78557020|86642020|69619020|49725020|62281020|55931020|68246020|67582020|76342020|87642020|90027020|03054007|50140020|06946007|61751020|80707020|64112020|87646020|67585020|02191007|87644020|90401020|78206020|69549020|82847020|90029020|82851020|77330020|87712020|88420020|90201020|03125007|48844020|56252020|82753020|90783020|03691007|06955007|49591020|76339020|61726020|71010020|89476020|52533020|53244020|87714020|50409020|48880020|50141020|65178020|71302020|!4928102|54949020|75551020|!0250105|66967020|61934020|05980007|82634020|78554020|52733020|88239020|03126007|50410020|06012007|66706020|50400020|73200020|59125020|50117020|60428020|89478020|49996020|00142007|66166020|75550020|49997020|54231020|69722020|50401020|51719020|66010020|79654020|88322020|80158020|83853020|88478020|49213020|62946020|65610020|65735020|65569020|54227020|50399020|50408020|65634020|57098020|63647020|65637020|65523020|54228020|65566020|65526020|65625020|51718020|92953020|92951020|92957020|92825020|93005020|92967020|87007020|69369020|92963020|88324020|90391020|80348020|03432007|79624020|50111020|58850020|50122020|94693020|49599020|94695020|67581020|59124020|90389020|95314020|71872020|94809020|75628020|82344020|96929020|58846020|96923020|68386020|96925020|96927020|97296020|75948020|96933020|96931020|55527020|64355020|79077020|65613020|75629020|65607020|76853020|65573020|65658020|51727020|74641020|65740020|98728020|64561020|98755020|98198020|65628020|63508020|71504020|77388020|66470020|92981020|99685020|72229020|65647020|65887020|00721021|97922020|65720020|98757020|71568020|71921020|92551020|06189020|37644020|37473020|37473020|00172020|06201020|39866020|06200020|20040020|06182020|00170020|36104020|36229020|35349020|00162020|35347020|06236020|06223020|36098020|36410020|36130020|36092020|41224020|06607020|00168020|36280020|45041020|19534020|40490020|06221020|06173020|06203020|10088020|19536020|00167020|06239020|06175020|33911020|06634020|42073020|42069020|36122020|21863020|44158020|41220020|06228020|06238020|33915020|36110020|41240020|36134020|41661020|33907020|68608020|36294020|75206020|36114020|06227020|71693020|37567020|34075020|06621020|72422020|19530020|36554020|45398020|36010020|36132020|47496020|40488020|37949020|06207020|00164020|00163020|36008020|76608020)"
gen antifungal = 0
replace antifungal = 1 if regexm(gemscriptcode, "`afungcodes'")
label variable antifungal "Antifungal exposure:0=no exp, 1=exp"

// Antiviral drugs
local avircodes="(57632020|79631020|64502020|75384020|64503020|59999020|53647020|65400020|60000020|83664020|76099020|57729020|78963020|78960020|58879020|69303020|06333007|57633020|60764020|58877020|69196020|52347020|58289020|58878020|53652020|78793020|64427020|58126020|75055020|75239020|65565020|86290020|60005020|60001020|86800020|80281020|71044020|69304020|69305020|81838020|79570020|79572020|75986020|60097020|60765020|75240020|57702020|75241020|84912020|84321020|63560020|83607020|87133020|87033020|90774020|80164020|83918020|86624020|88821020|83133020|89283020|51774020|75234020|57338020|75235020|64508020|64506020|75057020|75236020|79413020|74466020|75056020|84260020|48147020|49472020|70833020|86599020|86662020|83926020|80368020|80370020|81054020|52814020|57342020|49371020|75387020|87031020|86973020|84472020|88568020|73136020|60183020|64507020|68672020|84325020|59746020|64511020|68671020|79275020|86664020|88566020|91526020|65432020|82232020|61787020|76400020|75807020|83164020|84358020|49848020|84031020|79427020|84812020|82912020|86276020|76910020|79574020|87720020|78669020|81032020|86611020|87316020|78718020|76564020|49014020|60204020|76349020|82947020|82946020|80040020|79426020|50683020|84474020|60208020|82453020|68927020|90790020|76401020|86616020|84319020|77690020|56231020|83349020|79834020|60203020|56565020|56564020|86802020|61712020|!0060101|53597020|87500020|74479020|74488020|66632020|57345020|62982020|96659020|80612020|84914020|86274020|68665020|83188020|67352020|67491020|76775020|88408020|53305020|64512020|01671007|83203020|86632020|83904020|72845020|84316020|88968020|87718020|81478020|78668020|84314020|87139020|57326020|57325020|84150020|91511020|89942020|91089020|84379020|74419020|76954020|83893020|83409020|68666020|49499020|91515020|80092020|52809020|68752020|83186020|93788020|82909020|90994020|83160020|55045020|86829020|84323020|56122020|64513020|91528020|91518020|72321020|74456020|75806020|80613020|82913020|74473020|89670020|75802020|56121020|78236020|80328020|74529020|83513020|65408020|60202020|78239020|60215020|73155020|48330020|91087020|68667020|80429020|60214020|78984020|60006020|57390020|83165020|83166020|60004020|64430020|74482020|52343020|80844020|76774020|57634020|73028020|57324020|52300020|94083020|82910020|74476020|76909020|63890020|83891020|86803020|!8502170|86613020|88684020|68930020|82235020|68670020|59835020|89336020|83917020|57861020|87724020|79082020|60981020|89944020|79378020|91129020|77168020|55277020|63889020|59003020|91520020|87339020|79459020|96952020|86280020|82919020|57856020|86275020|83347020|91179020|91524020|82231020|72734020|88964020|82908020|60994020|65443020|64444020|69099020|58127020|60139020|58992020|60141020|60982020|66445020|91522020|77362020|91131020|56566020|60993020|88819020|91532020|92815020|93207020|91336020|79460020|72327020|82234020|88197020|91530020|86785020|94374020|91177020|94372020|74530020|93573020|86278020|94439020|93139020|74528020|94319020|87722020|94441020|94323020|95087020|94321020|91181020|83130020|87726020|93210020|93721020|94325020|97060020|97064020|97058020|97068020|97070020|97072020|97054020|97062020|97066020|97056020|96682020|94449020|95807020|92817020|96943020|97219020|93212020|96686020|96766020|59001020|95075020|91338020|74124020|56123020|96967020|95073020|88823020|94219020|52306020|48816020|66439020|95795020|96556020|83187020|79081020|89853020|76632020|97674020|52808020|63891020|58125020|70431020|72842020|05834021|59002020|95085020|60140020|91694020|96768020|98679020|76635020|95797020|84136020|83134020|99086020|99414020|89524020|65478020|99554020|10545021|99418020|98463020|99422020|99705020|99701020|99695020|99699020|91183020|98559020|99709020|99707020|92607020|96130020|98465020|05842021|85751020|60992020|63455020|77102020|05856021|97341020|00186021|96688020|94221020|91698020|77095020|00080021|00695021|00671021|00673021|00555021|00323021|29119020|11455020|29110020|11457020|07360020|40579020|29120020|99088020|10754020|07335020|07344020|29108020|29109020|29111020|07349020|32789020|37827020|07336020|10755020|78775020|06272020|14042020|07337020|11456020|07345020|46244020|09845020|44056020|00166021|36581020|46243020|83932020|37435020|52344020|00828021|06254020|20477020|91513020|74394020|47901020|73505020|76106020|00685021|14700021|38455020|41878020|29322020|98669020|15594021|38454020|99711020|14705021|47527020|97345020|74399020|08566020|06269020|06344020|42109020)"
gen antiviral = 0
replace antiviral = 1 if regexm(gemscriptcode, "`avircodes'")
label variable antiviral "Antiviral exposure:0=no exp, 1=exp"

// Antiprotozoal drugs
local aprotcodes="(66163020|56015020|59234020|69308020|51537020|64704020|56013020|61401020|76011020|61202020|52259020|02249007|66391020|66394020|59810020|60013020|67809020|68190020|64677020|56014020|63495020|73846020|64676020|49480020|61201020|81589020|61205020|69309020|53865020|86349020|71488020|59233020|84705020|66154020|61402020|81587020|63324020|67093020|66155020|85762020|74386020|62869020|62868020|73849020|49881020|69310020|82884020|66153020|53629020|53628020|68451020|02246007|06748007|66274020|04468007|69662020|56982020|05465007|57948020|68063020|68066020|51017020|69659020|62867020|67803020|05963007|67806020|52260020|50719020|50718020|48281020|68054020|49481020|02015007|51538020|50971020|04466007|52630020|66158020|50283020|04467007|83746020|68056020|05194007|60011020|62572020|03636007|49880020|68551020|05463007|69313020|64689020|76346020|68055020|72784020|69314020|86498020|76345020|68058020|72584020|54196020|49882020|51573020|85968020|64680020|53820020|84706020|85763020|85949020|80484020|63556020|64681020|53819020|84651020|64392020|86328020|86356020|84858020|78870020|51247020|85966020|83003020|89356020|80372020|64701020|86368020|53982020|53976020|62875020|83686020|58779020|04461007|05671007|04460007|68062020|69315020|49886020|05738007|59049020|53989020|62874020|48292020|03288007|05669007|68288020|62579020|63557020|59053020|86250020|85905020|49408020|80005020|83886020|89358020|77309020|68153020|87474020|66374020|52261020|61197020|48860020|53979020|60012020|48295020|02247007|02251007|66371020|86778020|81056020|86861020|78822020|78024020|66720020|53273020|51809020|80705020|65060020|77197020|55071020|90569020|86332020|71455020|66377020|80701020|64685020|54667020|89409020|89407020|66785020|02252007|87458020|69886020|48296020|60124020|51572020|53059020|75153020|64700020|02281007|02873007|83609020|75150020|86034020|52558020|61726020|64070020|50098020|64260020|!6083502|51736020|87460020|88770020|90119020|87464020|04462007|56301020|02250007|64688020|66953020|50409020|80703020|04465007|86333020|76314020|76315020|71341020|51713020|85889020|51712020|05670007|05668007|56452020|82989020|50454020|64684020|59107020|75139020|75140020|61209020|68291020|76012020|00166007|86329020|53670020|49593020|90585020|76311020|64696020|04050007|!4339101|68287020|53985020|66954020|80419020|80421020|77128020|71773020|87468020|51807020|51808020|62215020|54041020|76765020|68286020|62972020|!4533106|89405020|91285020|87462020|88776020|!4533105|!6085103|58474020|59056020|84943020|71411020|05496007|!6085104|50410020|90605020|50362020|83550020|69234020|80760020|04463007|50485020|74543020|50090020|50400020|61738020|91271020|54748020|59112020|75337020|59372020|87470020|54616020|90603020|69236020|69235020|58480020|58477020|50099020|54231020|55539020|88772020|02282007|59014020|50080020|54664020|54617020|67094020|50401020|51719020|66467020|50490020|84945020|64037020|50471020|62654020|87472020|50081020|88774020|50499020|90571020|49594020|60610020|56947020|60562020|64067020|54227020|50399020|50094020|59687020|50408020|57098020|64041020|63696020|50093020|64033020|64171020|65523020|53379020|64168020|50494020|54228020|59013020|65526020|50468020|65643020|50484020|51718020|90640020|93137020|90573020|50500020|93509020|92125020|93725020|92805020|92057020|71776020|91931020|71782020|93860020|92709020|60561020|93862020|93699020|71779020|59373020|92127020|93900020|69337020|95869020|69340020|00097007|96646020|53669020|64073020|97281020|64251020|97284020|73420020|55527020|53380020|50489020|64244020|55777020|59382020|54583020|54209020|50086020|50089020|54210020|68020020|49395020|55240020|55241020|90857020|49390020|49383020|51814020|52426020|54267020|54222020|93902020|59122020|66402020|98716020|54258020|98190020|99157020|50097020|75714020|64311020|64318020|68875020|64184020|87466020|99273020|77716020|99332020|99138020|53988020|75447020|54223020|59449020|97868020|77113020|73423020|77475020|61196020|56946020|65746020|95159020|09231020|32236020|09235020|32239020|32237020|09223020|09236020|32240020|06058020|05782020|33526020|01346020|30399020|09779020|06052020|09228020|09233020|09232020|09229020|07190020|65764020|06607020|39860020|35345020|07186020|06059020|06053020|06383020|32238020|05797020|00008020|06384020|21594020|41927020|05786020|33911020|01362020|41299020|05998020|06057020|07182020|05789020|33915020|08390020|39861020|20717020|93179020|33907020|07189020|06360020|38498020|34075020|72838020|06621020|47433020|06061020|47613020|54216020|64180020|01340020|06076020|65760020|05798020|09230020|06070020|35342020|47496020|06355020|06357020|01352020|65774020|45483020|06065020|64175020|06385020|33524020|30736020)"
gen antiprotoz = 0
replace antiprotoz = 1 if regexm(gemscriptcode, "`aprotcodes'"))
label variable antiprotoz "Antiprotozoal exposure:0=no exp, 1=exp"

// Anthelmintics
local ahelcodes="(58303020|88424020|52244020|64304020|64303020|52243020|65823020|65827020|65035020|79616020|02099007|77623020|75638020|83957020|65824020|70697020|02286007|71377020|48155020|53516020|48168020|81446020|81445020|71380020|53815020|52317020|88420020|85883020|!5840102|!5840103|85865020|85903020|86908020|65830020|65249020|89006020|62497020|64140020|62494020|48330020|80768020|89234020|92953020|92951020|92957020|94709020|96929020|96923020|96925020|96927020|96933020|96931020|00778021|00671021|00673021|06403020|41843020|34961020|10088020|09845020|09836020|29322020)"
gen anthelmintic = 0 
replace anthelmintic = 1 if regexm(gemscriptcode, "`ahelcodes'")
label variable anthelmintic "Anthelmintic exposure:0=no exp, 1=exp"

// Thyroid hormones
local thyroidcodes="(55991020|55990020|55989020|49223020|49222020|71575020|64012020|87229020|51890020|83356020|89934020|49224020|90737020|04305007|91496020|50731020|50722020|67050020|56291020|48936020|50717020|91501020|50716020|50721020|88189020|91499020|65790020|65793020|65796020|57537020|50715020|48937020|67053020|64417020|65890020|50726020|50727020|91507020|91505020|91503020|94518020|67114020|94520020|69117020|69114020|51953020|74149020|66927020|62253020|91730020|51955020|00908021|98576020|98574020|41630020|11026020|41631020|38325020|35453020|41629020|09835020|09544020|37656020|74146020|91734020|20299020|20297020|41427020|28787020|20349020|32739020|74142020|21003020|28560020)"
gen thyroidhorm = 0
replace thyroidhorm = 1 if regexm(gemscriptcode, "`thyroidcodes'")
label variable thyroidhorm "Thyroid hormone exposure: 0=no exp, 1=exp"

// Corticosteroids (endocrine)
local cortendocodes="(66163020|59141020|59234020|62323020|52313020|61624020|67899020|70684020|56601020|70870020|71488020|59233020|58316020|52769020|62939020|59146020|56622020|69583020|48406020|54461020|57831020|51284020|56267020|48829020|59145020|49579020|06675007|74386020|59140020|54458020|71826020|48031020|54899020|72505020|54462020|51285020|59142020|51216020|84169020|62352020|49670020|62335020|56264020|52005020|52004020|64156020|54448020|50937020|61531020|62322020|53914020|51875020|48777020|61754020|50813020|48830020|52314020|54471020|51881020|51220020|54470020|54476020|54479020|54465020|54480020|70691020|50814020|54475020|62940020|48272020|64750020|03730007|53915020|64153020|70625020|53188020|60719020|57832020|48184020|84167020|51595020|52691020|48087020|49867020|62356020|68592020|69640020|64158020|75949020|52775020|54445020|64176020|58788020|63411020|54439020|03256007|55319020|50231020|63384020|58637020|64573020|02254007|79953020|02973007|65340020|61414020|48653020|54528020|66161020|04515007|05471007|49494020|54452020|61943020|02415007|79133020|53047020|79417020|68589020|48181020|49217020|63438020|54384020|49374020|66162020|61413020|06170007|81564020|51493020|63419020|68588020|04507007|59147020|53016020|51492020|66610020|54531020|50232020|59229020|70610020|03590007|48413020|64162020|49667020|48410020|49203020|70848020|58725020|58687020|49666020|51562020|64157020|50196020|63491020|52917020|05208007|66187020|59228020|49204020|54009020|68496020|57512020|63381020|03986007|74196020|56623020|58697020|52686020|57434020|52736020|03729007|06351007|57602020|05277007|52916020|72190020|53012020|03818007|83654020|64172020|61632020|50024020|67172020|70617020|49210020|62327020|74580020|03319007|58710020|56285020|50233020|67167020|67171020|63492020|00031007|04691007|04516007|63385020|51596020|63447020|71944020|56589020|67851020|48258020|62321020|62123020|62185020|72502020|67190020|63485020|65189020|58859020|56597020|75320020|62340020|66179020|70849020|72603020|70614020|75321020|68493020|86370020|62189020|74239020|86708020|64751020|56586020|52553020|83302020|53820020|64586020|57082020|57083020|72285020|75097020|63441020|77863020|58910020|53819020|62345020|55068020|83997020|58008020|86469020|56593020|52417020|79418020|86962020|70622020|76429020|69984020|78879020|77860020|67192020|71502020|70077020|74388020|66180020|81566020|64161020|69637020|67706020|64177020|86688020|70627020|83622020|67902020|74790020|86417020|70626020|67181020|75121020|76355020|54449020|71922020|76457020|70611020|48407020|92071020|87443020|03255007|04870007|05573007|05274007|03588007|64163020|70840020|04505007|70841020|63459020|69364020|02056007|58429020|00044007|50153020|69820020|61025020|70873020|69573020|06350007|64591020|66172020|49205020|48019020|63375020|64995020|53011020|04504007|57249020|49211020|63463020|63388020|75988020|69367020|63369020|06582007|63372020|57603020|04866007|63456020|06355007|63482020|48034020|03279007|01773007|49212020|06254007|05095007|03726007|54455020|67184020|02260007|81751020|63437020|74240020|55104020|83656020|82868020|57511020|64992020|56885020|63392020|63434020|71490020|72282020|80543020|57978020|74387020|56886020|86420020|74583020|90819020|63473020|61417020|05753007|49534020|59631020|56284020|63415020|05567007|06407007|64574020|61623020|62329020|70685020|64589020|64572020|67168020|56838020|49862020|05812007|64150020|03728007|51213020|65341020|00134007|72100020|56606020|50911020|64169020|48403020|66183020|66178020|63389020|70078020|62328020|64982020|63430020|61791020|61418020|78876020|69586020|64987020|79548020|03318007|04871007|04874007|50129020|02876007|04683007|04872007|62112020|04868007|04681007|04877007|48785020|48793020|64583020|48299020|71335020|04651007|63366020|63448020|48224020|48223020|64988020|83245020|62344020|62188020|65344020|70405020|58009020|64173020|62343020|70619020|57435020|64582020|04869007|04506007|02057007|52887020|65190020|57986020|71641020|48035020|74787020|76613020|56636020|64579020|51221020|91318020|05093007|63416020|62119020|57513020|62118020|76455020|70618020|83998020|78037020|89887020|91302020|91320020|70584020|53740020|92107020|89459020|67195020|05694007|71945020|51212020|02416007|64590020|63427020|05094007|54732020|70607020|80604020|91308020|91322020|03589007|86419020|76038020|03817007|00103007|63431020|69324020|62122020|67191020|83655020|76301020|63460020|03668007|58554020|62111020|00030007|06250007|79549020|56650020|86296020|54535020|69821020|72923020|03317007|05831007|50128020|03838007|66184020|48789020|54091020|64578020|77493020|04875007|04166007|61726020|70072020|54468020|89889020|00982007|02413007|!1756101|!0694101|!0695102|67163020|62349020|81647020|76885020|02414007|58192020|92063020|00104007|76734020|83660020|63421020|!5795202|!6087101|!3237119|!0684102|!2891103|03727007|!0695101|76884020|05808007|78819020|02974007|50409020|06354007|68187020|04878007|56344020|64983020|!3251101|!1266101|58005020|82866020|67180020|48880020|53177020|!0694102|06008007|91324020|!1382301|!3239101|!0684101|!0685101|!2163501|!2737102|!2737101|63466020|64989020|54996020|!3240101|!3251102|83662020|54442020|63479020|04880007|06353007|05810007|74187020|05213007|04876007|63476020|76192020|67164020|06074007|05440007|48788020|04509007|67176020|56343020|51209020|06073007|!5026101|06218007|!1255201|86706020|54731020|!0688103|57954020|!7674101|82590020|06107007|!2891102|!2891101|54066020|05092007|04508007|!0686401|!5795107|06113007|!1535101|!7481101|!4581123|!1756108|!0687102|72920020|51208020|!1796101|04318007|64984020|56347020|56573020|62332020|05096007|05278007|57987020|05161007|!1360101|05815007|!1756301|!1756102|06287007|62124020|06356007|92109020|02055007|!3250501|75403020|!0134901|!3237103|05624007|!2691102|!5795110|!5795111|54004020|!0685102|71642020|!1360102|!5264101|68186020|!6648101|!0683402|50410020|51722020|61722020|90690020|02259007|54005020|83661020|06352007|61723020|50400020|04873007|!4862101|05692007|67173020|63470020|06349007|04510007|66166020|54231020|84232020|64644020|61648020|76189020|51389020|56752020|78146020|51565020|06106007|50401020|51719020|54469020|66018020|91316020|92101020|48945020|51386020|51723020|62621020|56243020|61132020|50200020|71489020|63412020|51597020|54511020|70053020|51568020|62379020|52868020|51385020|54467020|54227020|50399020|50408020|48944020|52850020|57098020|56118020|53726020|62620020|65523020|54228020|48946020|65526020|55666020|52869020|53490020|52867020|49796020|49797020|50404020|53489020|51718020|92111020|92059020|92067020|92307020|92303020|91927020|92103020|92434020|91304020|92105020|74310020|88554020|93843020|94027020|94023020|94029020|92436020|04300007|92991020|92309020|56624020|79527020|92989020|94715020|94691020|92567020|91895020|61294020|92265020|51379020|91897020|92115020|65207020|95976020|95974020|53922020|51384020|96909020|87345020|64609020|76224020|66013020|96851020|06241007|97361020|97359020|97523020|88534020|52872020|55527020|55554020|57245020|52864020|64355020|62380020|93317020|63449020|68490020|98343020|98420020|98345020|98422020|92305020|93103020|61533020|52884020|51727020|98877020|98889020|94031020|98893020|98899020|98897020|91780020|51724020|99545020|76212020|77631020|98891020|88506020|78430020|98827020|98829020|72102020|96951020|51393020|56748020|76200020|00611020|11073020|36193020|09024020|06598020|06597020|06599020|12988020|06590020|09012020|10178020|13077020|09698020|35237020|09019020|13069020|13778020|13235020|09029020|09021020|06636020|13075020|06637020|06564020|06592020|21518020|09022020|13070020|13068020|09467020|11231020|06591020|09009020|14131020|10289020|09496020|44430020|13779020|09060020|13076020|08870020|20239020|06607020|12395020|40205020|32190020|09474020|36273020|36388020|21498020|09028020|32204020|08871020|59063020|19597020|19929020|09033020|12397020|37951020|00605020|21506020|06565020|14024020|88556020|72099020|95127020|33911020|06634020|09497020|09023020|38352020|09475020|13066020|11438020|67162020|13074020|21471020|46191020|33915020|41746020|14794020|98895020|33907020|76210020|35238020|09037020|29799020|46189020|13252020|34075020|36088020|06568020|06621020|74093020|75406020|52858020|69262020|36277020|47605020|13232020|21504020|77688020|19689020|29397020|09470020|14582021|47496020|14717021|11448020|08869020|14583021|10172020|11449020|21491020|16448021)"
gen cortico_endocr = 0 
replace cortico_endocr = 1 if regexm(gemscriptcode, "`cortendocodes'")
label variable cortico_endocr "Corticosteroid (endocrine) exposure:0=no exp, 1=exp"

// Estrogens and HRT
local estrocodes="(58098020|67954020|69412020|73540020|61493020|80077020|56922020|55162020|62288020|76155020|51240020|69539020|55257020|60238020|58123020|68482020|69411020|69410020|55176020|51975020|52551020|52742020|57072020|65486020|79354020|51239020|55150020|55196020|68585020|55144020|74395020|74397020|79535020|80106020|58092020|51244020|52536020|79408020|55980020|68612020|61012020|55169020|56923020|83754020|80507020|74396020|58041020|73528020|68613020|55235020|77626020|58423020|51241020|58042020|72222020|52507020|49065020|76110020|84851020|81290020|61724020|58115020|55188020|61496020|52480020|80551020|58116020|81876020|81095020|58119020|81875020|61596020|84798020|55244020|79436020|55223020|79437020|61597020|80550020|84855020|58120020|80545020|85617020|86142020|80665020|80666020|57925020|69399020|81877020|80546020|61004020|76414020|83257020|69397020|79381020|69398020|86394020|80196020|69404020|84064020|84978020|69403020|55982020|84146020|79469020|76552020|79410020|74765020|86126020|67960020|86130020|80167020|87752020|78200020|81044020|80636020|83975020|69402020|61009020|56939020|81026020|52698020|74767020|81099020|72223020|81100020|79411020|78218020|61003020|56940020|02052007|05002007|70088020|03253007|05006007|81034020|80359020|55612020|55981020|05004007|02602007|66437020|68702020|76113020|70672020|55613020|72638020|06612007|81040020|79438020|62487020|52479020|66434020|79283020|05009007|58557020|65144020|84856020|65145020|76737020|57503020|84982020|81101020|80200020|76753020|83921020|56953020|84963020|88758020|88760020|88752020|88756020|06665007|78903020|78902020|79440020|65289020|79442020|80632020|80638020|79441020|65290020|81861020|80079020|88746020|80360020|87750020|84152020|79537020|57504020|81863020|79383020|79382020|77315020|82849020|69570020|83605020|80812020|78904020|81018020|84154020|78741020|77080020|88744020|58061020|70660020|84435020|70661020|80352020|81197020|81862020|56955020|82229020|80794020|80120020|84437020|88742020|90879020|05010007|84436020|84164020|81046020|80917020|80806020|79539020|81103020|80634020|78209020|89178020|80133020|80766020|53144020|80633020|79241020|87336020|90889020|61015020|74766020|80122020|83253020|70657020|69837020|90885020|70673020|90883020|80788020|54179020|80121020|80108020|79538020|88754020|!5815104|58067020|!5815105|81042020|79259020|88748020|90881020|53164020|!5817301|82526020|84163020|05541007|58080020|69836020|02612007|80637020|79635020|!5815101|91085020|69569020|!8504311|89176020|79636020|62289020|80165020|!5817302|06663007|81052020|06719007|79116020|84804020|88147020|51931020|05843007|88750020|03633007|90713020|75773020|60999020|78161020|62488020|61000020|80916020|89885020|80768020|84162020|66010020|88991020|82705020|85562020|86956020|52739020|93077020|93240020|93238020|90887020|90697020|93808020|90865020|90867020|93810020|90861020|90863020|66240020|95909020|95911020|95913020|95915020|96393020|96648020|93563020|97263020|97267020|83808020|97261020|97265020|82618020|56954020|71915020|61005020|98046020|58072020|49647020|49646020|98645020|98677020|98643020|98661020|99027020|99029020|98667020|83878020|99281020|66470020|00607021|68269020|99915020|07139020|38575020|12117020|06703020|07136020|39537020|45388020|12101020|06732020|39313020|10276020|06706020|10827020|06723020|11364020|10277020|07137020|39510020|19534020|12114020|06645020|10085020|19536020|09173020|06805020|78182020|45387020|19530020|12544020|12919020|06804020|10274020|16437021|06712020|06806020|13453020|06715020|06795020)"
gen estro_hrt = 0
replace estro_hrt = 1 if regexm(gemscriptcode, "`estrocodes'")
label variable estro_hrt "Estrogen and HRT exposure: 0=no exp, 1=exp"

// Bisphosphonates
local bisphoscodes="(05082007|65596020|83491020|79887020|79892020|48967020|79888020|79890020|02601007|73223020|60929020|73228020|53960020|75311020|84577020|81229020|75310020|78500020|78501020|89704020|89702020|89628020|78504020|79891020|78505020|53962020|50698020|87560020|89630020|73225020|65599020|87638020|72499020|78759020|80254020|72493020|73230020|79137020|72494020|89698020|88546020|90662020|72498020|87562020|56503020|80252020|81282020|87640020|90656020|52028020|88574020|89692020|70265020|88578020|90941020|90943020|70663020|70372020|94358020|94360020|53961020|93731020|72240020|89696020|88576020|76576020|77562020|98983020|93417020|99747020|71778020|00449021|72522020|88580020|00451021|77853020|89694020|75123020|06938020|21642020|00117020|06910020|06933020|10655020|78023020|00129020|00132020|83825020|93153020|39385020|70693020|41397020|37962020|72611020|43733020|41988020|06932020|00116020|14635021|77868020|47653020|00130020)"
gen bisphos = 0 
replace bisphos = 1 if regexm(gemscriptcode, "`bisphoscodes'")
label variable bisphos "Bisphosphonate drug exposure: 0=no exp, 1=exp"

// Cytotoxic drugs
local cytocodes="(64781020|66215020|65514020|53956020|64502020|68902020|64503020|66214020|54769020|55594020|73821020|51111020|60270020|73817020|73820020|55593020|51094020|64427020|68933020|70724020|54768020|01800007|64857020|64858020|55127020|53861020|63769020|63770020|53957020|71153020|50594020|72273020|73815020|79789020|71147020|73816020|59035020|71152020|80748020|60698020|71148020|63321020|80749020|88052020|80756020|80747020|49857020|88054020|88050020|90127020|90125020|77574020|77575020|88058020|54767020|79638020|64508020|01799007|48575020|64506020|60699020|60952020|64440020|48147020|71149020|80466020|55226020|88634020|88060020|57944020|85625020|49235020|84845020|49040020|51354020|64039020|64380020|49253020|64507020|64511020|49338020|60881020|80468020|89948020|91526020|75231020|76400020|50595020|64788020|54841020|75228020|88056020|89946020|90129020|88048020|89940020|60702020|64379020|90161020|66231020|90131020|82648020|62016020|60461020|68893020|76401020|51600020|60953020|89962020|65421020|77834020|64780020|61740020|77833020|62021020|87500020|67097020|62022020|51043020|79558020|62982020|77138020|79971020|78254020|78245020|87708020|64512020|!4492101|70723020|60272020|64384020|79367020|80871020|50448020|54720020|60460020|73963020|90117020|91511020|65741020|76074020|89942020|84050020|89775020|83225020|89112020|48574020|53024020|87546020|75130020|91515020|54840020|54025020|70728020|60703020|65422020|54716020|54839020|03505007|64383020|67100020|75719020|48041020|75270020|62864020|62193020|59290020|65430020|57062020|68393020|64513020|91528020|91518020|48042020|!4492110|89936020|85654020|77136020|91259020|60280020|64882020|60809020|85677020|02238007|66234020|68894020|!7237101|87710020|82798020|80271020|73155020|88278020|55509020|77511020|64430020|84618020|51042020|77378020|60959020|54844020|53837020|72045020|89938020|52300020|62862020|90137020|78948020|60954020|52361020|49234020|73184020|64777020|82819020|60808020|73183020|60981020|68898020|89944020|64221020|70727020|77137020|77758020|65415020|90301020|88012020|89192020|64886020|91520020|87339020|82647020|84787020|64785020|88010020|84200020|91878020|60281020|69105020|69100020|80645020|77889020|86214020|80867020|91524020|77131020|84534020|88280020|89772020|79607020|59986020|69099020|50278020|55914020|52120020|60982020|88784020|77132020|91860020|91522020|91173020|92601020|89706020|92442020|91844020|91424020|91532020|92515020|92351020|91336020|86117020|93031020|62018020|68394020|86390020|93914020|93027020|93912020|92353020|75718020|91530020|92344020|88638020|60960020|83937020|93804020|60466020|93083020|94526020|85249020|70999020|89110020|93389020|64885020|94317020|95081020|94619020|75129020|93113020|02106021|02107021|02109021|02125021|02108021|02730021|02728021|02966021|91201020|93029020|79559020|04126021|91416020|91652020|91374020|91436020|91884020|91434020|91418020|95463020|90485020|82822020|04072021|96618020|68993020|95623020|91207020|90487020|96748020|96526020|96750020|89768020|93085020|91438020|97060020|97064020|97058020|97068020|97070020|97072020|97054020|97062020|97066020|97056020|86392020|96010020|91826020|91205020|92166020|65423020|87882020|80646020|91426020|91432020|92941020|02969021|95667020|97383020|91338020|74124020|06041021|92665020|91366020|87780020|52306020|84193020|84918020|91175020|93825020|96542020|95671020|91291020|91209020|08742021|08741021|87548020|08740021|63534020|08744021|08743021|98598020|60814020|95669020|97521020|84834020|69057020|91203020|98657020|81249020|49239020|49241020|98871020|86859020|93115020|98653020|89708020|72046020|99035020|87880020|91921020|99086020|91662020|94536020|91848020|99414020|98621020|91211020|99059020|99418020|99368020|92599020|11300021|99422020|97515020|11212021|99705020|99701020|99695020|99699020|99709020|99707020|00014021|00012021|92607020|97385020|00265021|98708020|95288020|96796020|88506020|00515021|00055021|00703021|91698020|95227020|61739020|92655020|11144021|98706020|89770020|99356020|68719020|98533020|91850020|99261020|98849020|59579020|77915020|94991020|93117020|91362020|10912020|13812021|13345021|12543021|07360020|13344021|44398020|40579020|44399020|44397020|44396020|13343021|28143020|09964020|12527021|09788020|13342021|09972020|99088020|07335020|41880020|07344020|20979020|41639020|41640020|36324020|07349020|07321020|41881020|36208020|32789020|10932020|07336020|91742020|07337020|07345020|45177020|45175020|75124020|45171020|36498020|31133020|77133020|91882020|99257020|84042020|54715020|60271020|98623020|97517020|20477020|92170020|14643021|74394020|00217021|14666021|41789020|98710020|93658020|09517020|41878020|43845020|92497020|99711020|41284020|47527020|20475020|31688020|74399020|20687020|31326020)"
gen cytotoxic = 0
replace cytotoxic = 1 if regexm(gemscriptcode, "`cytocodes'")
label variable cytotoxic "Cytotoxic drug exposure:0=no exp, 1=exp"

// Antiproliferative immunosuppressants
local aprolifcodes="(60180020|60179020|59745020|57632020|79631020|57633020|04846007|05308007|81063020|81062020|81064020|05921007|60183020|59746020|60187020|05309007|57791020|81058020|05582007|81059020|79834020|51132020|74880020|89785020|88334020|68752020|88338020|88336020|55140020|57634020|81060020|63298020|48821020|60241020|48820020|60240020|88332020|92301020|89877020|95803020|53510020|48816020|98325020|98323020|56840020|99231020|99225020|99229020|78624020|99223020|40586020|19176020|39317020|30683020|07488020|70152020|19068020|78454020|40585020|19070020|19038020|91513020|33382020|07489020)"
gen antiprolif = 0 
replace antiprolif = 1 if regexm(gemscriptcode, "`aprolifcodes'")
label variable antiprolif "Antiproliferative immunosuppresant exposure:0=no exp, 1=exp"

// Corticosteroids and other immunosuppressants
// none of these specific drugs are actually corticosteroids
local othimmsupcodes="(66163020|59234020|71488020|59233020|74386020|74677020|74679020|61707020|79478020|66162020|69118020|61708020|76184020|51272020|61709020|55046020|74678020|76185020|53820020|80656020|80658020|78003020|53819020|81355020|76186020|78762020|79329020|86910020|66172020|51273020|55044020|52332020|52333020|69119020|79479020|54091020|61726020|87866020|02776007|61712020|78645020|83660020|50409020|78765020|55045020|!1571501|50410020|81459020|50400020|!1571502|54231020|78890020|50401020|51719020|76232020|78648020|54227020|50399020|50408020|57098020|65523020|54228020|65526020|51718020|88786020|93759020|87013020|93753020|92945020|93751020|95005020|93761020|93755020|93757020|92259020|96010020|79683020|97217020|97215020|55527020|64355020|97774020|97776020|97772020|95069020|92947020|98098020|98096020|98745020|98743020|98927020|98741020|98935020|98106020|98108020|99164020|99168020|77102020|00116021|99162020|00118021|99614020|99612020|00372021|77095020|00371021|00521021|00114021|00373021|00611021|00609021|00613021|07467020|07447020|07440020|07455020|35995020|07441020|07465020|07476020|06607020|07477020|07444020|44422020|07462020|07439020|39875020|33911020|06634020|21468020|35062020|33915020|44423020|07466020|33907020|44424020|46810020|46809020|99616020|46229020|34075020|20817020|46808020|06621020|47496020)"
gen otherimmunosuppress = 0
replace otherimmunosuppress = 1 if regexm(gemscriptcode, "`othimmsupcodes'")
label variable otherimmunosuppress "Corticosteroids and other immunosuppresant exposure:0=no exp, 1=exp"

// Antilymphocyte monoclonal antibodies
local lymphmabcodes="(89371020|89375020|79926020|89377020)"
gen antilymph_mab = 0
replace antilymph_mab =1 if regexm(gemscriptcode, "`lymphmabcodes'")
label variable antilymph_mab "Antilymphocyte monoclonal antibody exposure:0=no exp, 1=exp"

// Other immunomodulating drugs
local othimmcodes="(79493020|88426020|84237020|84238020|71260020|59666020|59667020|59671020|63589020|63583020|80023020|80027020|63594020|80013020|84636020|80021020|78968020|79466020|63588020|80425020|80403020|63573020|80426020|78967020|83291020|63574020|80427020|80026020|71265020|63580020|84630020|80018020|63590020|56550020|80019020|79457020|84241020|86562020|78966020|63585020|83893020|84240020|83289020|80017020|80025020|84242020|79454020|79453020|87165020|80015020|59668020|71261020|83676020|80400020|63575020|84236020|80844020|57818020|83891020|79264020|59672020|63595020|71268020|79452020|78738020|83677020|88020020|86172020|86847020|80022020|04149007|80014020|58128020|87163020|86854020|86855020|91137020|93515020|84718020|86848020|55268020|92907020|86173020|92919020|91135020|93007020|79456020|97951020|68736020|68737020|93009020|98539020|97926020|93011020|97957020|00186021|00122021|28093020|10887020|99723020|99965020|65292020|97953020|10886020|68843020|96945020|93017020|98537020|99725020)"
gen otherimmunomodul = 0
replace otherimmunomodul = 1 if regexm(gemscriptcode, "`othimmcodes'")
label variable otherimmunomodul "Other immunomodulating drug exposure:0=no exp, 1=exp"

// All drugs affecting the immune system
gen immunosuppress_all = 0
replace immunosuppress_all = 1 if antiprolif==1 | otherimmunosuppress==1 | antilymph_mab==1 | otherimmunomodul==1
label variable immunosuppress_all "Any immunosuppressant drug exposure:0=no exp, 1=exp"

// Oral iron
local ironcodes="(55961020|58901020|51228020|53752020|03759007|58744020|66613020|71020020|59344020|06698007|58057020|61848020|49469020|55534020|49442020|49468020|02566007|49463020|61843020|80772020|58587020|61853020|58590020|61842020|61882020|55965020|03760007|61887020|71038020|49095020|58058020|61849020|80773020|61888020|83024020|61854020|70792020|61889020|49094020|49454020|49093020|03761007|55962020|55531020|70788020|71017020|49449020|61860020|49508020|61844020|61878020|61862020|51231020|71624020|78336020|71026020|61852020|70785020|49446020|06259007|03343007|49513020|82962020|70793020|84594020|56244020|61861020|02578007|70796020|52288020|77339020|58907020|78391020|89092020|61892020|04082007|49415020|58053020|56248020|71023020|82542020|72393020|!2550101|82966020|61877020|56241020|81937020|89088020|58265020|81933020|58056020|58904020|77761020|02569007|52735020|02575007|70791020|49669020|02395007|88853020|02567007|68699020|80310020|90169020|02080007|83026020|61881020|70006020|49659020|02576007|71056020|52943020|88855020|49672020|56975020|70784020|02568007|77111020|49665020|61857020|61859020|55315020|60129020|52144020|90171020|95805020|96740020|96742020|74313020|88859020|55318020|51309020|62241020|61847020|56976020|99070020|99072020|77657020|00008021|00425021|00509021|66430020|35484020|71511020|99068020|37850020|37358020|44426020|45485020|19888020|07671020|07669020|19890020)"
gen iron_oral = 0
replace iron_oral = 1 if regexm(gemscriptcode, "`ironcodes'")
label variable iron_oral "Oral iron exposure: 0=no exp, 1=exp"

// Parenteral iron
local ironpcodes="(71697020|78939020|49920020|49380020|78864020|75967020|02394007|95304020|95298020|95079020|98921020|98915020|95296020|98923020|95077020|98925020|37914020|37915020)"
gen iron_parenteral = 0
replace iron_parenteral = 1 if regexm(gemscriptcode, "`ironpcodes'")
label variable iron_parenteral "Parenteral iron exposure: 0=no exp, 1=exp"

// Oral potassium
local potcodes="(02067007|66083020|49009020|51581020|50636020|67326020|50654020|66079020|52368020|51478020|66080020|59178020|49010020|55253020|61687020|48615020|86124020|81288020|56191020|66084020|66501020|56307020|70884020|64272020|84336020|70883020|73214020|80623020|50100020|49059020|56304020|62138020|49876020|70882020|70891020|52640020|66093020|81038020|48086020|50166020|72479020|79852020|70897020|86119020|79814020|77339020|58907020|78391020|67327020|70894020|62139020|60322020|74199020|56211020|48459020|02068007|72393020|75665020|73217020|59595020|48616020|78362020|71389020|85234020|79854020|72964020|48085020|79106020|52713020|82771020|05695007|81390020|82783020|72962020|78476020|66090020|59591020|71925020|81388020|70888020|83718020|72476020|82762020|78491020|80186020|78479020|77111020|70887020|93301020|52144020|93727020|49326020|82709020|89804020|95424020|96540020|97780020|97778020|97782020|97836020|50391020|97826020|97828020|97838020|97832020|97834020|97830020|72968020|92651020|99697020|00038021|70485020|00008021|00199021|21801020|43925020|12906020|21800020|12902020|14608020|15237020|21803020|13184020|12900020|00160021|13183020|13182020|28301020|17476020|62730020|15238020|86823020|10382020|28564020|07715020|13181020|61288020|12901020)"
gen potassium_oral = 0
replace potassium_oral = 1 if regexm(gemscriptcode, "`potcodes'")
label variable potassium_oral "Oral potassium exposure: 0=no exp, 1=exp"

// Multivitamins preparation
local multicodes="(73678020|56220020|54355020|50554020|71048020|69931020|69932020|59115020|53381020|50899020|68177020|50042020|53401020|71047020|75531020|73107020|52689020|83010020|52690020|83970020|54356020|76663020|73668020|87614020|83003020|82958020|90237020|90231020|53386020|76666020|78336020|71740020|48079020|82962020|59139020|77244020|83973020|50201020|79601020|84594020|84980020|79582020|72391020|79108020|69933020|70306020|82676020|77705020|78339020|77339020|58907020|78391020|76018020|80683020|53377020|56158020|73983020|50900020|04079007|55950020|56248020|82743020|83012020|72393020|71250020|73674020|69940020|82966020|88077020|81937020|58265020|81933020|74829020|50806020|79602020|82989020|79188020|69941020|49677020|84758020|77761020|!3864101|83522020|82590020|55949020|84585020|78893020|52239020|88729020|78327020|54497020|87872020|90235020|88853020|69951020|77770020|69954020|69942020|74835020|74840020|74832020|74821020|86148020|77816020|74826020|84352020|86780020|82582020|51967020|71056020|80734020|87399020|70303020|56263020|89626020|84760020|76221020|53635020|72392020|82162020|77111020|79141020|64136020|55477020|92319020|90229020|92328020|92937020|52144020|79998020|94063020|77767020|94453020|94431020|88376020|94528020|93349020|66082020|94061020|79215020|95881020|96245020|96463020|96453020|77144020|62439020|89624020|82991020|72388020|97914020|97916020|92631020|83971020|77732020|92931020|84986020|92326020|55933020|99118020|99214020|99396020|77657020|00008021|82999020|44139020|10370020|10364020|17689020|10378020|28105020|28107020|17683020|17700020|10368020|17550020|17549020|37063020|44137020|17914020|10374020|28109020|10363020|28106020|17958020|17680020|17681020|10376020|28110020|10367020|17960020|17701020|17690020|17695020|17678020|17688020|10366020|17699020|28108020|21074020|17687020|17674020|17676020|17684020|13228020|17694020|44588020|28111020|18488020|28401020|35543020|28098020|44900020|17957020|28174020|15892021|15726021|17530020|16455021|35172020|15902021|72386020)"
gen multivit = 0
replace multivit = 1 if regexm(gemscriptcode, "`multicodes'")
label variable multivit "Multivitamin exposure: 0=no exp, 1=exp"

// NSAIDS
local nsaidcodes= "(59355020|83872020|72458020|49932020|51186020|57759020|64941020|65858020|73806020|53290020|74346020|58913020|04856007|59793020|51182020|05256007|72459020|52789020|49419020|73771020|03721007|03184007|48494020|51745020|63883020|53037020|85651020|68366020|59354020|72775020|52256020|79023020|83709020|76045020|81068020|62515020|83822020|80144020|72769020|79362020|50464020|79361020|63502020|83871020|77851020|58922020|72315020|58914020|81659020|63501020|58923020|73809020|50924020|74754020|81638020|62456020|58918020|54426020|62455020|62173020|72737020|64945020|63545020|64364020|73893020|59356020|73892020|73894020|62460020|53288020|63162020|58915020|63884020|62462020|51187020|59638020|50928020|53289020|71645020|81615020|81639020|54429020|70327020|69511020|48493020|49933020|74349020|54315020|53998020|65859020|69012020|53294020|51746020|57763020|64363020|62457020|68365020|58924020|80094020|68000020|67974020|81614020|67923020|53285020|57757020|53293020|62062020|50009020|53298020|81620020|04699007|68349020|67624020|68109020|63546020|72463020|55305020|70323020|67057020|75877020|63503020|69512020|74065020|67651020|63544020|81649020|49559020|67393020|62061020|50923020|55307020|83823020|74401020|74064020|74066020|74060020|73682020|50929020|68350020|57767020|74400020|66832020|67332020|49420020|66527020|76044020|67330020|69415020|68387020|67331020|53301020|54001020|73681020|86342020|57758020|58036020|61813020|80722020|61812020|61814020|83774020|83710020|59577020|50465020|49999020|83756020|86753020|59639020|83744020|74350020|80143020|65860020|66530020|81598020|82739020|67445020|81597020|83742020|79024020|75111020|74184020|82738020|64942020|75114020|66833020|80145020|55413020|77854020|79969020|84667020|56854020|86622020|49560020|77279020|84678020|77845020|83599020|78651020|83707020|79155020|86542020|50135020|74128020|48703020|02704007|50136020|65708020|49561020|50134020|55306020|85652020|62461020|50925020|67056020|75820020|69513020|56329020|60933020|72460020|65863020|74549020|49421020|50466020|70324020|58038020|59640020|79017020|79620020|68435020|84244020|81066020|84230020|79166020|79359020|86796020|64365020|77848020|82072020|60934020|86472020|77261020|80061020|82435020|67975020|89560020|70001020|54744020|04147007|68265020|49425020|49934020|49424020|51960020|53757020|49459020|74361020|74364020|74803020|53295020|80723020|83741020|83762020|59563020|68001020|50157020|77606020|56853020|68069020|77460020|89572020|81650020|50221020|52982020|50920020|63885020|69420020|06103007|50919020|55563020|77459020|67966020|76062020|48091020|48704020|56667020|71737020|68267020|81658020|68266020|80104020|60823020|77456020|86201020|86203020|91245020|50220020|61806020|58464020|53445020|86401020|75883020|75884020|79162020|77350020|89758020|89756020|63549020|74183020|62436020|74182020|83568020|86566020|74267020|77485020|75904020|02579007|86199020|86399020|76065020|49832020|56328020|68112020|58037020|57190020|57191020|84262020|82238020|82237020|60242020|73719020|80210020|88558020|83537020|85935020|55714020|77273020|74061020|56330020|76698020|78919020|84868020|75159020|74794020|86585020|74793020|51288020|74336020|88935020|81617020|63553020|74781020|58456020|83511020|83740020|86224020|51959020|78164020|63550020|79839020|76985020|84269020|77276020|52497020|62435020|49833020|79274020|49025020|83888020|84313020|!0838201|!0838101|!4802101|!2511302|63156020|!2511103|67138020|83580020|67058020|81306020|66560020|85672020|62239020|60937020|85673020|83984020|78018020|84866020|74784020|!1857105|!5677102|!5677103|!4805101|!4405104|!5677104|85934020|82037020|56765020|77321020|59456020|74798020|50315020|60371020|89574020|89582020|74266020|80211020|74801020|59661020|59662020|!5214001|62437020|57370020|59663020|74802020|56666020|62238020|57369020|56770020|56769020|53056020|04985007|82951020|78062020|85582020|04842007|77482020|62235020|85828020|!4802102|56631020|82652020|!2511301|49915020|57155020|57154020|61701020|56925020|56926020|51193020|49854020|49913020|49914020|83889020|80560020|59011020|58460020|83390020|73716020|69422020|82497020|69417020|86353020|!5731101|!3442101|!4804104|89068020|83095020|73898020|79838020|82982020|86551020|86553020|78548020|86198020|57275020|05801007|73683020|51747020|74337020|57373020|05834007|68882020|56702020|55616020|58461020|90473020|70694020|51194020|74759020|74758020|74809020|74811020|75358020|74810020|78353020|83497020|67137020|78063020|80903020|88560020|85826020|68245020|74757020|86742020|63521020|84317020|86798020|56927020|57207020|75926020|57001020|57327020|!5730101|!5213601|56735020|65701020|82987020|53365020|53949020|!7713301|!6853201|57639020|83270020|75901020|49079020|49462020|!4804105|75156020|53366020|73897020|88706020|75925020|75899020|59805020|79273020|84951020|57374020|75900020|84592020|53375020|90907020|81085020|91247020|91117020|86535020|86537020|51271020|62712020|65371020|68023020|84251020|50321020|!1857101|63506020|59451020|65709020|59460020|60159020|82614020|83613020|88340020|62234020|50930020|59264020|59231020|84738020|53953020|80085020|80086020|86821020|84507020|68883020|63157020|81084020|84841020|64059020|59698020|61530020|78461020|69421020|64563020|86166020|86902020|57645020|57638020|51195020|60595020|87660020|86741020|60370020|59110020|60044020|49865020|84318020|50000020|59898020|49834020|50008020|59804020|58455020|80610020|54079020|59966020|82149020|82148020|73886020|49461020|79375020|49864020|86005020|69320020|71142020|59471020|68901020|56630020|58999020|53674020|65712020|53376020|49855020|64641020|68415020|51185020|57010020|57305020|53793020|61923020|63505020|83372020|78352020|90475020|53791020|51270020|73699020|59891020|49856020|61924020|59232020|60405020|59490020|53361020|56266020|56114020|61922020|53852020|50007020|57304020|53792020|59965020|57812020|69005020|60066020|59491020|65869020|66405020|68074020|59135020|55428020|62386020|60413020|49089020|68904020|59877020|49088020|60065020|53364020|49829020|49994020|49995020|49827020|49075020|49074020|55454020|62843020|59472020|59136020|53948020|93625020|93690020|91953020|92493020|88962020|92346020|93654020|93688020|91115020|72118020|85863020|67043020|87664020|62430020|82132020|83343020|93686020|93922020|93924020|82155020|93812020|94243020|91330020|90157020|94475020|94524020|94522020|92349020|93920020|92571020|93916020|60589020|94477020|99075020|87860020|94368020|94433020|94741020|94245020|94471020|94461020|94811020|94663020|95557020|95565020|95549020|95551020|95891020|95555020|95831020|49087020|95883020|95833020|49080020|90397020|90563020|95773020|96624020|92142020|95573020|95779020|96610020|95907020|96546020|88937020|86647020|55793020|96905020|96903020|62183020|96897020|83096020|57817020|96899020|96455020|96907020|96608020|97642020|97648020|97646020|97644020|96901020|57811020|53370020|55455020|53369020|50329020|50328020|54332020|54331020|54078020|53950020|49850020|53374020|59423020|62385020|95785020|73414020|97700020|53591020|98118020|61462020|61088020|59298020|84356020|77025020|98188020|64064020|96457020|50320020|98663020|98003020|53955020|98747020|98805020|59004020|95783020|50314020|97369020|99218020|99013020|99220020|99372020|92541020|53954020|62429020|92261020|59470020|62584020|99265020|49828020|97483020|89638020|00014021|99120020|63631020|00124021|98700020|99460020|75583020|99382020|00130021|53592020|56131020|60160020|59918020|55366020|59436020|60540020|00836021|89317020|00059021|66615020|00164021|75578020|77150020|78798020|69693020|94572020|68817020|75930020|00629021|08170020|08156020|14177020|14108020|08148020|08561020|08174020|08229020|77023020|08090020|08547020|08180020|08183020|08143020|08177020|08541020|08544020|08086020|08520020|39329020|08136020|08107020|08169020|39887020|08553020|14181020|08379020|08149020|08173020|09208020|40590020|08524020|08377020|08539020|08251020|10595020|08380020|40591020|39330020|08246020|08135020|14178020|29485020|08236020|08175020|08242020|39400020|73819020|08172020|09769020|59007020|67026020|08542020|08378020|08049020|08519020|08184020|08117020|08265020|08545020|68114020|08171020|08375020|08092020|38583020|10607020|09766020|78855020|08266020|08258020|09767020|08247020|08069020|08091020|68820020|57065020|54642020|40594020|46754020|08079020|92313020|53359020|08549020|29442020|08167020|86649020|46755020|66410020|77645020|08154020|08249020|53360020|08259020|08512020|08270020|39886020|14564021|39403020|00061021|20550020|08145020|72217020|16362021|14184020|20548020|16363021|10596020|08555020|31715020|15708021|57064020|08075020|76223020|08084020|08146020|08093020|08234020|17125021|17127021|08552020|08537020)"
gen nsaid = 0
replace nsaid = 1 if regexm(gemscriptcode, "`nsaidcodes'")
label variable nsaid "NSAID exposure: 0=no exp, 1=exp"

// Systemic corticosteroids- not utilized

//Local corticosteroid injections
//since restricting to oral, none of these drugs are applicable as they are all injections
local cortinjcodes="(62323020|56601020|56622020|56267020|48031020|72505020|62352020|62335020|56264020|52005020|52004020|62322020|48027020|53188020|51595020|49867020|62356020|52917020|54009020|56623020|52916020|03818007|50024020|67172020|62327020|67171020|51596020|67851020|62321020|62123020|72502020|58859020|75320020|62340020|75321020|86370020|86708020|64586020|62345020|78879020|86688020|74790020|86417020|76355020|76457020|92071020|50153020|69573020|66172020|48034020|50154020|05095007|55104020|57978020|90819020|48028020|62329020|56838020|49862020|50911020|62328020|78876020|04867007|64583020|62344020|62343020|64582020|57986020|71641020|48035020|74787020|64579020|91318020|05093007|62119020|62118020|76455020|89887020|91302020|91320020|92107020|67195020|05094007|70607020|91308020|91322020|76038020|03817007|62122020|72923020|54091020|64578020|89889020|!1756101|62349020|92063020|78819020|06196007|56344020|58005020|53177020|91324020|54442020|56343020|86706020|57954020|05092007|!7243102|05807007|03421007|!1756108|72920020|!1796101|56347020|04317007|05806007|56573020|62332020|05096007|57987020|!1756301|!1756102|62124020|92109020|!0066101|54004020|71642020|54005020|67173020|02762007|61648020|92101020|61132020|51597020|55666020|53490020|53489020|92111020|92059020|92067020|92103020|92434020|91304020|92105020|74310020|92436020|56624020|92265020|96909020|06241007|93103020|91780020|98827020|98829020|72102020|11073020|06598020|06597020|06599020|12988020|06590020|13069020|13235020|06637020|06592020|13068020|09467020|06591020|09474020|19597020|14024020|72099020|95127020|09475020|13066020|21471020|29799020|06568020|13232020|19689020|29397020|09470020|14717021)"
gen cortico_inject = 0
replace cortico_inject = 1 if regexm(gemscriptcode, "`cortinjcodes'")
label variable cortico_inject "Corticosteroid (local inj) exposure:0=no exp, 1=exp"

// Antigout drugs
local goutcodes="(59735020|03930007|52350020|59734020|55954020|66218020|74888020|66815020|53508020|05143007|48333020|66814020|48178020|88998020|05144007|48177020|48562020|58338020|87758020|74889020|48380020|87760020|05877007|58335020|48561020|!8217101|48366020|88954020|56807020|53683020|48367020|49493020|49436020|60172020|48371020|60171020|48370020|55358020|48381020|53684020|56808020|48362020|97991020|97995020|97993020|97997020|60082020|60083020|48390020|97926020|55359020|60308020|18891020|18907020|18889020)"
gen antigout = 0 
replace antigout = 1 if regexm(gemscriptcode, "`goutcodes'")
label variable antigout "Antigout drug exposure: 0=no exp, 1=exp"

// Antirheumatic disease Drugs
local rheumcodes= "(61202020|65514020|60180020|50580020|04607007|66731020|83332020|58736020|63495020|60179020|61201020|61205020|66734020|86349020|59745020|65516020|65515020|57632020|63324020|79631020|64502020|64503020|74677020|74679020|83297020|61707020|57633020|79478020|69118020|61708020|66729020|50719020|50718020|50582020|48281020|49041020|50581020|66730020|61709020|05308007|55046020|66527020|05194007|74678020|83331020|66598020|54196020|76411020|76409020|58731020|66530020|83280020|86356020|87133020|76410020|90127020|90125020|68317020|64508020|05481007|64506020|05921007|49042020|48147020|58732020|61197020|66596020|83281020|49040020|60183020|64507020|81056020|59746020|58733020|64511020|55044020|52332020|65536020|89948020|91526020|60187020|76400020|77197020|77423020|06591007|54667020|83314020|05309007|52333020|77420020|69119020|79479020|89946020|76404020|90129020|89940020|66597020|76349020|90161020|05582007|76405020|90131020|02873007|83298020|76401020|76406020|89962020|79834020|87866020|89293020|02776007|61712020|51043020|57129020|62982020|64512020|!4492101|74880020|83203020|89785020|85675020|61209020|87139020|91511020|89942020|91515020|68752020|89291020|55045020|64513020|91528020|91518020|!4492110|89936020|!1571501|91259020|05728007|89371020|73155020|55140020|!1571502|91271020|51042020|57634020|89938020|52300020|57081020|90137020|52361020|63298020|57080020|60448020|50632020|83315020|57128020|48821020|60981020|89944020|80541020|91520020|91524020|58442020|54555020|69099020|60241020|60767020|52367020|48820020|60240020|58439020|60982020|92226020|91522020|92450020|92301020|92601020|91532020|92448020|91336020|89375020|92228020|80662020|89877020|93914020|93912020|91530020|92945020|95005020|79926020|95803020|92259020|52366020|97060020|97064020|97058020|97068020|97070020|97072020|97054020|97062020|97066020|97056020|92224020|91338020|74124020|97558020|52306020|53510020|48816020|50628020|97774020|97776020|97772020|92947020|98325020|98323020|56840020|97638020|97636020|71058020|66402020|99086020|98190020|99414020|99418020|99422020|99705020|99701020|99695020|99699020|99709020|99707020|97560020|99959020|99164020|92607020|99168020|77102020|00116021|99162020|00118021|77095020|99961020|00114021|89377020|99963020|00824021|77475020|61196020|94991020|77715020|07447020|29119020|07440020|07455020|34901020|37046020|35995020|07360020|28919020|40579020|07441020|29120020|36762020|99088020|10754020|28918020|07335020|19176020|07344020|07349020|07336020|07444020|44422020|10755020|08388020|30683020|66601020|07439020|39875020|07337020|41882020|07345020|70152020|19068020|78454020|21468020|08398020|44423020|08390020|08399020|08385020|44424020|46810020|46809020|19070020|46229020|46808020|47065020|08386020|19038020|91513020|74394020|39459020|38455020|08384020|00527020|97566020|38454020|99711020|47527020|60447020|74399020)"
gen antirheum = 0
replace antirheum = 1 if regexm(gemscriptcode, "`rheumcodes'")
label variable antirheum "Antirheumatic drug exposure: 0=no exp, 1=exp"

// Benzodiazepine
local benzocodes="(68342020|58980020|58981020|64057020|68341020|66877020|52141020|58993020|58982020|52730020|68343020|49185020|49186020|58994020|58986020|52129020|66878020|52140020|62418020|64759020|62878020|62417020|59078020|62426020|52130020|57880020|02708007|83533020|62427020|53869020|64758020|64760020|62425020|87259020|91390020|91378020|48240020|70449020|66879020|03804007|62422020|62421020|57881020|73176020|02707007|75305020|62416020|79693020|75306020|90715020|87261020|52131020|05776007|72955020|53868020|02706007|48244020|75134020|75133020|50769020|73178020|75307020|89956020|91386020|91384020|72300020|06916007|48956020|02320007|58226020|62879020|58513020|52117020|79529020|48245020|49187020|52122020|02709007|52121020|73169020|52136020|73180020|49507020|58514020|50770020|72297020|05777007|73177020|!7041305|76152020|61832020|!1845109|!7040901|!4554601|91392020|56161020|06912007|49515020|52135020|59073020|52633020|61793020|52125020|50701020|54008020|!8501967|74982020|49505020|73171020|53786020|51936020|53466020|62963020|59082020|50645020|50702020|49520020|58806020|54007020|55423020|53465020|65787020|50859020|53333020|64045020|61795020|53646020|53334020|59161020|56921020|62837020|59162020|53467020|64048020|49521020|63139020|49516020|63033020|49506020|49456020|49457020|91382020|50646020|71875020|48237020|61571020|49359020|91394020|94513020|94516020|91380020|68864020|50687020|50688020|51443020|66962020|55860020|53651020|53335020|49522020|50696020|53471020|50860020|50695020|94599020|71710020|51444020|93533020|98937020|63587020|61794020|65974020|57123020|61199020|68615020|99570020|99438020|74808020|99572020|61200020|00305021|00303021|00309021|00311021|00301021|00445021|63141020|56303020|57124020|63140020|00307021|37194020|37196020|37195020|39486020|38820020|44357020|66824020|28378020|37199020|20867020|44114020|05159020|44360020|38438020|36901020|37936020|44113020|10229020|20871020|93367020|44359020|63597020|44358020|44356020|74527020|39271020|75741020|20432020|14501021|46781020|14741021|74813020|73607020|47229020)"
gen benzo = 0
replace benzo = 1 if regexm(gemscriptcode, "`benzocodes'")
label variable benzo "Benzodiazepine exposure: 0=no exp, 1=exp" 

// Opioid analgesics
local optwocodes="(61829020|76085020|76080020|76086020|76090020|76081020|76092020|76082020|77203020|77204020|76087020|88867020|88869020|89905020|88871020|76095020|76091020|89907020|81733020|88873020|77205020|02583007|89644020|81734020|89642020|67430020|61832020|67429020|80288020|61836020|81735020|81739020|81737020|89646020|67433020|81738020|89640020|67435020|92117020|92172020|92119020|92585020|92593020|92174020|92587020|94112020|94499020|94493020|94495020|92583020|94501020|94639020|94469020|94503020|84928020|94507020|92589020|94497020|92176020|94509020|94643020|94505020|94637020|96297020|96309020|96299020|96369020|96379020|96311020|96319020|96381020|96315020|96371020|96303020|96383020|67434020|96385020|96317020|96373020|96301020|96387020|97501020|94641020|96313020|96305020|96760020|96307020|96375020|96758020|96730020|96726020|97509020|96728020|97131020|97511020|92178020|92123020|97525020|96756020|97505020|98963020|96732020|96754020|97507020|97503020|98965020|96377020|00229021|00233021|00235021|00237021|00231021|72774020|98961020|73996020|09330020|21754020|21756020|09327020|09349020|71753020|09345020|15595021|09325020)"
gen opioid2 = 0
replace opioid2 = 1 if regexm(gemscriptcode, "`optwocodes'")
label variable opioid2 "Opioid analgesic (anaes) exposure: 0=no exp, 1=exp"

// Any opioid (from CNS-4.7.2 and anaesthesia-15.1.4.3 sections)
gen opioid = 0 
replace opioid = 1 if opioid1==1|opioid2==1
label variable opioid "any opioid exposure: 0=no exp, 1=exp"

// Any oral corticosteroid (from GI-1.5.2 and endocrine-6.3 sections)
gen cortico_oral = 0
replace cortico_oral = 1 if cortico_gi==1|cortico_endocr==1
label variable cortico_oral "any oral corticosteroid exposure: 0=no exp, 1=exp"

// Loops to restrict to exposure one year prior to cohortentrydate, indexdate and studyentrydate. Be sure to use var_c, var_i and var_s when using these binary variables in analysis!!!

			foreach x of varlist h2recep ppi cortico_gi thiazdiur loopdiur potsparediur_aldos potsparediur_other antiarrhythmic betablock            /// 
					acei angiotensin2recepant renini ras nitrates calchan anticoag_oral antiplat statin fibrates ezetimibe bileacidseq      ///
					lipidreg bronchodil cortico_inh leukotri antihist hyp_anx psychoses antidepress antiobes opioid1 antiepilep antipark_dop ///
					penicillin ceph_carb_betalac tetracyc aminoglyc macrolide clinda otherantibiot sulfo_trimeth antituberc antileprotic     ///
					metro_tinidazole quinolone uti_drugs antibacterial antifungal antiviral antiprotoz anthelmintic thyroidhorm cortico_endocr ///
					estro_hrt bisphos cytotoxic antiprolif otherimmunosuppress antilymph_mab otherimmunomodul immunosuppress_all iron_oral     ///
					iron_parenteral potassium_oral multivit nsaid antigout antirheum benzo opioid2 opioid cortico_oral {             
			generate `x'_c = 0										
			replace `x'_c = 1 if `x'==1 & rxdate2>=cohortentrydate-365 & rxdate2<cohortentrydate
			}

			foreach y of varlist h2recep ppi cortico_gi thiazdiur loopdiur potsparediur_aldos potsparediur_other antiarrhythmic betablock            /// 
					acei angiotensin2recepant renini ras nitrates calchan anticoag_oral antiplat statin fibrates ezetimibe bileacidseq      ///
					lipidreg bronchodil cortico_inh leukotri antihist hyp_anx psychoses antidepress antiobes opioid1 antiepilep antipark_dop ///
					penicillin ceph_carb_betalac tetracyc aminoglyc macrolide clinda otherantibiot sulfo_trimeth antituberc antileprotic     ///
					metro_tinidazole quinolone uti_drugs antibacterial antifungal antiviral antiprotoz anthelmintic thyroidhorm cortico_endocr ///
					estro_hrt bisphos cytotoxic antiprolif otherimmunosuppress antilymph_mab otherimmunomodul immunosuppress_all iron_oral     ///
					iron_parenteral potassium_oral multivit nsaid antigout antirheum benzo opioid2 opioid cortico_oral {             
			generate `y'_i = 0										
			replace `y'_i = 1 if `y'==1 & rxdate2>=indexdate-365 & rxdate2<indexdate
			}

			foreach z of varlist h2recep ppi cortico_gi thiazdiur loopdiur potsparediur_aldos potsparediur_other antiarrhythmic betablock            /// 
					acei angiotensin2recepant renini ras nitrates calchan anticoag_oral antiplat statin fibrates ezetimibe bileacidseq      ///
					lipidreg bronchodil cortico_inh leukotri antihist hyp_anx psychoses antidepress antiobes opioid1 antiepilep antipark_dop ///
					penicillin ceph_carb_betalac tetracyc aminoglyc macrolide clinda otherantibiot sulfo_trimeth antituberc antileprotic     ///
					metro_tinidazole quinolone uti_drugs antibacterial antifungal antiviral antiprotoz anthelmintic thyroidhorm cortico_endocr ///
					estro_hrt bisphos cytotoxic antiprolif otherimmunosuppress antilymph_mab otherimmunomodul immunosuppress_all iron_oral     ///
					iron_parenteral potassium_oral multivit nsaid antigout antirheum benzo opioid2 opioid cortico_oral {             
			generate `z'_s = 0										
			replace `z'_s = 1 if `z'==1 & rxdate2>=studyentrydate_cprd2-365 & rxdate2<studyentrydate_cprd2
			}

			
////// #7 Generate continuous variable for number of unique drugs for one year prior to study entry date, cohort entry date and index date.

encode prod_bnfcode, gen(prod_bnfcode2)
sort patid prod_bnfcode2 rxdate2
by patid prod_bnfcode2: generate num = _n
by patid: egen drugnum_un = count(prod_bnfcode2) if num==1 

by patid: egen drugnum_un_c_temp = count(prod_bnfcode2) if num==1 & rxdate2>=cohortentrydate-365 & rxdate2<cohortentrydate
by patid: egen drug_num_un_c = min(drugnum_un_c_temp)
drop drugnum_un_c_temp

by patid: egen drugnum_un_i_temp = count(prod_bnfcode2) if num==1 & rxdate2>=indexdate-365 & rxdate2<indexdate
by patid: egen drug_num_un_i = min(drugnum_un_i_temp)
drop drugnum_un_i_temp

by patid: egen drugnum_un_s_temp = count(prod_bnfcode2) if num==1 & rxdate2>=studyentrydate_cprd2-365 & rxdate2<studyentrydate_cprd2
by patid: egen drug_num_un_s = min(drugnum_un_s_temp)
drop drugnum_un_s_temp

////// #8 Calculate duration, gaps and stop dates of antidiabetic meds
// Generate duration of exposure (dur) and duration of exposure corrected for non-adherence (dur_c) variables
//***********NEED TO ADDRESS THIS****************** 
***time dependent confounding***
/*replace ndd = 1 if ndd==0
replace ndd = 1 if ndd==.
replace qty = 84 if qty==0
replace qty = 84 if qty==.*/

sort patid prod_bnfcode2 rxdate2

gen dur = .
//replace dur=qty/ndd
gen dur_c =dur*1.5 if dur <.
replace dur_c =90 if dur_c >.

// Generate first date of rx for antidiabetic medication
gen rxdate2_first = studyentrydate
format rxdate2_first %td

// Generate date for next expected rx
gen rxdate2_pred = rxdate2+dur_c 
format rxdate2_pred %td

// Generate date for next rx based on lead variable
by patid prod_bnfcode2: gen rxdate2_next = rxdate2[_n+1]
format rxdate2_next %td

// Generate gap dates for antidiabetic medications
gen gap = rxdate2_pred-rxdate2_next if (metformin==1|insulin==1|sulfonylurea==1|tzd==1|dpp==1|glp==1|otherantidiab==1) 

// Generate stop dates for antidiabetic medications based on duration of exposure and gap dates
gen rxdate2_stop = rxdate2_pred if (gap<0|gap==.) & (metformin==1|insulin==1|sulfonylurea==1|tzd==1|dpp==1|glp==1|otherantidiab==1)
format rxdate2_stop %td

// Generate final rx date and final exposure date for antidiabetic medications 
by patid prod_bnfcode2 : egen rxdate2_last_temp = max(rxdate2) if metformin==1|insulin==1|sulfonylurea==1|tzd==1|dpp==1|glp==1|otherantidiab==1
format rxdate2_last_temp %td
by patid prod_bnfcode2 : egen rxdate2_last= max(rxdate2_last_temp)
format rxdate2_last %td 
drop rxdate2_last_temp

gen rxdate2_last_pred = rxdate2_last + dur_c
format rxdate2_last_pred %td

//////	#9 Generate continuous variable for medication adherence and binary variable (0=MPR<0.8; 1=MPR>=0.8)
// MPR = days supply (dur) / days in year before date of interest after first rx
// Have to generate top and bottom values of ratio to calculate MPR.
// for index date
sort patid prod_bnfcode2 rxdate2

by patid prod_bnfcode2: egen mpr_start_i = min(rxdate2) if rxdate2>=indexdate-365 & rxdate2<indexdate
format mpr_start_i %td
gen mpr_dur_i = indexdate - mpr_start_i

by patid prod_bnfcode2: egen mpr_top_i = sum(dur) if rxdate2>=indexdate-365 & rxdate2<indexdate

gen mpr_i = mpr_top_i/mpr_dur_i
label variable mpr_i "MPR for year prior to index date"

gen mpr_i_b =.
replace mpr_i_b = 0 if mpr_i<0.8
replace mpr_i_b = 1 if mpr_i>=0.8 & !missing(mpr_i)
label variable mpr_i_b "MPR-indexdate (binary) 0=<0.8, 1=>=0.8"

by patid: egen avg_mpr_i = mean(mpr_i) if rxdate2>=indexdate-365 & rxdate2<indexdate
label variable avg_mpr_i "Average MPR-index date" 
 
gen avg_mpr_i_b=.
replace avg_mpr_i_b = 0 if avg_mpr_i<0.8
replace avg_mpr_i_b = 1 if avg_mpr_i>=0.8 & !missing(mpr_i)
label variable avg_mpr_i_b " Avg MPR prior to index date (binary) 0=<0.8, 1=>=0.8"

//for cohort entry date
sort patid prod_bnfcode2 rxdate2
by patid prod_bnfcode2: egen mpr_start_c = min(rxdate2) if rxdate2>=cohortentrydate-365 & rxdate2<cohortentrydate
format mpr_start_c %td
gen mpr_dur_c = cohortentrydate - mpr_start_c

by patid prod_bnfcode2: egen mpr_top_c = sum(dur) if rxdate2>=cohortentrydate-365 & rxdate2<cohortentrydate

gen mpr_c = mpr_top_c/mpr_dur_c
label variable mpr_c "MPR for year prior to cohort entry date"

gen mpr_c_b =.
replace mpr_c_b = 0 if mpr_c<0.8
replace mpr_c_b = 1 if mpr_c>=0.8 & !missing(mpr_c)
label variable mpr_c_b "MPR-cohortentry (binary) 0=<0.8, 1=>=0.8"

by patid: egen avg_mpr_c = mean(mpr_c) if rxdate2>=cohortentrydate-365 & rxdate2<cohortentrydate 
label variable avg_mpr_c "Average MPR-cohortentry" 

gen avg_mpr_c_b=.
replace avg_mpr_c_b = 0 if avg_mpr_c<0.8
replace avg_mpr_c_b = 1 if avg_mpr_c>=0.8 & !missing(mpr_c)
label variable avg_mpr_c_b " Avg MPR prior to cohort entry date (binary) 0=<0.8, 1=>=0.8"

//for study entry date
sort patid prod_bnfcode2 rxdate2
by patid prod_bnfcode2: egen mpr_start_s = min(rxdate2) if rxdate2>=studyentrydate_cprd2-365 & rxdate2<studyentrydate_cprd2
format mpr_start_s %td
gen mpr_dur_s = cohortentrydate - mpr_start_s

by patid prod_bnfcode2: egen mpr_top_s = sum(dur) if rxdate2>=studyentrydate_cprd2-365 & rxdate2<studyentrydate_cprd2

gen mpr_s = mpr_top_s/mpr_dur_s
label variable mpr_s "MPR for year prior to study entry date"

gen mpr_s_b =.
replace mpr_s_b = 0 if mpr_s<0.8
replace mpr_s_b = 1 if mpr_s>=0.8 & !missing(mpr_s)
label variable mpr_s_b "MPR-studyentry (binary) 0=<0.8, 1=>=0.8"

by patid: egen avg_mpr_s = mean(mpr_s) if rxdate2>=studyentrydate_cprd2-365 & rxdate2<studyentrydate_cprd2
label variable avg_mpr_s "Average MPR-studyentry" 

gen avg_mpr_s_b=.
replace avg_mpr_s_b = 0 if avg_mpr_s<0.8
replace avg_mpr_s_b = 1 if avg_mpr_s>=0.8 & !missing(mpr_s)
label variable avg_mpr_s_b " Avg MPR prior to study entry date (binary) 0=<0.8, 1=>=0.8"
	
collapse (max) rxdate2 studyentrydate_cprd2 group_cut insulins_short insulins_intlong insulin sulfonylurea metformin tzd ///
				dpp glp otherantidiab exenatide liraglutide lixisenatide glp_combo alogliptin linagliptin sitagliptin saxagliptin ///
				vildagliptin dpp_combo ins_sub aspart glulisine lispro degludec detemir glargine ins_zinc isophane_ins protamine_zinc_ins ///
				aspart_biphasic lispro_biphasic isophane_biphasic insulin_rapid insulin_regular insulin_int_long insulin_ultralong ///
				insulin_premixed insulin_combo metcohort other everother maincohort studyentry everstudyentry met_startdate cohortentrydate ///
				other_startdate indexdate studyentrydate h2recep ppi cortico_gi thiazdiur loopdiur potsparediur_aldos potsparediur_other ///
				antiarrhythmic betablock acei angiotensin2recepant renini ras nitrates calchan anticoag_oral antiplat statin fibrates ezetimibe ///
				bileacidseq lipidreg bronchodil cortico_inh leukotri antihist hyp_anx psychoses antidepress antiobes opioid1 antiepilep ///
				antipark_dop penicillin ceph_carb_betalac tetracyc aminoglyc macrolide clinda otherantibiot sulfo_trimeth antituberc antileprotic ///
				metro_tinidazole quinolone uti_drugs antibacterial antifungal antiviral antiprotoz anthelmintic thyroidhorm cortico_endocr ///
				estro_hrt bisphos cytotoxic antiprolif otherimmunosuppress antilymph_mab otherimmunomodul immunosuppress_all iron_oral ///
				iron_parenteral potassium_oral multivit nsaid antigout antirheum benzo opioid2 opioid cortico_oral h2recep_c ppi_c cortico_gi_c ///
				thiazdiur_c loopdiur_c potsparediur_aldos_c potsparediur_other_c antiarrhythmic_c betablock_c acei_c angiotensin2recepant_c renini_c ///
				ras_c nitrates_c calchan_c anticoag_oral_c antiplat_c statin_c fibrates_c ezetimibe_c bileacidseq_c lipidreg_c bronchodil_c ///
				cortico_inh_c leukotri_c antihist_c hyp_anx_c psychoses_c antidepress_c antiobes_c opioid1_c antiepilep_c antipark_dop_c penicillin_c ///
				ceph_carb_betalac_c tetracyc_c aminoglyc_c macrolide_c clinda_c otherantibiot_c sulfo_trimeth_c antituberc_c antileprotic_c ///
				metro_tinidazole_c quinolone_c uti_drugs_c antibacterial_c antifungal_c antiviral_c antiprotoz_c anthelmintic_c thyroidhorm_c ///
				cortico_endocr_c estro_hrt_c bisphos_c cytotoxic_c antiprolif_c otherimmunosuppress_c antilymph_mab_c otherimmunomodul_c ///
				immunosuppress_all_c iron_oral_c iron_parenteral_c potassium_oral_c multivit_c nsaid_c antigout_c antirheum_c benzo_c opioid2_c ///
				opioid_c cortico_oral_c h2recep_i ppi_i cortico_gi_i thiazdiur_i loopdiur_i potsparediur_aldos_i potsparediur_other_i antiarrhythmic_i ///
				betablock_i acei_i angiotensin2recepant_i renini_i ras_i nitrates_i calchan_i anticoag_oral_i antiplat_i statin_i fibrates_i ezetimibe_i ///
				bileacidseq_i lipidreg_i bronchodil_i cortico_inh_i leukotri_i antihist_i hyp_anx_i psychoses_i antidepress_i antiobes_i opioid1_i ///
				antiepilep_i antipark_dop_i penicillin_i ceph_carb_betalac_i tetracyc_i aminoglyc_i macrolide_i clinda_i otherantibiot_i sulfo_trimeth_i ///
				antituberc_i antileprotic_i metro_tinidazole_i quinolone_i uti_drugs_i antibacterial_i antifungal_i antiviral_i antiprotoz_i ///
				anthelmintic_i thyroidhorm_i cortico_endocr_i estro_hrt_i bisphos_i cytotoxic_i antiprolif_i otherimmunosuppress_i antilymph_mab_i ///
				otherimmunomodul_i immunosuppress_all_i iron_oral_i iron_parenteral_i potassium_oral_i multivit_i nsaid_i antigout_i antirheum_i benzo_i ///
				opioid2_i opioid_i cortico_oral_i h2recep_s ppi_s cortico_gi_s thiazdiur_s loopdiur_s potsparediur_aldos_s potsparediur_other_s ///
				antiarrhythmic_s betablock_s acei_s angiotensin2recepant_s renini_s ras_s nitrates_s calchan_s anticoag_oral_s antiplat_s statin_s ///
				fibrates_s ezetimibe_s bileacidseq_s lipidreg_s bronchodil_s cortico_inh_s leukotri_s antihist_s hyp_anx_s psychoses_s antidepress_s ///
				antiobes_s opioid1_s antiepilep_s antipark_dop_s penicillin_s ceph_carb_betalac_s tetracyc_s aminoglyc_s macrolide_s clinda_s ///
				otherantibiot_s sulfo_trimeth_s antituberc_s antileprotic_s metro_tinidazole_s quinolone_s uti_drugs_s antibacterial_s antifungal_s ///
				antiviral_s antiprotoz_s anthelmintic_s thyroidhorm_s cortico_endocr_s estro_hrt_s bisphos_s cytotoxic_s antiprolif_s ///
				otherimmunosuppress_s antilymph_mab_s otherimmunomodul_s immunosuppress_all_s iron_oral_s iron_parenteral_s potassium_oral_s multivit_s ///
				nsaid_s antigout_s antirheum_s benzo_s opioid2_s opioid_s cortico_oral_s prod_bnfcode2 num drugnum_un drug_num_un_c drug_num_un_i ///
				drug_num_un_s dur dur_c rxdate2_first rxdate2_pred rxdate2_next gap rxdate2_stop rxdate2_last rxdate2_last_pred mpr_start_i mpr_dur_i ///
				mpr_top_i mpr_i mpr_i_b avg_mpr_i avg_mpr_i_b mpr_start_c mpr_dur_c mpr_top_c mpr_c mpr_c_b avg_mpr_c avg_mpr_c_b mpr_start_s mpr_dur_s ///
				mpr_top_s mpr_s mpr_s_b avg_mpr_s avg_mpr_s_b, by(patid)
compress
//set local macros for the unique drug lists of interest
local rxlist = "insulins_short insulins_intlong insulin sulfonylurea metformin tzd dpp glp otherantidiab exenatide liraglutide lixisenatide glp_combo alogliptin linagliptin sitagliptin saxagliptin vildagliptin dpp_combo ins_sub aspart glulisine lispro degludec detemir glargine ins_zinc isophane_ins protamine_zinc_ins aspart_biphasic lispro_biphasic isophane_biphasic insulin_rapid insulin_regular insulin_int_long insulin_ultralong insulin_premixed insulin_combo metcohort other everother maincohort studyentry everstudyentry met_startdate cohortentrydate other_startdate indexdate studyentrydate h2recep ppi cortico_gi thiazdiur loopdiur potsparediur_aldos potsparediur_other antiarrhythmic betablock acei angiotensin2recepant renini ras nitrates calchan anticoag_oral antiplat statin fibrates ezetimibe bileacidseq lipidreg bronchodil cortico_inh leukotri antihist hyp_anx psychoses antidepress antiobes opioid1 antiepilep antipark_dop penicillin ceph_carb_betalac tetracyc aminoglyc macrolide clinda otherantibiot sulfo_trimeth antituberc antileprotic metro_tinidazole quinolone uti_drugs antibacterial antifungal antiviral antiprotoz anthelmintic thyroidhorm cortico_endocr estro_hrt bisphos cytotoxic antiprolif otherimmunosuppress antilymph_mab otherimmunomodul immunosuppress_all iron_oral iron_parenteral potassium_oral multivit nsaid antigout antirheum benzo opioid2 opioid cortico_oral"
local rxlistc = "h2recep_c ppi_c cortico_gi_c thiazdiur_c loopdiur_c potsparediur_aldos_c potsparediur_other_c antiarrhythmic_c betablock_c acei_c angiotensin2recepant_c renini_c ras_c nitrates_c calchan_c anticoag_oral_c antiplat_c statin_c fibrates_c ezetimibe_c bileacidseq_c lipidreg_c bronchodil_c cortico_inh_c leukotri_c antihist_c hyp_anx_c psychoses_c antidepress_c antiobes_c opioid1_c antiepilep_c antipark_dop_c penicillin_c ceph_carb_betalac_c tetracyc_c aminoglyc_c macrolide_c clinda_c otherantibiot_c sulfo_trimeth_c antituberc_c antileprotic_c metro_tinidazole_c quinolone_c uti_drugs_c antibacterial_c antifungal_c antiviral_c antiprotoz_c anthelmintic_c thyroidhorm_c cortico_endocr_c estro_hrt_c bisphos_c cytotoxic_c antiprolif_c otherimmunosuppress_c antilymph_mab_c otherimmunomodul_c immunosuppress_all_c iron_oral_c iron_parenteral_c potassium_oral_c multivit_c nsaid_c antigout_c antirheum_c benzo_c opioid2_c opioid_c cortico_oral_c"
local rxlisti = "h2recep_i ppi_i cortico_gi_i thiazdiur_i loopdiur_i potsparediur_aldos_i potsparediur_other_i antiarrhythmic_i betablock_i acei_i angiotensin2recepant_i renini_i ras_i nitrates_i calchan_i anticoag_oral_i antiplat_i statin_i fibrates_i ezetimibe_i bileacidseq_i lipidreg_i bronchodil_i cortico_inh_i leukotri_i antihist_i hyp_anx_i psychoses_i antidepress_i antiobes_i opioid1_i antiepilep_i antipark_dop_i penicillin_i ceph_carb_betalac_i tetracyc_i aminoglyc_i macrolide_i clinda_i otherantibiot_i sulfo_trimeth_i antituberc_i antileprotic_i metro_tinidazole_i quinolone_i uti_drugs_i antibacterial_i antifungal_i antiviral_i antiprotoz_i anthelmintic_i thyroidhorm_i cortico_endocr_i estro_hrt_i bisphos_i cytotoxic_i antiprolif_i otherimmunosuppress_i antilymph_mab_i otherimmunomodul_i immunosuppress_all_i iron_oral_i iron_parenteral_i potassium_oral_i multivit_i nsaid_i antigout_i antirheum_i benzo_i opioid2_i opioid_i cortico_oral_i"
local rxlists = "h2recep_s ppi_s cortico_gi_s thiazdiur_s loopdiur_s potsparediur_aldos_s potsparediur_other_s antiarrhythmic_s betablock_s acei_s angiotensin2recepant_s renini_s ras_s nitrates_s calchan_s anticoag_oral_s antiplat_s statin_s fibrates_s ezetimibe_s bileacidseq_s lipidreg_s bronchodil_s cortico_inh_s leukotri_s antihist_s hyp_anx_s psychoses_s antidepress_s antiobes_s opioid1_s antiepilep_s antipark_dop_s penicillin_s ceph_carb_betalac_s tetracyc_s aminoglyc_s macrolide_s clinda_s otherantibiot_s sulfo_trimeth_s antituberc_s antileprotic_s metro_tinidazole_s quinolone_s uti_drugs_s antibacterial_s antifungal_s antiviral_s antiprotoz_s anthelmintic_s thyroidhorm_s cortico_endocr_s estro_hrt_s bisphos_s cytotoxic_s antiprolif_s otherimmunosuppress_s antilymph_mab_s otherimmunomodul_s immunosuppress_all_s iron_oral_s iron_parenteral_s potassium_oral_s multivit_s nsaid_s antigout_s antirheum_s benzo_s opioid2_s opioid_s cortico_oral_s"

//generate the variables for the unique drug windows
egen unqrx= anycount(`rxlist'), values(1)
label var unqrx "Total number of unique drugs"
egen unqrxc= anycount(`rxlistc'), values(1)
label var unqrxc "Total number of unique drugs in the year prior to cohort entry date"
egen unqrxi= anycount(`rxlisti'), values(1)
label var unqrxi "Total number of unique drugs in the year prior to index date"
egen unqrxs= anycount(`rxlists'), values(1)
label var unqrxs "Total number of unique drugs in the year prior to study entry date"

save Exposures_`i'.dta, replace
	}
use Exposures_0, clear 
forval i=1/49 {		
	append using Exposures_`i'
	}
save Exposures.dta, replace

////////////////////////////////////////////

timer off 1
timer list 1

exit
log close
